diff --git a/app/k9mail/src/main/java/com/fsck/k9/Account.java b/app/core/src/main/java/com/fsck/k9/Account.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/Account.java
rename to app/core/src/main/java/com/fsck/k9/Account.java
index 98943321c..8ea1334a9 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/Account.java
+++ b/app/core/src/main/java/com/fsck/k9/Account.java
@@ -22,6 +22,7 @@ import android.text.TextUtils;
 
 import com.fsck.k9.activity.setup.AccountSetupCheckSettings.CheckDirection;
 import com.fsck.k9.backend.api.SyncConfig.ExpungePolicy;
+import com.fsck.k9.core.R;
 import com.fsck.k9.helper.Utility;
 import com.fsck.k9.mail.Address;
 import com.fsck.k9.mail.Folder.FolderClass;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/AccountStats.java b/app/core/src/main/java/com/fsck/k9/AccountStats.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/AccountStats.java
rename to app/core/src/main/java/com/fsck/k9/AccountStats.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ActivityExtensions.kt b/app/core/src/main/java/com/fsck/k9/ActivityExtensions.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ActivityExtensions.kt
rename to app/core/src/main/java/com/fsck/k9/ActivityExtensions.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/BaseAccount.java b/app/core/src/main/java/com/fsck/k9/BaseAccount.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/BaseAccount.java
rename to app/core/src/main/java/com/fsck/k9/BaseAccount.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/Clock.java b/app/core/src/main/java/com/fsck/k9/Clock.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/Clock.java
rename to app/core/src/main/java/com/fsck/k9/Clock.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/DI.kt b/app/core/src/main/java/com/fsck/k9/DI.kt
similarity index 98%
rename from app/k9mail/src/main/java/com/fsck/k9/DI.kt
rename to app/core/src/main/java/com/fsck/k9/DI.kt
index 86f0aa159..4600ecf48 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/DI.kt
+++ b/app/core/src/main/java/com/fsck/k9/DI.kt
@@ -5,6 +5,7 @@ import android.content.Context
 import com.fsck.k9.autocrypt.autocryptModule
 import com.fsck.k9.backend.backendModule
 import com.fsck.k9.controller.MessagingController
+import com.fsck.k9.core.BuildConfig
 import com.fsck.k9.crypto.openPgpModule
 import com.fsck.k9.mail.TransportProvider
 import com.fsck.k9.mail.power.PowerManager
diff --git a/app/k9mail/src/main/java/com/fsck/k9/EmailAddressValidator.java b/app/core/src/main/java/com/fsck/k9/EmailAddressValidator.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/EmailAddressValidator.java
rename to app/core/src/main/java/com/fsck/k9/EmailAddressValidator.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/FontSizes.java b/app/core/src/main/java/com/fsck/k9/FontSizes.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/FontSizes.java
rename to app/core/src/main/java/com/fsck/k9/FontSizes.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/Globals.java b/app/core/src/main/java/com/fsck/k9/Globals.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/Globals.java
rename to app/core/src/main/java/com/fsck/k9/Globals.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/Identity.java b/app/core/src/main/java/com/fsck/k9/Identity.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/Identity.java
rename to app/core/src/main/java/com/fsck/k9/Identity.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/K9.java b/app/core/src/main/java/com/fsck/k9/K9.java
similarity index 96%
rename from app/k9mail/src/main/java/com/fsck/k9/K9.java
rename to app/core/src/main/java/com/fsck/k9/K9.java
index 70b63cdee..34e697025 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/K9.java
+++ b/app/core/src/main/java/com/fsck/k9/K9.java
@@ -30,6 +30,8 @@ import com.fsck.k9.activity.MessageCompose;
 import com.fsck.k9.activity.UpgradeDatabases;
 import com.fsck.k9.controller.MessagingController;
 import com.fsck.k9.controller.SimpleMessagingListener;
+import com.fsck.k9.core.BuildConfig;
+import com.fsck.k9.core.R;
 import com.fsck.k9.mail.Address;
 import com.fsck.k9.mail.K9MailLib;
 import com.fsck.k9.mail.Message;
@@ -39,6 +41,7 @@ import com.fsck.k9.mailstore.LocalStore;
 import com.fsck.k9.power.DeviceIdleManager;
 import com.fsck.k9.preferences.Storage;
 import com.fsck.k9.preferences.StorageEditor;
+import com.fsck.k9.remotecontrol.K9RemoteControl;
 import com.fsck.k9.service.BootReceiver;
 import com.fsck.k9.service.MailService;
 import com.fsck.k9.service.ShutdownReceiver;
@@ -134,7 +137,7 @@ public class K9 extends Application {
      * It should NEVER be on for Market builds
      * Right now, it just governs strictmode
      **/
-    public static boolean DEVELOPER_MODE = BuildConfig.DEVELOPER_MODE;
+    public static boolean DEVELOPER_MODE = BuildConfig.DEBUG;
 
 
     /**
@@ -314,18 +317,18 @@ public class K9 extends Application {
     public static class Intents {
 
         public static class EmailReceived {
-            public static final String ACTION_EMAIL_RECEIVED = BuildConfig.APPLICATION_ID + ".intent.action.EMAIL_RECEIVED";
-            public static final String ACTION_EMAIL_DELETED = BuildConfig.APPLICATION_ID + ".intent.action.EMAIL_DELETED";
-            public static final String ACTION_REFRESH_OBSERVER = BuildConfig.APPLICATION_ID + ".intent.action.REFRESH_OBSERVER";
-            public static final String EXTRA_ACCOUNT = BuildConfig.APPLICATION_ID + ".intent.extra.ACCOUNT";
-            public static final String EXTRA_FOLDER = BuildConfig.APPLICATION_ID + ".intent.extra.FOLDER";
-            public static final String EXTRA_SENT_DATE = BuildConfig.APPLICATION_ID + ".intent.extra.SENT_DATE";
-            public static final String EXTRA_FROM = BuildConfig.APPLICATION_ID + ".intent.extra.FROM";
-            public static final String EXTRA_TO = BuildConfig.APPLICATION_ID + ".intent.extra.TO";
-            public static final String EXTRA_CC = BuildConfig.APPLICATION_ID + ".intent.extra.CC";
-            public static final String EXTRA_BCC = BuildConfig.APPLICATION_ID + ".intent.extra.BCC";
-            public static final String EXTRA_SUBJECT = BuildConfig.APPLICATION_ID + ".intent.extra.SUBJECT";
-            public static final String EXTRA_FROM_SELF = BuildConfig.APPLICATION_ID + ".intent.extra.FROM_SELF";
+            public static String ACTION_EMAIL_RECEIVED;
+            public static String ACTION_EMAIL_DELETED;
+            public static String ACTION_REFRESH_OBSERVER;
+            public static String EXTRA_ACCOUNT;
+            public static String EXTRA_FOLDER;
+            public static String EXTRA_SENT_DATE;
+            public static String EXTRA_FROM;
+            public static String EXTRA_TO;
+            public static String EXTRA_CC;
+            public static String EXTRA_BCC;
+            public static String EXTRA_SUBJECT;
+            public static String EXTRA_FROM_SELF;
         }
 
         public static class Share {
@@ -334,7 +337,23 @@ public class K9 extends Application {
              * because of different semantics (String array vs. string with comma separated
              * email addresses)
              */
-            public static final String EXTRA_FROM = BuildConfig.APPLICATION_ID + ".intent.extra.SENDER";
+            public static String EXTRA_FROM;
+        }
+
+        static void init(String packageName) {
+            EmailReceived.ACTION_EMAIL_RECEIVED = packageName + ".intent.action.EMAIL_RECEIVED";
+            EmailReceived.ACTION_EMAIL_DELETED = packageName + ".intent.action.EMAIL_DELETED";
+            EmailReceived.ACTION_REFRESH_OBSERVER = packageName + ".intent.action.REFRESH_OBSERVER";
+            EmailReceived.EXTRA_ACCOUNT = packageName + ".intent.extra.ACCOUNT";
+            EmailReceived.EXTRA_FOLDER = packageName + ".intent.extra.FOLDER";
+            EmailReceived.EXTRA_SENT_DATE = packageName + ".intent.extra.SENT_DATE";
+            EmailReceived.EXTRA_FROM = packageName + ".intent.extra.FROM";
+            EmailReceived.EXTRA_TO = packageName + ".intent.extra.TO";
+            EmailReceived.EXTRA_CC = packageName + ".intent.extra.CC";
+            EmailReceived.EXTRA_BCC = packageName + ".intent.extra.BCC";
+            EmailReceived.EXTRA_SUBJECT = packageName + ".intent.extra.SUBJECT";
+            EmailReceived.EXTRA_FROM_SELF = packageName + ".intent.extra.FROM_SELF";
+            Share.EXTRA_FROM = packageName + ".intent.extra.SENDER";
         }
     }
 
@@ -523,6 +542,10 @@ public class K9 extends Application {
 
         PRNGFixes.apply();
 
+        String packageName = getPackageName();
+        K9RemoteControl.init(packageName);
+        Intents.init(packageName);
+
         super.onCreate();
         app = this;
         DI.start(this);
@@ -700,7 +723,7 @@ public class K9 extends Application {
      */
     public static void loadPrefs(Preferences prefs) {
         Storage storage = prefs.getStorage();
-        setDebug(storage.getBoolean("enableDebugLogging", BuildConfig.DEVELOPER_MODE));
+        setDebug(storage.getBoolean("enableDebugLogging", DEVELOPER_MODE));
         DEBUG_SENSITIVE = storage.getBoolean("enableSensitiveLogging", false);
         animations = storage.getBoolean("animations", true);
         gesturesEnabled = storage.getBoolean("gesturesEnabled", false);
diff --git a/app/k9mail/src/main/java/com/fsck/k9/NotificationSetting.java b/app/core/src/main/java/com/fsck/k9/NotificationSetting.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/NotificationSetting.java
rename to app/core/src/main/java/com/fsck/k9/NotificationSetting.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/PRNGFixes.java b/app/core/src/main/java/com/fsck/k9/PRNGFixes.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/PRNGFixes.java
rename to app/core/src/main/java/com/fsck/k9/PRNGFixes.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/Preferences.java b/app/core/src/main/java/com/fsck/k9/Preferences.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/Preferences.java
rename to app/core/src/main/java/com/fsck/k9/Preferences.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/QuietTimeChecker.java b/app/core/src/main/java/com/fsck/k9/QuietTimeChecker.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/QuietTimeChecker.java
rename to app/core/src/main/java/com/fsck/k9/QuietTimeChecker.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/Throttle.java b/app/core/src/main/java/com/fsck/k9/Throttle.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/Throttle.java
rename to app/core/src/main/java/com/fsck/k9/Throttle.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/account/AccountCreator.java b/app/core/src/main/java/com/fsck/k9/account/AccountCreator.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/account/AccountCreator.java
rename to app/core/src/main/java/com/fsck/k9/account/AccountCreator.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/AccountList.java b/app/core/src/main/java/com/fsck/k9/activity/AccountList.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/AccountList.java
rename to app/core/src/main/java/com/fsck/k9/activity/AccountList.java
index efee913b2..62d72f1d9 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/AccountList.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/AccountList.java
@@ -18,7 +18,7 @@ import com.fsck.k9.BaseAccount;
 import com.fsck.k9.FontSizes;
 import com.fsck.k9.K9;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.search.SearchAccount;
 
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/Accounts.java b/app/core/src/main/java/com/fsck/k9/activity/Accounts.java
similarity index 98%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/Accounts.java
rename to app/core/src/main/java/com/fsck/k9/activity/Accounts.java
index 0db5681a1..b52949e52 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/Accounts.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/Accounts.java
@@ -64,7 +64,7 @@ import com.fsck.k9.BaseAccount;
 import com.fsck.k9.FontSizes;
 import com.fsck.k9.K9;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.compose.MessageActions;
 import com.fsck.k9.activity.misc.ExtendedAsyncTask;
 import com.fsck.k9.activity.misc.NonConfigurationInstance;
@@ -1158,37 +1158,27 @@ public class Accounts extends K9ListActivity implements OnItemClickListener {
         }
         if (selectedContextAccount instanceof Account) {
             Account realAccount = (Account) selectedContextAccount;
-            switch (item.getItemId()) {
-                case R.id.delete_account:
-                    onDeleteAccount(realAccount);
-                    break;
-                case R.id.account_settings:
-                    onEditAccount(realAccount);
-                    break;
-                case R.id.activate:
-                    onActivateAccount(realAccount);
-                    break;
-                case R.id.clear_pending:
-                    onClearCommands(realAccount);
-                    break;
-                case R.id.empty_trash:
-                    onEmptyTrash(realAccount);
-                    break;
-                case R.id.clear:
-                    onClear(realAccount);
-                    break;
-                case R.id.recreate:
-                    onRecreate(realAccount);
-                    break;
-                case R.id.export:
-                    onExport(false, realAccount);
-                    break;
-                case R.id.move_up:
-                    onMove(realAccount, true);
-                    break;
-                case R.id.move_down:
-                    onMove(realAccount, false);
-                    break;
+            int id = item.getItemId();
+            if (id == R.id.delete_account) {
+                onDeleteAccount(realAccount);
+            } else if (id == R.id.account_settings) {
+                onEditAccount(realAccount);
+            } else if (id == R.id.activate) {
+                onActivateAccount(realAccount);
+            } else if (id == R.id.clear_pending) {
+                onClearCommands(realAccount);
+            } else if (id == R.id.empty_trash) {
+                onEmptyTrash(realAccount);
+            } else if (id == R.id.clear) {
+                onClear(realAccount);
+            } else if (id == R.id.recreate) {
+                onRecreate(realAccount);
+            } else if (id == R.id.export) {
+                onExport(false, realAccount);
+            } else if (id == R.id.move_up) {
+                onMove(realAccount, true);
+            } else if (id == R.id.move_down) {
+                onMove(realAccount, false);
             }
         }
         return true;
@@ -1216,26 +1206,20 @@ public class Accounts extends K9ListActivity implements OnItemClickListener {
 
     @Override
     public boolean onOptionsItemSelected(MenuItem item) {
-        switch (item.getItemId()) {
-        case R.id.settings:
+        int id = item.getItemId();
+        if (id == R.id.settings) {
             onEditSettings();
-            break;
-        case R.id.check_mail:
+        } else if (id == R.id.check_mail) {
             onCheckMail(null);
-            break;
-        case R.id.compose:
+        } else if (id == R.id.compose) {
             onCompose();
-            break;
-        case R.id.search:
+        } else if (id == R.id.search) {
             onSearchRequested();
-            break;
-        case R.id.export_all:
+        } else if (id == R.id.export_all) {
             onExport(true, null);
-            break;
-        case R.id.import_settings:
+        } else if (id == R.id.import_settings) {
             onImport();
-            break;
-        default:
+        } else {
             return super.onOptionsItemSelected(item);
         }
         return true;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/ActivityListener.java b/app/core/src/main/java/com/fsck/k9/activity/ActivityListener.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/ActivityListener.java
rename to app/core/src/main/java/com/fsck/k9/activity/ActivityListener.java
index 50df397ce..33bcbb0c8 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/ActivityListener.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/ActivityListener.java
@@ -10,7 +10,7 @@ import android.text.format.DateUtils;
 import com.fsck.k9.Account;
 import com.fsck.k9.AccountStats;
 import com.fsck.k9.K9;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.controller.SimpleMessagingListener;
 import com.fsck.k9.service.MailService;
 import net.jcip.annotations.GuardedBy;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/AlternateRecipientAdapter.java b/app/core/src/main/java/com/fsck/k9/activity/AlternateRecipientAdapter.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/AlternateRecipientAdapter.java
rename to app/core/src/main/java/com/fsck/k9/activity/AlternateRecipientAdapter.java
index 05babc55a..9514ba928 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/AlternateRecipientAdapter.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/AlternateRecipientAdapter.java
@@ -19,7 +19,7 @@ import android.widget.BaseAdapter;
 import android.widget.ImageView;
 import android.widget.TextView;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.compose.RecipientAdapter;
 import com.fsck.k9.ui.ContactBadge;
 import com.fsck.k9.view.RecipientSelectView.Recipient;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/ChooseAccount.java b/app/core/src/main/java/com/fsck/k9/activity/ChooseAccount.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/ChooseAccount.java
rename to app/core/src/main/java/com/fsck/k9/activity/ChooseAccount.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/ChooseFolder.java b/app/core/src/main/java/com/fsck/k9/activity/ChooseFolder.java
similarity index 94%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/ChooseFolder.java
rename to app/core/src/main/java/com/fsck/k9/activity/ChooseFolder.java
index 7716b1580..94269af3c 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/ChooseFolder.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/ChooseFolder.java
@@ -23,7 +23,7 @@ import com.fsck.k9.Account;
 import com.fsck.k9.Account.FolderMode;
 import com.fsck.k9.K9;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.controller.MessagingController;
 import com.fsck.k9.controller.MessagingListener;
 import com.fsck.k9.controller.SimpleMessagingListener;
@@ -203,30 +203,24 @@ public class ChooseFolder extends K9ListActivity {
 
     @Override
     public boolean onOptionsItemSelected(MenuItem item) {
-        switch (item.getItemId()) {
-            case R.id.display_1st_class: {
-                setDisplayMode(FolderMode.FIRST_CLASS);
-                return true;
-            }
-            case R.id.display_1st_and_2nd_class: {
-                setDisplayMode(FolderMode.FIRST_AND_SECOND_CLASS);
-                return true;
-            }
-            case R.id.display_not_second_class: {
-                setDisplayMode(FolderMode.NOT_SECOND_CLASS);
-                return true;
-            }
-            case R.id.display_all: {
-                setDisplayMode(FolderMode.ALL);
-                return true;
-            }
-            case R.id.list_folders: {
-                onRefresh();
-                return true;
-            }
-            default: {
-                return super.onOptionsItemSelected(item);
-            }
+        int id = item.getItemId();
+        if (id == R.id.display_1st_class) {
+            setDisplayMode(FolderMode.FIRST_CLASS);
+            return true;
+        } else if (id == R.id.display_1st_and_2nd_class) {
+            setDisplayMode(FolderMode.FIRST_AND_SECOND_CLASS);
+            return true;
+        } else if (id == R.id.display_not_second_class) {
+            setDisplayMode(FolderMode.NOT_SECOND_CLASS);
+            return true;
+        } else if (id == R.id.display_all) {
+            setDisplayMode(FolderMode.ALL);
+            return true;
+        } else if (id == R.id.list_folders) {
+            onRefresh();
+            return true;
+        } else {
+            return super.onOptionsItemSelected(item);
         }
     }
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/ChooseIdentity.java b/app/core/src/main/java/com/fsck/k9/activity/ChooseIdentity.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/ChooseIdentity.java
rename to app/core/src/main/java/com/fsck/k9/activity/ChooseIdentity.java
index 6795ea0b9..2877d59a0 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/ChooseIdentity.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/ChooseIdentity.java
@@ -12,7 +12,7 @@ import android.widget.Toast;
 import com.fsck.k9.Account;
 import com.fsck.k9.Identity;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import java.util.List;
 
 public class ChooseIdentity extends K9ListActivity {
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/ConfirmationDialog.java b/app/core/src/main/java/com/fsck/k9/activity/ConfirmationDialog.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/ConfirmationDialog.java
rename to app/core/src/main/java/com/fsck/k9/activity/ConfirmationDialog.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/EditIdentity.java b/app/core/src/main/java/com/fsck/k9/activity/EditIdentity.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/EditIdentity.java
rename to app/core/src/main/java/com/fsck/k9/activity/EditIdentity.java
index bf9eeced8..bcb14bc2f 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/EditIdentity.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/EditIdentity.java
@@ -9,7 +9,7 @@ import android.widget.LinearLayout;
 import com.fsck.k9.Account;
 import com.fsck.k9.Identity;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import java.util.List;
 
 public class EditIdentity extends K9Activity {
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/EmailAddressList.java b/app/core/src/main/java/com/fsck/k9/activity/EmailAddressList.java
similarity index 98%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/EmailAddressList.java
rename to app/core/src/main/java/com/fsck/k9/activity/EmailAddressList.java
index 6b2141d7e..58dbfd9f8 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/EmailAddressList.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/EmailAddressList.java
@@ -9,7 +9,7 @@ import android.widget.ListView;
 import android.widget.Toast;
 import android.widget.AdapterView.OnItemClickListener;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.helper.ContactItem;
 
 public class EmailAddressList extends K9ListActivity implements OnItemClickListener {
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/FolderInfoHolder.java b/app/core/src/main/java/com/fsck/k9/activity/FolderInfoHolder.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/FolderInfoHolder.java
rename to app/core/src/main/java/com/fsck/k9/activity/FolderInfoHolder.java
index 18074c986..a0131c593 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/FolderInfoHolder.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/FolderInfoHolder.java
@@ -3,7 +3,7 @@ package com.fsck.k9.activity;
 import android.content.Context;
 
 import com.fsck.k9.Account;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.mail.Folder;
 import com.fsck.k9.mailstore.LocalFolder;
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/FolderList.java b/app/core/src/main/java/com/fsck/k9/activity/FolderList.java
similarity index 98%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/FolderList.java
rename to app/core/src/main/java/com/fsck/k9/activity/FolderList.java
index 6fb87624b..f4eb9baf7 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/FolderList.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/FolderList.java
@@ -43,7 +43,7 @@ import com.fsck.k9.Account.FolderMode;
 import com.fsck.k9.FontSizes;
 import com.fsck.k9.K9;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.compose.MessageActions;
 import com.fsck.k9.activity.setup.FolderSettings;
 import com.fsck.k9.controller.MessagingController;
@@ -457,68 +457,47 @@ public class FolderList extends K9ListActivity {
     }
 
     @Override public boolean onOptionsItemSelected(MenuItem item) {
-        switch (item.getItemId()) {
-        case android.R.id.home:
+        int id = item.getItemId();
+        if (id == android.R.id.home) {
             onAccounts();
-
             return true;
-
-        case R.id.search:
+        } else if (id == R.id.search) {
             onSearchRequested();
-
             return true;
-
-        case R.id.compose:
+        } else if (id == R.id.compose) {
             MessageActions.actionCompose(this, account);
-
             return true;
-
-        case R.id.check_mail:
+        } else if (id == R.id.check_mail) {
             MessagingController.getInstance(getApplication()).checkMail(this, account, true, true, adapter.mListener);
-
             return true;
-
-        case R.id.send_messages:
+        } else if (id == R.id.send_messages) {
             MessagingController.getInstance(getApplication()).sendPendingMessages(account, null);
-
             return true;
-
-        case R.id.list_folders:
+        } else if (id == R.id.list_folders) {
             onRefresh(REFRESH_REMOTE);
-
             return true;
-
-        case R.id.settings:
+        } else if (id == R.id.settings) {
             onEditSettings();
             return true;
-
-        case R.id.empty_trash:
+        } else if (id == R.id.empty_trash) {
             onEmptyTrash(account);
-
             return true;
-
-        case R.id.compact:
+        } else if (id == R.id.compact) {
             onCompact(account);
-
             return true;
-
-        case R.id.display_1st_class: {
+        } else if (id == R.id.display_1st_class) {
             setDisplayMode(FolderMode.FIRST_CLASS);
             return true;
-        }
-        case R.id.display_1st_and_2nd_class: {
+        } else if (id == R.id.display_1st_and_2nd_class) {
             setDisplayMode(FolderMode.FIRST_AND_SECOND_CLASS);
             return true;
-        }
-        case R.id.display_not_second_class: {
+        } else if (id == R.id.display_not_second_class) {
             setDisplayMode(FolderMode.NOT_SECOND_CLASS);
             return true;
-        }
-        case R.id.display_all: {
+        } else if (id == R.id.display_all) {
             setDisplayMode(FolderMode.ALL);
             return true;
-        }
-        default:
+        } else {
             return super.onOptionsItemSelected(item);
         }
     }
@@ -585,16 +564,13 @@ public class FolderList extends K9ListActivity {
         AdapterContextMenuInfo info = (AdapterContextMenuInfo) item .getMenuInfo();
         FolderInfoHolder folder = (FolderInfoHolder) adapter.getItem(info.position);
 
-        switch (item.getItemId()) {
-        case R.id.clear_local_folder:
+        int id = item.getItemId();
+        if (id == R.id.clear_local_folder) {
             onClearFolder(account, folder.serverId);
-            break;
-        case R.id.refresh_folder:
+        } else if (id == R.id.refresh_folder) {
             checkMail(folder);
-            break;
-        case R.id.folder_settings:
+        } else if (id == R.id.folder_settings) {
             FolderSettings.actionSettings(this, account, folder.serverId);
-            break;
         }
 
         return super.onContextItemSelected(item);
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/FolderListFilter.java b/app/core/src/main/java/com/fsck/k9/activity/FolderListFilter.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/FolderListFilter.java
rename to app/core/src/main/java/com/fsck/k9/activity/FolderListFilter.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/K9Activity.java b/app/core/src/main/java/com/fsck/k9/activity/K9Activity.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/K9Activity.java
rename to app/core/src/main/java/com/fsck/k9/activity/K9Activity.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/K9ActivityCommon.java b/app/core/src/main/java/com/fsck/k9/activity/K9ActivityCommon.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/K9ActivityCommon.java
rename to app/core/src/main/java/com/fsck/k9/activity/K9ActivityCommon.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/K9ListActivity.java b/app/core/src/main/java/com/fsck/k9/activity/K9ListActivity.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/K9ListActivity.java
rename to app/core/src/main/java/com/fsck/k9/activity/K9ListActivity.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/K9PreferenceActivity.java b/app/core/src/main/java/com/fsck/k9/activity/K9PreferenceActivity.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/K9PreferenceActivity.java
rename to app/core/src/main/java/com/fsck/k9/activity/K9PreferenceActivity.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/LauncherShortcuts.java b/app/core/src/main/java/com/fsck/k9/activity/LauncherShortcuts.java
similarity index 98%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/LauncherShortcuts.java
rename to app/core/src/main/java/com/fsck/k9/activity/LauncherShortcuts.java
index 563505896..4de3b7610 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/LauncherShortcuts.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/LauncherShortcuts.java
@@ -6,7 +6,7 @@ import android.os.Parcelable;
 
 import com.fsck.k9.Account;
 import com.fsck.k9.BaseAccount;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.search.SearchAccount;
 
 public class LauncherShortcuts extends AccountList {
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/ManageIdentities.java b/app/core/src/main/java/com/fsck/k9/activity/ManageIdentities.java
similarity index 92%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/ManageIdentities.java
rename to app/core/src/main/java/com/fsck/k9/activity/ManageIdentities.java
index 1f17c71ba..3e4e11fdf 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/ManageIdentities.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/ManageIdentities.java
@@ -14,7 +14,7 @@ import android.widget.Toast;
 
 import com.fsck.k9.Identity;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 
 public class ManageIdentities extends ChooseIdentity {
     private boolean mIdentitiesChanged = false;
@@ -56,13 +56,11 @@ public class ManageIdentities extends ChooseIdentity {
 
     @Override
     public boolean onOptionsItemSelected(MenuItem item) {
-        switch (item.getItemId()) {
-        case R.id.new_identity:
+        if (item.getItemId() == R.id.new_identity) {
             Intent intent = new Intent(ManageIdentities.this, EditIdentity.class);
             intent.putExtra(EditIdentity.EXTRA_ACCOUNT, mAccount.getUuid());
             startActivityForResult(intent, ACTIVITY_EDIT_IDENTITY);
-            break;
-        default:
+        } else {
             return super.onOptionsItemSelected(item);
         }
         return true;
@@ -78,34 +76,29 @@ public class ManageIdentities extends ChooseIdentity {
     @Override
     public boolean onContextItemSelected(android.view.MenuItem item) {
         AdapterContextMenuInfo menuInfo = (AdapterContextMenuInfo)item.getMenuInfo();
-        switch (item.getItemId()) {
-        case R.id.edit:
+        int id = item.getItemId();
+        if (id == R.id.edit) {
             editItem(menuInfo.position);
-            break;
-        case R.id.up:
+        } else if (id == R.id.up) {
             if (menuInfo.position > 0) {
                 Identity identity = identities.remove(menuInfo.position);
                 identities.add(menuInfo.position - 1, identity);
                 mIdentitiesChanged = true;
                 refreshView();
             }
-
-            break;
-        case R.id.down:
+        } else if (id == R.id.down) {
             if (menuInfo.position < identities.size() - 1) {
                 Identity identity = identities.remove(menuInfo.position);
                 identities.add(menuInfo.position + 1, identity);
                 mIdentitiesChanged = true;
                 refreshView();
             }
-            break;
-        case R.id.top:
+        } else if (id == R.id.top) {
             Identity identity = identities.remove(menuInfo.position);
             identities.add(0, identity);
             mIdentitiesChanged = true;
             refreshView();
-            break;
-        case R.id.remove:
+        } else if (id == R.id.remove) {
             if (identities.size() > 1) {
                 identities.remove(menuInfo.position);
                 mIdentitiesChanged = true;
@@ -114,7 +107,6 @@ public class ManageIdentities extends ChooseIdentity {
                 Toast.makeText(this, getString(R.string.no_removable_identity),
                                Toast.LENGTH_LONG).show();
             }
-            break;
         }
         return true;
     }
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/MessageCompose.java b/app/core/src/main/java/com/fsck/k9/activity/MessageCompose.java
similarity index 97%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/MessageCompose.java
rename to app/core/src/main/java/com/fsck/k9/activity/MessageCompose.java
index e6ea79b21..b1b12aced 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/MessageCompose.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/MessageCompose.java
@@ -48,7 +48,7 @@ import com.fsck.k9.Account.MessageFormat;
 import com.fsck.k9.Identity;
 import com.fsck.k9.K9;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.MessageLoaderHelper.MessageLoaderCallbacks;
 import com.fsck.k9.activity.compose.AttachmentPresenter;
 import com.fsck.k9.activity.compose.AttachmentPresenter.AttachmentMvpView;
@@ -891,13 +891,11 @@ public class MessageCompose extends K9Activity implements OnClickListener,
 
     @Override
     public void onFocusChange(View v, boolean hasFocus) {
-        switch (v.getId()) {
-            case R.id.message_content:
-            case R.id.subject:
-                if (hasFocus) {
-                    recipientPresenter.onNonRecipientFieldFocused();
-                }
-                break;
+        int id = v.getId();
+        if (id == R.id.message_content || id == R.id.subject) {
+            if (hasFocus) {
+                recipientPresenter.onNonRecipientFieldFocused();
+            }
         }
     }
 
@@ -933,10 +931,8 @@ public class MessageCompose extends K9Activity implements OnClickListener,
 
     @Override
     public void onClick(View view) {
-        switch (view.getId()) {
-            case R.id.identity:
-                showDialog(DIALOG_CHOOSE_IDENTITY);
-                break;
+        if (view.getId() == R.id.identity) {
+            showDialog(DIALOG_CHOOSE_IDENTITY);
         }
     }
 
@@ -950,52 +946,39 @@ public class MessageCompose extends K9Activity implements OnClickListener,
 
     @Override
     public boolean onOptionsItemSelected(MenuItem item) {
-        switch (item.getItemId()) {
-            case android.R.id.home:
-                prepareToFinish(true);
-                break;
-            case R.id.send:
-                checkToSendMessage();
-                break;
-            case R.id.save:
-                checkToSaveDraftAndSave();
-                break;
-            case R.id.discard:
-                askBeforeDiscard();
-                break;
-            case R.id.add_from_contacts:
-                recipientPresenter.onMenuAddFromContacts();
-                break;
-            case R.id.openpgp_encrypt_disable:
-                recipientPresenter.onMenuToggleEncryption();
-                updateMessageFormat();
-                break;
-            case R.id.openpgp_encrypt_enable:
-                recipientPresenter.onMenuToggleEncryption();
-                updateMessageFormat();
-                break;
-            case R.id.openpgp_inline_enable:
-                recipientPresenter.onMenuSetPgpInline(true);
-                updateMessageFormat();
-                break;
-            case R.id.openpgp_inline_disable:
-                recipientPresenter.onMenuSetPgpInline(false);
-                updateMessageFormat();
-                break;
-            case R.id.openpgp_sign_only:
-                recipientPresenter.onMenuSetSignOnly(true);
-                break;
-            case R.id.openpgp_sign_only_disable:
-                recipientPresenter.onMenuSetSignOnly(false);
-                break;
-            case R.id.add_attachment:
-                attachmentPresenter.onClickAddAttachment(recipientPresenter);
-                break;
-            case R.id.read_receipt:
-                onReadReceipt();
-                break;
-            default:
-                return super.onOptionsItemSelected(item);
+        int id = item.getItemId();
+        if (id == android.R.id.home) {
+            prepareToFinish(true);
+        } else if (id == R.id.send) {
+            checkToSendMessage();
+        } else if (id == R.id.save) {
+            checkToSaveDraftAndSave();
+        } else if (id == R.id.discard) {
+            askBeforeDiscard();
+        } else if (id == R.id.add_from_contacts) {
+            recipientPresenter.onMenuAddFromContacts();
+        } else if (id == R.id.openpgp_encrypt_disable) {
+            recipientPresenter.onMenuToggleEncryption();
+            updateMessageFormat();
+        } else if (id == R.id.openpgp_encrypt_enable) {
+            recipientPresenter.onMenuToggleEncryption();
+            updateMessageFormat();
+        } else if (id == R.id.openpgp_inline_enable) {
+            recipientPresenter.onMenuSetPgpInline(true);
+            updateMessageFormat();
+        } else if (id == R.id.openpgp_inline_disable) {
+            recipientPresenter.onMenuSetPgpInline(false);
+            updateMessageFormat();
+        } else if (id == R.id.openpgp_sign_only) {
+            recipientPresenter.onMenuSetSignOnly(true);
+        } else if (id == R.id.openpgp_sign_only_disable) {
+            recipientPresenter.onMenuSetSignOnly(false);
+        } else if (id == R.id.add_attachment) {
+            attachmentPresenter.onClickAddAttachment(recipientPresenter);
+        } else if (id == R.id.read_receipt) {
+            onReadReceipt();
+        } else {
+            return super.onOptionsItemSelected(item);
         }
         return true;
     }
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/MessageInfoHolder.java b/app/core/src/main/java/com/fsck/k9/activity/MessageInfoHolder.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/MessageInfoHolder.java
rename to app/core/src/main/java/com/fsck/k9/activity/MessageInfoHolder.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/MessageList.java b/app/core/src/main/java/com/fsck/k9/activity/MessageList.java
similarity index 92%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/MessageList.java
rename to app/core/src/main/java/com/fsck/k9/activity/MessageList.java
index 2b5e5dc6b..688677045 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/MessageList.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/MessageList.java
@@ -46,7 +46,7 @@ import com.fsck.k9.DI;
 import com.fsck.k9.K9;
 import com.fsck.k9.K9.SplitViewMode;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.compose.MessageActions;
 import com.fsck.k9.activity.misc.SwipeGestureDetector.OnSwipeGestureListener;
 import com.fsck.k9.fragment.MessageListFragment;
@@ -955,156 +955,116 @@ public class MessageList extends K9Activity implements MessageListFragmentListen
 
     @Override
     public boolean onOptionsItemSelected(MenuItem item) {
-        int itemId = item.getItemId();
-        switch (itemId) {
-            case android.R.id.home: {
-                if (displayMode != DisplayMode.MESSAGE_VIEW && !isAdditionalMessageListDisplayed()) {
-                    if (isDrawerEnabled()) {
-                        if (drawer.isDrawerOpen()) {
-                            drawer.closeDrawer();
-                        } else {
-                            drawer.openDrawer();
-                        }
+        int id = item.getItemId();
+        if (id == android.R.id.home) {
+            if (displayMode != DisplayMode.MESSAGE_VIEW && !isAdditionalMessageListDisplayed()) {
+                if (isDrawerEnabled()) {
+                    if (drawer.isDrawerOpen()) {
+                        drawer.closeDrawer();
                     } else {
-                        finish();
+                        drawer.openDrawer();
                     }
                 } else {
-                    goBack();
+                    finish();
                 }
-                return true;
-            }
-            case R.id.compose: {
-                messageListFragment.onCompose();
-                return true;
-            }
-            case R.id.toggle_message_view_theme: {
-                onToggleTheme();
-                return true;
-            }
-            // MessageList
-            case R.id.check_mail: {
-                messageListFragment.checkMail();
-                return true;
-            }
-            case R.id.set_sort_date: {
-                messageListFragment.changeSort(SortType.SORT_DATE);
-                return true;
-            }
-            case R.id.set_sort_arrival: {
-                messageListFragment.changeSort(SortType.SORT_ARRIVAL);
-                return true;
-            }
-            case R.id.set_sort_subject: {
-                messageListFragment.changeSort(SortType.SORT_SUBJECT);
-                return true;
-            }
-            case R.id.set_sort_sender: {
-                messageListFragment.changeSort(SortType.SORT_SENDER);
-                return true;
-            }
-            case R.id.set_sort_flag: {
-                messageListFragment.changeSort(SortType.SORT_FLAGGED);
-                return true;
-            }
-            case R.id.set_sort_unread: {
-                messageListFragment.changeSort(SortType.SORT_UNREAD);
-                return true;
-            }
-            case R.id.set_sort_attach: {
-                messageListFragment.changeSort(SortType.SORT_ATTACHMENT);
-                return true;
-            }
-            case R.id.select_all: {
-                messageListFragment.selectAll();
-                return true;
-            }
-            case R.id.settings: {
-                onEditSettings();
-                return true;
-            }
-            case R.id.search: {
-                messageListFragment.onSearchRequested();
-                return true;
-            }
-            case R.id.search_remote: {
-                messageListFragment.onRemoteSearch();
-                return true;
-            }
-            case R.id.mark_all_as_read: {
-                messageListFragment.confirmMarkAllAsRead();
-                return true;
-            }
-            case R.id.show_folder_list: {
-                onShowFolderList();
-                return true;
-            }
-            // MessageView
-            case R.id.next_message: {
-                showNextMessage();
-                return true;
-            }
-            case R.id.previous_message: {
-                showPreviousMessage();
-                return true;
-            }
-            case R.id.delete: {
-                messageViewFragment.onDelete();
-                return true;
-            }
-            case R.id.reply: {
-                messageViewFragment.onReply();
-                return true;
-            }
-            case R.id.reply_all: {
-                messageViewFragment.onReplyAll();
-                return true;
-            }
-            case R.id.forward: {
-                messageViewFragment.onForward();
-                return true;
-            }
-            case R.id.forward_as_attachment: {
-                messageViewFragment.onForwardAsAttachment();
-                return true;
-            }
-            case R.id.share: {
-                messageViewFragment.onSendAlternate();
-                return true;
-            }
-            case R.id.toggle_unread: {
-                messageViewFragment.onToggleRead();
-                return true;
-            }
-            case R.id.archive:
-            case R.id.refile_archive: {
-                messageViewFragment.onArchive();
-                return true;
-            }
-            case R.id.spam:
-            case R.id.refile_spam: {
-                messageViewFragment.onSpam();
-                return true;
-            }
-            case R.id.move:
-            case R.id.refile_move: {
-                messageViewFragment.onMove();
-                return true;
-            }
-            case R.id.copy:
-            case R.id.refile_copy: {
-                messageViewFragment.onCopy();
-                return true;
-            }
-            case R.id.select_text: {
-                messageViewFragment.onSelectText();
-                return true;
-            }
-            case R.id.show_headers:
-            case R.id.hide_headers: {
-                messageViewFragment.onToggleAllHeadersView();
-                updateMenu();
-                return true;
-            }
+            } else {
+                goBack();
+            }
+            return true;
+        } else if (id == R.id.compose) {
+            messageListFragment.onCompose();
+            return true;
+        } else if (id == R.id.toggle_message_view_theme) {
+            onToggleTheme();
+            return true;
+        } else if (id == R.id.check_mail) {     // MessageList
+            messageListFragment.checkMail();
+            return true;
+        } else if (id == R.id.set_sort_date) {
+            messageListFragment.changeSort(SortType.SORT_DATE);
+            return true;
+        } else if (id == R.id.set_sort_arrival) {
+            messageListFragment.changeSort(SortType.SORT_ARRIVAL);
+            return true;
+        } else if (id == R.id.set_sort_subject) {
+            messageListFragment.changeSort(SortType.SORT_SUBJECT);
+            return true;
+        } else if (id == R.id.set_sort_sender) {
+            messageListFragment.changeSort(SortType.SORT_SENDER);
+            return true;
+        } else if (id == R.id.set_sort_flag) {
+            messageListFragment.changeSort(SortType.SORT_FLAGGED);
+            return true;
+        } else if (id == R.id.set_sort_unread) {
+            messageListFragment.changeSort(SortType.SORT_UNREAD);
+            return true;
+        } else if (id == R.id.set_sort_attach) {
+            messageListFragment.changeSort(SortType.SORT_ATTACHMENT);
+            return true;
+        } else if (id == R.id.select_all) {
+            messageListFragment.selectAll();
+            return true;
+        } else if (id == R.id.settings) {
+            onEditSettings();
+            return true;
+        } else if (id == R.id.search) {
+            messageListFragment.onSearchRequested();
+            return true;
+        } else if (id == R.id.search_remote) {
+            messageListFragment.onRemoteSearch();
+            return true;
+        } else if (id == R.id.mark_all_as_read) {
+            messageListFragment.confirmMarkAllAsRead();
+            return true;
+        } else if (id == R.id.show_folder_list) {
+            onShowFolderList();
+            return true;
+        } else if (id == R.id.next_message) {   // MessageView
+            showNextMessage();
+            return true;
+        } else if (id == R.id.previous_message) {
+            showPreviousMessage();
+            return true;
+        } else if (id == R.id.delete) {
+            messageViewFragment.onDelete();
+            return true;
+        } else if (id == R.id.reply) {
+            messageViewFragment.onReply();
+            return true;
+        } else if (id == R.id.reply_all) {
+            messageViewFragment.onReplyAll();
+            return true;
+        } else if (id == R.id.forward) {
+            messageViewFragment.onForward();
+            return true;
+        } else if (id == R.id.forward_as_attachment) {
+            messageViewFragment.onForwardAsAttachment();
+            return true;
+        } else if (id == R.id.share) {
+            messageViewFragment.onSendAlternate();
+            return true;
+        } else if (id == R.id.toggle_unread) {
+            messageViewFragment.onToggleRead();
+            return true;
+        } else if (id == R.id.archive || id == R.id.refile_archive) {
+            messageViewFragment.onArchive();
+            return true;
+        } else if (id == R.id.spam || id == R.id.refile_spam) {
+            messageViewFragment.onSpam();
+            return true;
+        } else if (id == R.id.move || id == R.id.refile_move) {
+            messageViewFragment.onMove();
+            return true;
+        } else if (id == R.id.copy || id == R.id.refile_copy) {
+            messageViewFragment.onCopy();
+            return true;
+        } else if (id == R.id.select_text) {
+            messageViewFragment.onSelectText();
+            return true;
+        } else if (id == R.id.show_headers || id == R.id.hide_headers) {
+            messageViewFragment.onToggleAllHeadersView();
+            updateMenu();
+            return true;
         }
 
         if (!singleFolderMode) {
@@ -1113,18 +1073,14 @@ public class MessageList extends K9Activity implements MessageListFragmentListen
             return false;
         }
 
-        switch (itemId) {
-            case R.id.send_messages: {
-                messageListFragment.onSendPendingMessages();
-                return true;
-            }
-            case R.id.expunge: {
-                messageListFragment.onExpunge();
-                return true;
-            }
-            default: {
-                return super.onOptionsItemSelected(item);
-            }
+        if (id == R.id.send_messages) {
+            messageListFragment.onSendPendingMessages();
+            return true;
+        } else if (id == R.id.expunge) {
+            messageListFragment.onExpunge();
+            return true;
+        } else {
+            return super.onOptionsItemSelected(item);
         }
     }
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/MessageLoaderHelper.java b/app/core/src/main/java/com/fsck/k9/activity/MessageLoaderHelper.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/MessageLoaderHelper.java
rename to app/core/src/main/java/com/fsck/k9/activity/MessageLoaderHelper.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/MessageReference.java b/app/core/src/main/java/com/fsck/k9/activity/MessageReference.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/MessageReference.java
rename to app/core/src/main/java/com/fsck/k9/activity/MessageReference.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/MessageReferenceHelper.java b/app/core/src/main/java/com/fsck/k9/activity/MessageReferenceHelper.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/MessageReferenceHelper.java
rename to app/core/src/main/java/com/fsck/k9/activity/MessageReferenceHelper.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/NotificationDeleteConfirmation.java b/app/core/src/main/java/com/fsck/k9/activity/NotificationDeleteConfirmation.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/NotificationDeleteConfirmation.java
rename to app/core/src/main/java/com/fsck/k9/activity/NotificationDeleteConfirmation.java
index 937b64e0f..a70921cd0 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/NotificationDeleteConfirmation.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/NotificationDeleteConfirmation.java
@@ -15,7 +15,7 @@ import android.support.annotation.NonNull;
 import com.fsck.k9.Account;
 import com.fsck.k9.K9;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.controller.MessagingController;
 import com.fsck.k9.notification.NotificationActionService;
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/Search.java b/app/core/src/main/java/com/fsck/k9/activity/Search.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/Search.java
rename to app/core/src/main/java/com/fsck/k9/activity/Search.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/UpgradeDatabases.java b/app/core/src/main/java/com/fsck/k9/activity/UpgradeDatabases.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/UpgradeDatabases.java
rename to app/core/src/main/java/com/fsck/k9/activity/UpgradeDatabases.java
index 91fd71fca..53fe57cfd 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/UpgradeDatabases.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/UpgradeDatabases.java
@@ -14,7 +14,7 @@ import android.widget.TextView;
 import com.fsck.k9.Account;
 import com.fsck.k9.K9;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.controller.MessagingController;
 import com.fsck.k9.mailstore.LocalStore;
 import com.fsck.k9.service.DatabaseUpgradeService;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/AttachmentPresenter.java b/app/core/src/main/java/com/fsck/k9/activity/compose/AttachmentPresenter.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/compose/AttachmentPresenter.java
rename to app/core/src/main/java/com/fsck/k9/activity/compose/AttachmentPresenter.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/ComposeCryptoStatus.java b/app/core/src/main/java/com/fsck/k9/activity/compose/ComposeCryptoStatus.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/compose/ComposeCryptoStatus.java
rename to app/core/src/main/java/com/fsck/k9/activity/compose/ComposeCryptoStatus.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/IdentityAdapter.java b/app/core/src/main/java/com/fsck/k9/activity/compose/IdentityAdapter.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/compose/IdentityAdapter.java
rename to app/core/src/main/java/com/fsck/k9/activity/compose/IdentityAdapter.java
index 07f11eade..9338ced4b 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/IdentityAdapter.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/compose/IdentityAdapter.java
@@ -10,7 +10,7 @@ import android.widget.TextView;
 import com.fsck.k9.Account;
 import com.fsck.k9.Identity;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 
 import java.util.ArrayList;
 import java.util.Collection;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/MessageActions.java b/app/core/src/main/java/com/fsck/k9/activity/compose/MessageActions.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/compose/MessageActions.java
rename to app/core/src/main/java/com/fsck/k9/activity/compose/MessageActions.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/PgpEnabledErrorDialog.java b/app/core/src/main/java/com/fsck/k9/activity/compose/PgpEnabledErrorDialog.java
similarity index 98%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/compose/PgpEnabledErrorDialog.java
rename to app/core/src/main/java/com/fsck/k9/activity/compose/PgpEnabledErrorDialog.java
index b6b420002..6d13463b6 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/PgpEnabledErrorDialog.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/compose/PgpEnabledErrorDialog.java
@@ -12,7 +12,7 @@ import android.support.annotation.IdRes;
 import android.view.LayoutInflater;
 import android.view.View;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.view.HighlightDialogFragment;
 
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/PgpEncryptDescriptionDialog.java b/app/core/src/main/java/com/fsck/k9/activity/compose/PgpEncryptDescriptionDialog.java
similarity index 98%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/compose/PgpEncryptDescriptionDialog.java
rename to app/core/src/main/java/com/fsck/k9/activity/compose/PgpEncryptDescriptionDialog.java
index 0c56c74a3..095a14e3d 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/PgpEncryptDescriptionDialog.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/compose/PgpEncryptDescriptionDialog.java
@@ -12,7 +12,7 @@ import android.support.annotation.IdRes;
 import android.view.LayoutInflater;
 import android.view.View;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.view.HighlightDialogFragment;
 
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/PgpInlineDialog.java b/app/core/src/main/java/com/fsck/k9/activity/compose/PgpInlineDialog.java
similarity index 98%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/compose/PgpInlineDialog.java
rename to app/core/src/main/java/com/fsck/k9/activity/compose/PgpInlineDialog.java
index 370131cb0..d1376b51e 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/PgpInlineDialog.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/compose/PgpInlineDialog.java
@@ -12,7 +12,7 @@ import android.support.annotation.IdRes;
 import android.view.LayoutInflater;
 import android.view.View;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.view.HighlightDialogFragment;
 
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/PgpSignOnlyDialog.java b/app/core/src/main/java/com/fsck/k9/activity/compose/PgpSignOnlyDialog.java
similarity index 98%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/compose/PgpSignOnlyDialog.java
rename to app/core/src/main/java/com/fsck/k9/activity/compose/PgpSignOnlyDialog.java
index 2c9edd5f0..bd91a1914 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/PgpSignOnlyDialog.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/compose/PgpSignOnlyDialog.java
@@ -12,7 +12,7 @@ import android.support.annotation.IdRes;
 import android.view.LayoutInflater;
 import android.view.View;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.view.HighlightDialogFragment;
 
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/RecipientAdapter.java b/app/core/src/main/java/com/fsck/k9/activity/compose/RecipientAdapter.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/compose/RecipientAdapter.java
rename to app/core/src/main/java/com/fsck/k9/activity/compose/RecipientAdapter.java
index 79433853d..21df1adcb 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/RecipientAdapter.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/compose/RecipientAdapter.java
@@ -20,7 +20,7 @@ import android.widget.Filterable;
 import android.widget.ImageView;
 import android.widget.TextView;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.helper.ContactPicture;
 import com.fsck.k9.view.RecipientSelectView.Recipient;
 import com.fsck.k9.view.RecipientSelectView.RecipientCryptoStatus;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/RecipientLoader.java b/app/core/src/main/java/com/fsck/k9/activity/compose/RecipientLoader.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/compose/RecipientLoader.java
rename to app/core/src/main/java/com/fsck/k9/activity/compose/RecipientLoader.java
index 496f16078..1cb414288 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/RecipientLoader.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/compose/RecipientLoader.java
@@ -20,7 +20,7 @@ import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
 import android.support.v4.content.AsyncTaskLoader;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.mail.Address;
 import com.fsck.k9.view.RecipientSelectView.Recipient;
 import com.fsck.k9.view.RecipientSelectView.RecipientCryptoStatus;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/RecipientMvpView.java b/app/core/src/main/java/com/fsck/k9/activity/compose/RecipientMvpView.java
similarity index 93%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/compose/RecipientMvpView.java
rename to app/core/src/main/java/com/fsck/k9/activity/compose/RecipientMvpView.java
index cee359cd7..b998d14bd 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/RecipientMvpView.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/compose/RecipientMvpView.java
@@ -16,7 +16,7 @@ import android.widget.Toast;
 import android.widget.ViewAnimator;
 
 import com.fsck.k9.FontSizes;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.MessageCompose;
 import com.fsck.k9.mail.Address;
 import com.fsck.k9.mail.Message.RecipientType;
@@ -363,48 +363,31 @@ public class RecipientMvpView implements OnFocusChangeListener, OnClickListener
             return;
         }
 
-        switch (view.getId()) {
-            case R.id.to: {
-                presenter.onToFocused();
-                break;
-            }
-            case R.id.cc: {
-                presenter.onCcFocused();
-                break;
-            }
-            case R.id.bcc: {
-                presenter.onBccFocused();
-                break;
-            }
+        int id = view.getId();
+        if (id == R.id.to) {
+            presenter.onToFocused();
+        } else if (id == R.id.cc) {
+            presenter.onCcFocused();
+        } else if (id == R.id.bcc) {
+            presenter.onBccFocused();
         }
     }
 
     @Override
     public void onClick(View view) {
-        switch (view.getId()) {
-            case R.id.to_label: {
-                presenter.onClickToLabel();
-                break;
-            }
-            case R.id.cc_label: {
-                presenter.onClickCcLabel();
-                break;
-            }
-            case R.id.bcc_label: {
-                presenter.onClickBccLabel();
-                break;
-            }
-            case R.id.recipient_expander: {
-                presenter.onClickRecipientExpander();
-                break;
-            }
-            case R.id.crypto_status: {
-                presenter.onClickCryptoStatus();
-                break;
-            }
-            case R.id.crypto_special_mode: {
-                presenter.onClickCryptoSpecialModeIndicator();
-            }
+        int id = view.getId();
+        if (id == R.id.to_label) {
+            presenter.onClickToLabel();
+        } else if (id == R.id.cc_label) {
+            presenter.onClickCcLabel();
+        } else if (id == R.id.bcc_label) {
+            presenter.onClickBccLabel();
+        } else if (id == R.id.recipient_expander) {
+            presenter.onClickRecipientExpander();
+        } else if (id == R.id.crypto_status) {
+            presenter.onClickCryptoStatus();
+        } else if (id == R.id.crypto_special_mode) {
+            presenter.onClickCryptoSpecialModeIndicator();
         }
     }
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/RecipientPresenter.java b/app/core/src/main/java/com/fsck/k9/activity/compose/RecipientPresenter.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/compose/RecipientPresenter.java
rename to app/core/src/main/java/com/fsck/k9/activity/compose/RecipientPresenter.java
index 7c801dc1d..386e2403c 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/RecipientPresenter.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/compose/RecipientPresenter.java
@@ -22,7 +22,7 @@ import android.view.Menu;
 import com.fsck.k9.Account;
 import com.fsck.k9.Identity;
 import com.fsck.k9.K9;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.compose.ComposeCryptoStatus.AttachErrorState;
 import com.fsck.k9.activity.compose.ComposeCryptoStatus.ComposeCryptoStatusBuilder;
 import com.fsck.k9.activity.compose.ComposeCryptoStatus.SendErrorState;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/compose/SaveMessageTask.java b/app/core/src/main/java/com/fsck/k9/activity/compose/SaveMessageTask.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/compose/SaveMessageTask.java
rename to app/core/src/main/java/com/fsck/k9/activity/compose/SaveMessageTask.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/loader/AttachmentContentLoader.java b/app/core/src/main/java/com/fsck/k9/activity/loader/AttachmentContentLoader.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/loader/AttachmentContentLoader.java
rename to app/core/src/main/java/com/fsck/k9/activity/loader/AttachmentContentLoader.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/loader/AttachmentInfoLoader.java b/app/core/src/main/java/com/fsck/k9/activity/loader/AttachmentInfoLoader.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/loader/AttachmentInfoLoader.java
rename to app/core/src/main/java/com/fsck/k9/activity/loader/AttachmentInfoLoader.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/misc/Attachment.java b/app/core/src/main/java/com/fsck/k9/activity/misc/Attachment.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/misc/Attachment.java
rename to app/core/src/main/java/com/fsck/k9/activity/misc/Attachment.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/misc/ContactPictureLoader.java b/app/core/src/main/java/com/fsck/k9/activity/misc/ContactPictureLoader.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/misc/ContactPictureLoader.java
rename to app/core/src/main/java/com/fsck/k9/activity/misc/ContactPictureLoader.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/misc/ExtendedAsyncTask.java b/app/core/src/main/java/com/fsck/k9/activity/misc/ExtendedAsyncTask.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/misc/ExtendedAsyncTask.java
rename to app/core/src/main/java/com/fsck/k9/activity/misc/ExtendedAsyncTask.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/misc/NonConfigurationInstance.java b/app/core/src/main/java/com/fsck/k9/activity/misc/NonConfigurationInstance.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/misc/NonConfigurationInstance.java
rename to app/core/src/main/java/com/fsck/k9/activity/misc/NonConfigurationInstance.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/misc/SwipeGestureDetector.java b/app/core/src/main/java/com/fsck/k9/activity/misc/SwipeGestureDetector.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/misc/SwipeGestureDetector.java
rename to app/core/src/main/java/com/fsck/k9/activity/misc/SwipeGestureDetector.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupAccountType.java b/app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupAccountType.java
similarity index 91%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupAccountType.java
rename to app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupAccountType.java
index fab53f933..2866e66c1 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupAccountType.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupAccountType.java
@@ -10,7 +10,7 @@ import android.view.View.OnClickListener;
 import android.widget.Toast;
 import com.fsck.k9.Account;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.K9Activity;
 import com.fsck.k9.helper.EmailHelper;
 import com.fsck.k9.mail.ServerSettings.Type;
@@ -101,19 +101,13 @@ public class AccountSetupAccountType extends K9Activity implements OnClickListen
 
     public void onClick(View v) {
         try {
-            switch (v.getId()) {
-                case R.id.pop: {
-                    setupStoreAndSmtpTransport(POP3, "pop3+ssl+");
-                    break;
-                }
-                case R.id.imap: {
-                    setupStoreAndSmtpTransport(IMAP, "imap+ssl+");
-                    break;
-                }
-                case R.id.webdav: {
-                    setupDav();
-                    break;
-                }
+            int id = v.getId();
+            if (id == R.id.pop) {
+                setupStoreAndSmtpTransport(POP3, "pop3+ssl+");
+            } else if (id == R.id.imap) {
+                setupStoreAndSmtpTransport(IMAP, "imap+ssl+");
+            } else if (id == R.id.webdav) {
+                setupDav();
             }
         } catch (Exception ex) {
             failure(ex);
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupBasics.java b/app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupBasics.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupBasics.java
rename to app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupBasics.java
index bed1ed57e..ec8fbedc1 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupBasics.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupBasics.java
@@ -28,7 +28,7 @@ import com.fsck.k9.Account;
 import com.fsck.k9.EmailAddressValidator;
 import com.fsck.k9.K9;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.account.AccountCreator;
 import com.fsck.k9.activity.K9Activity;
 import com.fsck.k9.activity.setup.AccountSetupCheckSettings.CheckDirection;
@@ -420,13 +420,11 @@ public class AccountSetupBasics extends K9Activity
     }
 
     public void onClick(View v) {
-        switch (v.getId()) {
-        case R.id.next:
+        int id = v.getId();
+        if (id == R.id.next) {
             onNext();
-            break;
-        case R.id.manual_setup:
+        } else if (id == R.id.manual_setup) {
             onManualSetup();
-            break;
         }
     }
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupCheckSettings.java b/app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupCheckSettings.java
similarity index 95%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupCheckSettings.java
rename to app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupCheckSettings.java
index 9d94d09fd..6d5844d1c 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupCheckSettings.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupCheckSettings.java
@@ -30,7 +30,7 @@ import com.fsck.k9.Account;
 import com.fsck.k9.DI;
 import com.fsck.k9.K9;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.K9Activity;
 import com.fsck.k9.controller.MessagingController;
 import com.fsck.k9.fragment.ConfirmationDialogFragment;
@@ -318,10 +318,8 @@ public class AccountSetupCheckSettings extends K9Activity implements OnClickList
     }
 
     public void onClick(View v) {
-        switch (v.getId()) {
-        case R.id.cancel:
+        if (v.getId() == R.id.cancel) {
             onCancel();
-            break;
         }
     }
 
@@ -340,19 +338,15 @@ public class AccountSetupCheckSettings extends K9Activity implements OnClickList
         mProgressBar.setIndeterminate(false);
 
         DialogFragment fragment;
-        switch (dialogId) {
-            case R.id.dialog_account_setup_error: {
-                fragment = ConfirmationDialogFragment.newInstance(dialogId,
-                        getString(R.string.account_setup_failed_dlg_title),
-                        customMessage,
-                        getString(R.string.account_setup_failed_dlg_edit_details_action),
-                        getString(R.string.account_setup_failed_dlg_continue_action)
-                );
-                break;
-            }
-            default: {
-                throw new RuntimeException("Called showDialog(int) with unknown dialog id.");
-            }
+        if (dialogId == R.id.dialog_account_setup_error) {
+            fragment = ConfirmationDialogFragment.newInstance(dialogId,
+                    getString(R.string.account_setup_failed_dlg_title),
+                    customMessage,
+                    getString(R.string.account_setup_failed_dlg_edit_details_action),
+                    getString(R.string.account_setup_failed_dlg_continue_action)
+            );
+        } else {
+            throw new RuntimeException("Called showDialog(int) with unknown dialog id.");
         }
 
         FragmentTransaction ta = getSupportFragmentManager().beginTransaction();
@@ -370,23 +364,17 @@ public class AccountSetupCheckSettings extends K9Activity implements OnClickList
 
     @Override
     public void doPositiveClick(int dialogId) {
-        switch (dialogId) {
-            case R.id.dialog_account_setup_error: {
-                finish();
-                break;
-            }
+        if (dialogId == R.id.dialog_account_setup_error) {
+            finish();
         }
     }
 
     @Override
     public void doNegativeClick(int dialogId) {
-        switch (dialogId) {
-            case R.id.dialog_account_setup_error: {
-                mCanceled = false;
-                setResult(RESULT_OK);
-                finish();
-                break;
-            }
+        if (dialogId == R.id.dialog_account_setup_error) {
+            mCanceled = false;
+            setResult(RESULT_OK);
+            finish();
         }
     }
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupComposition.java b/app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupComposition.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupComposition.java
rename to app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupComposition.java
index 44c2089bd..7ce0d545a 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupComposition.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupComposition.java
@@ -11,7 +11,7 @@ import android.widget.LinearLayout;
 import android.widget.RadioButton;
 import com.fsck.k9.Account;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.K9Activity;
 
 public class AccountSetupComposition extends K9Activity {
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupIncoming.java b/app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupIncoming.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupIncoming.java
rename to app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupIncoming.java
index ad1950177..f27f50d93 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupIncoming.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupIncoming.java
@@ -31,7 +31,7 @@ import com.fsck.k9.Account;
 import com.fsck.k9.Account.FolderMode;
 import com.fsck.k9.DI;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.account.AccountCreator;
 import com.fsck.k9.activity.K9Activity;
 import com.fsck.k9.activity.setup.AccountSetupCheckSettings.CheckDirection;
@@ -606,10 +606,8 @@ public class AccountSetupIncoming extends K9Activity implements OnClickListener
 
     public void onClick(View v) {
         try {
-            switch (v.getId()) {
-            case R.id.next:
+            if (v.getId() == R.id.next) {
                 onNext();
-                break;
             }
         } catch (Exception e) {
             failure(e);
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupNames.java b/app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupNames.java
similarity index 96%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupNames.java
rename to app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupNames.java
index 61702c52f..a03334703 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupNames.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupNames.java
@@ -1,6 +1,7 @@
 
 package com.fsck.k9.activity.setup;
 
+
 import android.content.Context;
 import android.content.Intent;
 import android.os.Bundle;
@@ -12,9 +13,12 @@ import android.view.View;
 import android.view.View.OnClickListener;
 import android.widget.Button;
 import android.widget.EditText;
-import com.fsck.k9.*;
+
+import com.fsck.k9.Account;
+import com.fsck.k9.Preferences;
 import com.fsck.k9.activity.Accounts;
 import com.fsck.k9.activity.K9Activity;
+import com.fsck.k9.core.R;
 import com.fsck.k9.helper.Utility;
 
 public class AccountSetupNames extends K9Activity implements OnClickListener {
@@ -91,10 +95,8 @@ public class AccountSetupNames extends K9Activity implements OnClickListener {
     }
 
     public void onClick(View v) {
-        switch (v.getId()) {
-        case R.id.done:
+        if (v.getId() == R.id.done) {
             onNext();
-            break;
         }
     }
 }
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupOptions.java b/app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupOptions.java
similarity index 98%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupOptions.java
rename to app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupOptions.java
index 3814ca725..737c8f00f 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupOptions.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupOptions.java
@@ -15,7 +15,7 @@ import com.fsck.k9.Account;
 import com.fsck.k9.DI;
 import com.fsck.k9.K9;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.K9Activity;
 import com.fsck.k9.controller.MessagingController;
 
@@ -154,10 +154,8 @@ public class AccountSetupOptions extends K9Activity implements OnClickListener {
     }
 
     public void onClick(View v) {
-        switch (v.getId()) {
-        case R.id.next:
+        if (v.getId() == R.id.next) {
             onDone();
-            break;
         }
     }
 }
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupOutgoing.java b/app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupOutgoing.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupOutgoing.java
rename to app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupOutgoing.java
index 5d2399142..715bb9d25 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/AccountSetupOutgoing.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/setup/AccountSetupOutgoing.java
@@ -27,7 +27,7 @@ import android.widget.Toast;
 
 import com.fsck.k9.Account;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.account.AccountCreator;
 import com.fsck.k9.activity.K9Activity;
 import com.fsck.k9.activity.setup.AccountSetupCheckSettings.CheckDirection;
@@ -491,10 +491,8 @@ public class AccountSetupOutgoing extends K9Activity implements OnClickListener,
     }
 
     public void onClick(View v) {
-        switch (v.getId()) {
-        case R.id.next:
+        if (v.getId() == R.id.next) {
             onNext();
-            break;
         }
     }
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/AuthTypeAdapter.java b/app/core/src/main/java/com/fsck/k9/activity/setup/AuthTypeAdapter.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/setup/AuthTypeAdapter.java
rename to app/core/src/main/java/com/fsck/k9/activity/setup/AuthTypeAdapter.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/AuthTypeHolder.java b/app/core/src/main/java/com/fsck/k9/activity/setup/AuthTypeHolder.java
similarity index 98%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/setup/AuthTypeHolder.java
rename to app/core/src/main/java/com/fsck/k9/activity/setup/AuthTypeHolder.java
index 6b81ddc46..0872a5ae1 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/AuthTypeHolder.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/setup/AuthTypeHolder.java
@@ -2,7 +2,7 @@ package com.fsck.k9.activity.setup;
 
 import android.content.res.Resources;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.mail.AuthType;
 
 class AuthTypeHolder {
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/ConnectionSecurityAdapter.java b/app/core/src/main/java/com/fsck/k9/activity/setup/ConnectionSecurityAdapter.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/setup/ConnectionSecurityAdapter.java
rename to app/core/src/main/java/com/fsck/k9/activity/setup/ConnectionSecurityAdapter.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/ConnectionSecurityHolder.java b/app/core/src/main/java/com/fsck/k9/activity/setup/ConnectionSecurityHolder.java
similarity index 97%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/setup/ConnectionSecurityHolder.java
rename to app/core/src/main/java/com/fsck/k9/activity/setup/ConnectionSecurityHolder.java
index d9afa6d87..a696c4b0c 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/ConnectionSecurityHolder.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/setup/ConnectionSecurityHolder.java
@@ -2,7 +2,7 @@ package com.fsck.k9.activity.setup;
 
 import android.content.res.Resources;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.mail.ConnectionSecurity;
 
 class ConnectionSecurityHolder {
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/FolderSettings.java b/app/core/src/main/java/com/fsck/k9/activity/setup/FolderSettings.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/setup/FolderSettings.java
rename to app/core/src/main/java/com/fsck/k9/activity/setup/FolderSettings.java
index 50911f4eb..7982c910f 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/FolderSettings.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/setup/FolderSettings.java
@@ -12,7 +12,7 @@ import android.preference.Preference;
 import com.fsck.k9.Account;
 import com.fsck.k9.DI;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.FolderInfoHolder;
 import com.fsck.k9.activity.K9PreferenceActivity;
 import com.fsck.k9.controller.MessagingController;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/FontSizeSettings.java b/app/core/src/main/java/com/fsck/k9/activity/setup/FontSizeSettings.java
similarity index 98%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/setup/FontSizeSettings.java
rename to app/core/src/main/java/com/fsck/k9/activity/setup/FontSizeSettings.java
index c688b6bb1..70b7699b2 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/FontSizeSettings.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/setup/FontSizeSettings.java
@@ -1,11 +1,17 @@
 package com.fsck.k9.activity.setup;
 
+
 import android.content.Context;
 import android.content.Intent;
 import android.os.Bundle;
-import android.preference.*;
-import com.fsck.k9.*;
+import android.preference.ListPreference;
+import android.preference.Preference;
+
+import com.fsck.k9.FontSizes;
+import com.fsck.k9.K9;
+import com.fsck.k9.Preferences;
 import com.fsck.k9.activity.K9PreferenceActivity;
+import com.fsck.k9.core.R;
 import com.fsck.k9.preferences.Storage;
 import com.fsck.k9.preferences.StorageEditor;
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/SliderPreference.java b/app/core/src/main/java/com/fsck/k9/activity/setup/SliderPreference.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/setup/SliderPreference.java
rename to app/core/src/main/java/com/fsck/k9/activity/setup/SliderPreference.java
index cf84b352d..94fbe025b 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/SliderPreference.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/setup/SliderPreference.java
@@ -24,6 +24,7 @@
 
 package com.fsck.k9.activity.setup;
 
+
 import android.content.Context;
 import android.content.res.TypedArray;
 import android.os.Bundle;
@@ -33,7 +34,8 @@ import android.support.annotation.ArrayRes;
 import android.util.AttributeSet;
 import android.view.View;
 import android.widget.SeekBar;
-import com.fsck.k9.*;
+
+import com.fsck.k9.core.R;
 
 
 /**
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/SpinnerOption.java b/app/core/src/main/java/com/fsck/k9/activity/setup/SpinnerOption.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/setup/SpinnerOption.java
rename to app/core/src/main/java/com/fsck/k9/activity/setup/SpinnerOption.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/WelcomeMessage.java b/app/core/src/main/java/com/fsck/k9/activity/setup/WelcomeMessage.java
similarity index 78%
rename from app/k9mail/src/main/java/com/fsck/k9/activity/setup/WelcomeMessage.java
rename to app/core/src/main/java/com/fsck/k9/activity/setup/WelcomeMessage.java
index 34c92cc1a..575bafdc5 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/activity/setup/WelcomeMessage.java
+++ b/app/core/src/main/java/com/fsck/k9/activity/setup/WelcomeMessage.java
@@ -8,7 +8,7 @@ import android.view.View;
 import android.view.View.OnClickListener;
 import android.widget.TextView;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.Accounts;
 import com.fsck.k9.activity.K9Activity;
 import com.fsck.k9.message.html.HtmlConverter;
@@ -38,17 +38,13 @@ public class WelcomeMessage extends K9Activity implements OnClickListener{
 
     @Override
     public void onClick(View view) {
-        switch (view.getId()) {
-            case R.id.next: {
-                AccountSetupBasics.actionNewAccount(this);
-                finish();
-                break;
-            }
-            case R.id.import_settings: {
-                Accounts.importSettings(this);
-                finish();
-                break;
-            }
+        int id = view.getId();
+        if (id == R.id.next) {
+            AccountSetupBasics.actionNewAccount(this);
+            finish();
+        } else if (id == R.id.import_settings) {
+            Accounts.importSettings(this);
+            finish();
         }
     }
 }
diff --git a/app/k9mail/src/main/java/com/fsck/k9/autocrypt/AutocryptGossipHeader.java b/app/core/src/main/java/com/fsck/k9/autocrypt/AutocryptGossipHeader.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/autocrypt/AutocryptGossipHeader.java
rename to app/core/src/main/java/com/fsck/k9/autocrypt/AutocryptGossipHeader.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/autocrypt/AutocryptGossipHeaderParser.java b/app/core/src/main/java/com/fsck/k9/autocrypt/AutocryptGossipHeaderParser.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/autocrypt/AutocryptGossipHeaderParser.java
rename to app/core/src/main/java/com/fsck/k9/autocrypt/AutocryptGossipHeaderParser.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/autocrypt/AutocryptHeader.java b/app/core/src/main/java/com/fsck/k9/autocrypt/AutocryptHeader.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/autocrypt/AutocryptHeader.java
rename to app/core/src/main/java/com/fsck/k9/autocrypt/AutocryptHeader.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/autocrypt/AutocryptHeaderParser.java b/app/core/src/main/java/com/fsck/k9/autocrypt/AutocryptHeaderParser.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/autocrypt/AutocryptHeaderParser.java
rename to app/core/src/main/java/com/fsck/k9/autocrypt/AutocryptHeaderParser.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/autocrypt/AutocryptOpenPgpApiInteractor.java b/app/core/src/main/java/com/fsck/k9/autocrypt/AutocryptOpenPgpApiInteractor.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/autocrypt/AutocryptOpenPgpApiInteractor.java
rename to app/core/src/main/java/com/fsck/k9/autocrypt/AutocryptOpenPgpApiInteractor.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/autocrypt/AutocryptOperations.java b/app/core/src/main/java/com/fsck/k9/autocrypt/AutocryptOperations.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/autocrypt/AutocryptOperations.java
rename to app/core/src/main/java/com/fsck/k9/autocrypt/AutocryptOperations.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/autocrypt/AutocryptTransferMessageCreator.kt b/app/core/src/main/java/com/fsck/k9/autocrypt/AutocryptTransferMessageCreator.kt
similarity index 98%
rename from app/k9mail/src/main/java/com/fsck/k9/autocrypt/AutocryptTransferMessageCreator.kt
rename to app/core/src/main/java/com/fsck/k9/autocrypt/AutocryptTransferMessageCreator.kt
index ff23da301..d62c2ac6a 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/autocrypt/AutocryptTransferMessageCreator.kt
+++ b/app/core/src/main/java/com/fsck/k9/autocrypt/AutocryptTransferMessageCreator.kt
@@ -6,7 +6,7 @@ import java.util.Date
 import android.content.res.Resources
 
 import com.fsck.k9.K9
-import com.fsck.k9.R
+import com.fsck.k9.core.R
 import com.fsck.k9.mail.Address
 import com.fsck.k9.mail.Flag
 import com.fsck.k9.mail.Message
diff --git a/app/k9mail/src/main/java/com/fsck/k9/autocrypt/KoinModule.kt b/app/core/src/main/java/com/fsck/k9/autocrypt/KoinModule.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/autocrypt/KoinModule.kt
rename to app/core/src/main/java/com/fsck/k9/autocrypt/KoinModule.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/backend/BackendFactory.kt b/app/core/src/main/java/com/fsck/k9/backend/BackendFactory.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/backend/BackendFactory.kt
rename to app/core/src/main/java/com/fsck/k9/backend/BackendFactory.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/backend/BackendManager.kt b/app/core/src/main/java/com/fsck/k9/backend/BackendManager.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/backend/BackendManager.kt
rename to app/core/src/main/java/com/fsck/k9/backend/BackendManager.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/backend/ImapBackendFactory.kt b/app/core/src/main/java/com/fsck/k9/backend/ImapBackendFactory.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/backend/ImapBackendFactory.kt
rename to app/core/src/main/java/com/fsck/k9/backend/ImapBackendFactory.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/backend/KoinModule.kt b/app/core/src/main/java/com/fsck/k9/backend/KoinModule.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/backend/KoinModule.kt
rename to app/core/src/main/java/com/fsck/k9/backend/KoinModule.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/backend/Pop3BackendFactory.kt b/app/core/src/main/java/com/fsck/k9/backend/Pop3BackendFactory.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/backend/Pop3BackendFactory.kt
rename to app/core/src/main/java/com/fsck/k9/backend/Pop3BackendFactory.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/backend/WebDavBackendFactory.kt b/app/core/src/main/java/com/fsck/k9/backend/WebDavBackendFactory.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/backend/WebDavBackendFactory.kt
rename to app/core/src/main/java/com/fsck/k9/backend/WebDavBackendFactory.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/cache/EmailProviderCache.java b/app/core/src/main/java/com/fsck/k9/cache/EmailProviderCache.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/cache/EmailProviderCache.java
rename to app/core/src/main/java/com/fsck/k9/cache/EmailProviderCache.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/cache/EmailProviderCacheCursor.java b/app/core/src/main/java/com/fsck/k9/cache/EmailProviderCacheCursor.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/cache/EmailProviderCacheCursor.java
rename to app/core/src/main/java/com/fsck/k9/cache/EmailProviderCacheCursor.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/cache/TemporaryAttachmentStore.java b/app/core/src/main/java/com/fsck/k9/cache/TemporaryAttachmentStore.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/cache/TemporaryAttachmentStore.java
rename to app/core/src/main/java/com/fsck/k9/cache/TemporaryAttachmentStore.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/controller/AccountStatsCollector.kt b/app/core/src/main/java/com/fsck/k9/controller/AccountStatsCollector.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/controller/AccountStatsCollector.kt
rename to app/core/src/main/java/com/fsck/k9/controller/AccountStatsCollector.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/controller/MemorizingMessagingListener.java b/app/core/src/main/java/com/fsck/k9/controller/MemorizingMessagingListener.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/controller/MemorizingMessagingListener.java
rename to app/core/src/main/java/com/fsck/k9/controller/MemorizingMessagingListener.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/controller/MessagingController.java b/app/core/src/main/java/com/fsck/k9/controller/MessagingController.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/controller/MessagingController.java
rename to app/core/src/main/java/com/fsck/k9/controller/MessagingController.java
index 7e3acd025..129c4d72f 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/controller/MessagingController.java
+++ b/app/core/src/main/java/com/fsck/k9/controller/MessagingController.java
@@ -36,12 +36,12 @@ import com.fsck.k9.Account;
 import com.fsck.k9.Account.DeletePolicy;
 import com.fsck.k9.Account.Expunge;
 import com.fsck.k9.AccountStats;
-import com.fsck.k9.BuildConfig;
+import com.fsck.k9.core.BuildConfig;
 import com.fsck.k9.DI;
 import com.fsck.k9.K9;
 import com.fsck.k9.K9.Intents;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.ActivityListener;
 import com.fsck.k9.activity.MessageReference;
 import com.fsck.k9.activity.setup.AccountSetupCheckSettings.CheckDirection;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/controller/MessagingControllerCommands.java b/app/core/src/main/java/com/fsck/k9/controller/MessagingControllerCommands.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/controller/MessagingControllerCommands.java
rename to app/core/src/main/java/com/fsck/k9/controller/MessagingControllerCommands.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/controller/MessagingControllerPushReceiver.java b/app/core/src/main/java/com/fsck/k9/controller/MessagingControllerPushReceiver.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/controller/MessagingControllerPushReceiver.java
rename to app/core/src/main/java/com/fsck/k9/controller/MessagingControllerPushReceiver.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/controller/MessagingListener.java b/app/core/src/main/java/com/fsck/k9/controller/MessagingListener.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/controller/MessagingListener.java
rename to app/core/src/main/java/com/fsck/k9/controller/MessagingListener.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/controller/PendingCommandSerializer.java b/app/core/src/main/java/com/fsck/k9/controller/PendingCommandSerializer.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/controller/PendingCommandSerializer.java
rename to app/core/src/main/java/com/fsck/k9/controller/PendingCommandSerializer.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/controller/ProgressBodyFactory.java b/app/core/src/main/java/com/fsck/k9/controller/ProgressBodyFactory.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/controller/ProgressBodyFactory.java
rename to app/core/src/main/java/com/fsck/k9/controller/ProgressBodyFactory.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/controller/SimpleMessagingListener.java b/app/core/src/main/java/com/fsck/k9/controller/SimpleMessagingListener.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/controller/SimpleMessagingListener.java
rename to app/core/src/main/java/com/fsck/k9/controller/SimpleMessagingListener.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/controller/UidReverseComparator.java b/app/core/src/main/java/com/fsck/k9/controller/UidReverseComparator.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/controller/UidReverseComparator.java
rename to app/core/src/main/java/com/fsck/k9/controller/UidReverseComparator.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/controller/UnavailableAccountException.java b/app/core/src/main/java/com/fsck/k9/controller/UnavailableAccountException.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/controller/UnavailableAccountException.java
rename to app/core/src/main/java/com/fsck/k9/controller/UnavailableAccountException.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/crypto/KoinModule.kt b/app/core/src/main/java/com/fsck/k9/crypto/KoinModule.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/crypto/KoinModule.kt
rename to app/core/src/main/java/com/fsck/k9/crypto/KoinModule.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/crypto/MessageCryptoStructureDetector.java b/app/core/src/main/java/com/fsck/k9/crypto/MessageCryptoStructureDetector.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/crypto/MessageCryptoStructureDetector.java
rename to app/core/src/main/java/com/fsck/k9/crypto/MessageCryptoStructureDetector.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/crypto/OpenPgpApiHelper.java b/app/core/src/main/java/com/fsck/k9/crypto/OpenPgpApiHelper.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/crypto/OpenPgpApiHelper.java
rename to app/core/src/main/java/com/fsck/k9/crypto/OpenPgpApiHelper.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/fragment/AttachmentDownloadDialogFragment.java b/app/core/src/main/java/com/fsck/k9/fragment/AttachmentDownloadDialogFragment.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/fragment/AttachmentDownloadDialogFragment.java
rename to app/core/src/main/java/com/fsck/k9/fragment/AttachmentDownloadDialogFragment.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/fragment/ConfirmationDialogFragment.java b/app/core/src/main/java/com/fsck/k9/fragment/ConfirmationDialogFragment.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/fragment/ConfirmationDialogFragment.java
rename to app/core/src/main/java/com/fsck/k9/fragment/ConfirmationDialogFragment.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/fragment/MLFProjectionInfo.java b/app/core/src/main/java/com/fsck/k9/fragment/MLFProjectionInfo.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/fragment/MLFProjectionInfo.java
rename to app/core/src/main/java/com/fsck/k9/fragment/MLFProjectionInfo.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/fragment/MessageListAdapter.java b/app/core/src/main/java/com/fsck/k9/fragment/MessageListAdapter.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/fragment/MessageListAdapter.java
rename to app/core/src/main/java/com/fsck/k9/fragment/MessageListAdapter.java
index 7ba398a82..54dd2c25d 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/fragment/MessageListAdapter.java
+++ b/app/core/src/main/java/com/fsck/k9/fragment/MessageListAdapter.java
@@ -21,7 +21,7 @@ import android.widget.TextView;
 import com.fsck.k9.Account;
 import com.fsck.k9.FontSizes;
 import com.fsck.k9.K9;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.helper.Utility;
 import com.fsck.k9.mail.Address;
 import com.fsck.k9.mailstore.DatabasePreviewType;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/fragment/MessageListFragment.java b/app/core/src/main/java/com/fsck/k9/fragment/MessageListFragment.java
similarity index 92%
rename from app/k9mail/src/main/java/com/fsck/k9/fragment/MessageListFragment.java
rename to app/core/src/main/java/com/fsck/k9/fragment/MessageListFragment.java
index fcc4389ed..90835d919 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/fragment/MessageListFragment.java
+++ b/app/core/src/main/java/com/fsck/k9/fragment/MessageListFragment.java
@@ -52,10 +52,10 @@ import android.widget.Toast;
 
 import com.fsck.k9.Account;
 import com.fsck.k9.Account.SortType;
-import com.fsck.k9.BuildConfig;
+import com.fsck.k9.core.BuildConfig;
 import com.fsck.k9.K9;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.ActivityListener;
 import com.fsck.k9.activity.ChooseFolder;
 import com.fsck.k9.activity.FolderInfoHolder;
@@ -959,49 +959,41 @@ public class MessageListFragment extends Fragment implements OnItemClickListener
 
     private void showDialog(int dialogId) {
         DialogFragment fragment;
-        switch (dialogId) {
-            case R.id.dialog_confirm_spam: {
-                String title = getString(R.string.dialog_confirm_spam_title);
+        if (dialogId == R.id.dialog_confirm_spam) {
+            String title = getString(R.string.dialog_confirm_spam_title);
 
-                int selectionSize = activeMessages.size();
-                String message = getResources().getQuantityString(
-                        R.plurals.dialog_confirm_spam_message, selectionSize, selectionSize);
+            int selectionSize = activeMessages.size();
+            String message = getResources().getQuantityString(
+                    R.plurals.dialog_confirm_spam_message, selectionSize, selectionSize);
 
-                String confirmText = getString(R.string.dialog_confirm_spam_confirm_button);
-                String cancelText = getString(R.string.dialog_confirm_spam_cancel_button);
+            String confirmText = getString(R.string.dialog_confirm_spam_confirm_button);
+            String cancelText = getString(R.string.dialog_confirm_spam_cancel_button);
 
-                fragment = ConfirmationDialogFragment.newInstance(dialogId, title, message,
-                        confirmText, cancelText);
-                break;
-            }
-            case R.id.dialog_confirm_delete: {
-                String title = getString(R.string.dialog_confirm_delete_title);
+            fragment = ConfirmationDialogFragment.newInstance(dialogId, title, message,
+                    confirmText, cancelText);
+        } else if (dialogId == R.id.dialog_confirm_delete) {
+            String title = getString(R.string.dialog_confirm_delete_title);
 
-                int selectionSize = activeMessages.size();
-                String message = getResources().getQuantityString(
-                        R.plurals.dialog_confirm_delete_messages, selectionSize,
-                        selectionSize);
+            int selectionSize = activeMessages.size();
+            String message = getResources().getQuantityString(
+                    R.plurals.dialog_confirm_delete_messages, selectionSize,
+                    selectionSize);
 
-                String confirmText = getString(R.string.dialog_confirm_delete_confirm_button);
-                String cancelText = getString(R.string.dialog_confirm_delete_cancel_button);
+            String confirmText = getString(R.string.dialog_confirm_delete_confirm_button);
+            String cancelText = getString(R.string.dialog_confirm_delete_cancel_button);
 
-                fragment = ConfirmationDialogFragment.newInstance(dialogId, title, message,
-                        confirmText, cancelText);
-                break;
-            }
-            case R.id.dialog_confirm_mark_all_as_read: {
-                String title = getString(R.string.dialog_confirm_mark_all_as_read_title);
-                String message = getString(R.string.dialog_confirm_mark_all_as_read_message);
+            fragment = ConfirmationDialogFragment.newInstance(dialogId, title, message,
+                    confirmText, cancelText);
+        } else if (dialogId == R.id.dialog_confirm_mark_all_as_read) {
+            String title = getString(R.string.dialog_confirm_mark_all_as_read_title);
+            String message = getString(R.string.dialog_confirm_mark_all_as_read_message);
 
-                String confirmText = getString(R.string.dialog_confirm_mark_all_as_read_confirm_button);
-                String cancelText = getString(R.string.dialog_confirm_mark_all_as_read_cancel_button);
+            String confirmText = getString(R.string.dialog_confirm_mark_all_as_read_confirm_button);
+            String cancelText = getString(R.string.dialog_confirm_mark_all_as_read_cancel_button);
 
-                fragment = ConfirmationDialogFragment.newInstance(dialogId, title, message, confirmText, cancelText);
-                break;
-            }
-            default: {
-                throw new RuntimeException("Called showDialog(int) with unknown dialog id.");
-            }
+            fragment = ConfirmationDialogFragment.newInstance(dialogId, title, message, confirmText, cancelText);
+        } else {
+            throw new RuntimeException("Called showDialog(int) with unknown dialog id.");
         }
 
         fragment.setTargetFragment(this, dialogId);
@@ -1014,41 +1006,32 @@ public class MessageListFragment extends Fragment implements OnItemClickListener
 
     @Override
     public boolean onOptionsItemSelected(MenuItem item) {
-        int itemId = item.getItemId();
-        switch (itemId) {
-        case R.id.set_sort_date: {
+        int id = item.getItemId();
+        if (id == R.id.set_sort_date) {
             changeSort(SortType.SORT_DATE);
             return true;
-        }
-        case R.id.set_sort_arrival: {
+        } else if (id == R.id.set_sort_arrival) {
             changeSort(SortType.SORT_ARRIVAL);
             return true;
-        }
-        case R.id.set_sort_subject: {
+        } else if (id == R.id.set_sort_subject) {
             changeSort(SortType.SORT_SUBJECT);
             return true;
-        }
-        case R.id.set_sort_sender: {
+        } else if (id == R.id.set_sort_sender) {
             changeSort(SortType.SORT_SENDER);
             return true;
-        }
-        case R.id.set_sort_flag: {
+        } else if (id == R.id.set_sort_flag) {
             changeSort(SortType.SORT_FLAGGED);
             return true;
-        }
-        case R.id.set_sort_unread: {
+        } else if (id == R.id.set_sort_unread) {
             changeSort(SortType.SORT_UNREAD);
             return true;
-        }
-        case R.id.set_sort_attach: {
+        } else if (id == R.id.set_sort_attach) {
             changeSort(SortType.SORT_ATTACHMENT);
             return true;
-        }
-        case R.id.select_all: {
+        } else if (id == R.id.select_all) {
             selectAll();
             return true;
         }
-        }
 
         if (!singleAccountMode) {
             // None of the options after this point are "safe" for search results
@@ -1056,21 +1039,17 @@ public class MessageListFragment extends Fragment implements OnItemClickListener
             return false;
         }
 
-        switch (itemId) {
-        case R.id.send_messages: {
+        if (id == R.id.send_messages) {
             onSendPendingMessages();
             return true;
-        }
-        case R.id.expunge: {
+        } else if (id == R.id.expunge) {
             if (currentFolder != null) {
                 onExpunge(account, currentFolder.serverId);
             }
             return true;
-        }
-        default: {
+        } else {
             return super.onOptionsItemSelected(item);
         }
-        }
     }
 
     public void onSendPendingMessages() {
@@ -1088,86 +1067,47 @@ public class MessageListFragment extends Fragment implements OnItemClickListener
             return false;
         }
 
-        switch (item.getItemId()) {
-            case R.id.deselect:
-            case R.id.select: {
-                toggleMessageSelectWithAdapterPosition(adapterPosition);
-                break;
-            }
-            case R.id.reply: {
-                onReply(getMessageAtPosition(adapterPosition));
-                break;
-            }
-            case R.id.reply_all: {
-                onReplyAll(getMessageAtPosition(adapterPosition));
-                break;
-            }
-            case R.id.forward: {
-                onForward(getMessageAtPosition(adapterPosition));
-                break;
-            }
-            case R.id.forward_as_attachment: {
-                onForwardAsAttachment(getMessageAtPosition(adapterPosition));
-                break;
-            }
-            case R.id.send_again: {
-                onResendMessage(getMessageAtPosition(adapterPosition));
-                selectedCount = 0;
-                break;
-            }
-            case R.id.same_sender: {
-                Cursor cursor = (Cursor) adapter.getItem(adapterPosition);
-                String senderAddress = MlfUtils.getSenderAddressFromCursor(cursor);
-                if (senderAddress != null) {
-                    fragmentListener.showMoreFromSameSender(senderAddress);
-                }
-                break;
-            }
-            case R.id.delete: {
-                MessageReference message = getMessageAtPosition(adapterPosition);
-                onDelete(message);
-                break;
-            }
-            case R.id.mark_as_read: {
-                setFlag(adapterPosition, Flag.SEEN, true);
-                break;
-            }
-            case R.id.mark_as_unread: {
-                setFlag(adapterPosition, Flag.SEEN, false);
-                break;
-            }
-            case R.id.flag: {
-                setFlag(adapterPosition, Flag.FLAGGED, true);
-                break;
-            }
-            case R.id.unflag: {
-                setFlag(adapterPosition, Flag.FLAGGED, false);
-                break;
-            }
-
-            // only if the account supports this
-            case R.id.archive: {
-                onArchive(getMessageAtPosition(adapterPosition));
-                break;
-            }
-            case R.id.spam: {
-                onSpam(getMessageAtPosition(adapterPosition));
-                break;
-            }
-            case R.id.move: {
-                onMove(getMessageAtPosition(adapterPosition));
-                break;
-            }
-            case R.id.copy: {
-                onCopy(getMessageAtPosition(adapterPosition));
-                break;
-            }
-
-            // debug options
-            case R.id.debug_delete_locally: {
-                onDebugClearLocally(getMessageAtPosition(adapterPosition));
-                break;
-            }
+        int id = item.getItemId();
+        if (id == R.id.deselect || id == R.id.select) {
+            toggleMessageSelectWithAdapterPosition(adapterPosition);
+        } else if (id == R.id.reply) {
+            onReply(getMessageAtPosition(adapterPosition));
+        } else if (id == R.id.reply_all) {
+            onReplyAll(getMessageAtPosition(adapterPosition));
+        } else if (id == R.id.forward) {
+            onForward(getMessageAtPosition(adapterPosition));
+        } else if (id == R.id.forward_as_attachment) {
+            onForwardAsAttachment(getMessageAtPosition(adapterPosition));
+        } else if (id == R.id.send_again) {
+            onResendMessage(getMessageAtPosition(adapterPosition));
+            selectedCount = 0;
+        } else if (id == R.id.same_sender) {
+            Cursor cursor = (Cursor) adapter.getItem(adapterPosition);
+            String senderAddress = MlfUtils.getSenderAddressFromCursor(cursor);
+            if (senderAddress != null) {
+                fragmentListener.showMoreFromSameSender(senderAddress);
+            }
+        } else if (id == R.id.delete) {
+            MessageReference message = getMessageAtPosition(adapterPosition);
+            onDelete(message);
+        } else if (id == R.id.mark_as_read) {
+            setFlag(adapterPosition, Flag.SEEN, true);
+        } else if (id == R.id.mark_as_unread) {
+            setFlag(adapterPosition, Flag.SEEN, false);
+        } else if (id == R.id.flag) {
+            setFlag(adapterPosition, Flag.FLAGGED, true);
+        } else if (id == R.id.unflag) {
+            setFlag(adapterPosition, Flag.FLAGGED, false);
+        } else if (id == R.id.archive) {        // only if the account supports this
+            onArchive(getMessageAtPosition(adapterPosition));
+        } else if (id == R.id.spam) {
+            onSpam(getMessageAtPosition(adapterPosition));
+        } else if (id == R.id.move) {
+            onMove(getMessageAtPosition(adapterPosition));
+        } else if (id == R.id.copy) {
+            onCopy(getMessageAtPosition(adapterPosition));
+        } else if (id == R.id.debug_delete_locally) {       // debug options
+            onDebugClearLocally(getMessageAtPosition(adapterPosition));
         }
 
         contextMenuUniqueId = 0;
@@ -2109,56 +2049,35 @@ public class MessageListFragment extends Fragment implements OnItemClickListener
              *
              * This is the case currently so safe assumption.
              */
-            switch (item.getItemId()) {
-            case R.id.delete: {
+            int id = item.getItemId();
+            if (id == R.id.delete) {
                 List<MessageReference> messages = getCheckedMessages();
                 onDelete(messages);
                 selectedCount = 0;
-                break;
-            }
-            case R.id.mark_as_read: {
+            } else if (id == R.id.mark_as_read) {
                 setFlagForSelected(Flag.SEEN, true);
-                break;
-            }
-            case R.id.mark_as_unread: {
+            } else if (id == R.id.mark_as_unread) {
                 setFlagForSelected(Flag.SEEN, false);
-                break;
-            }
-            case R.id.flag: {
+            } else if (id == R.id.flag) {
                 setFlagForSelected(Flag.FLAGGED, true);
-                break;
-            }
-            case R.id.unflag: {
+            } else if (id == R.id.unflag) {
                 setFlagForSelected(Flag.FLAGGED, false);
-                break;
-            }
-            case R.id.select_all: {
+            } else if (id == R.id.select_all) {
                 selectAll();
-                break;
-            }
-
-            // only if the account supports this
-            case R.id.archive: {
+            } else if (id == R.id.archive) {    // only if the account supports this
                 onArchive(getCheckedMessages());
                 selectedCount = 0;
-                break;
-            }
-            case R.id.spam: {
+            } else if (id == R.id.spam) {
                 onSpam(getCheckedMessages());
                 selectedCount = 0;
-                break;
-            }
-            case R.id.move: {
+            } else if (id == R.id.move) {
                 onMove(getCheckedMessages());
                 selectedCount = 0;
-                break;
-            }
-            case R.id.copy: {
+            } else if (id == R.id.copy) {
                 onCopy(getCheckedMessages());
                 selectedCount = 0;
-                break;
-            }
             }
+
             if (selectedCount == 0) {
                 actionMode.finish();
             }
@@ -2169,34 +2088,23 @@ public class MessageListFragment extends Fragment implements OnItemClickListener
 
     @Override
     public void doPositiveClick(int dialogId) {
-        switch (dialogId) {
-            case R.id.dialog_confirm_spam: {
-                onSpamConfirmed(activeMessages);
-                // No further need for this reference
-                activeMessages = null;
-                break;
-            }
-            case R.id.dialog_confirm_delete: {
-                onDeleteConfirmed(activeMessages);
-                activeMessage = null;
-                break;
-            }
-            case R.id.dialog_confirm_mark_all_as_read: {
-                markAllAsRead();
-                break;
-            }
+        if (dialogId == R.id.dialog_confirm_spam) {
+            onSpamConfirmed(activeMessages);
+            // No further need for this reference
+            activeMessages = null;
+        } else if (dialogId == R.id.dialog_confirm_delete) {
+            onDeleteConfirmed(activeMessages);
+            activeMessage = null;
+        } else if (dialogId == R.id.dialog_confirm_mark_all_as_read) {
+            markAllAsRead();
         }
     }
 
     @Override
     public void doNegativeClick(int dialogId) {
-        switch (dialogId) {
-            case R.id.dialog_confirm_spam:
-            case R.id.dialog_confirm_delete: {
-                // No further need for this reference
-                activeMessages = null;
-                break;
-            }
+        if (dialogId == R.id.dialog_confirm_spam || dialogId == R.id.dialog_confirm_delete) {
+            // No further need for this reference
+            activeMessages = null;
         }
     }
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/fragment/MessageListFragmentComparators.java b/app/core/src/main/java/com/fsck/k9/fragment/MessageListFragmentComparators.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/fragment/MessageListFragmentComparators.java
rename to app/core/src/main/java/com/fsck/k9/fragment/MessageListFragmentComparators.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/fragment/MessageListHandler.java b/app/core/src/main/java/com/fsck/k9/fragment/MessageListHandler.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/fragment/MessageListHandler.java
rename to app/core/src/main/java/com/fsck/k9/fragment/MessageListHandler.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/fragment/MessageViewHolder.java b/app/core/src/main/java/com/fsck/k9/fragment/MessageViewHolder.java
similarity index 66%
rename from app/k9mail/src/main/java/com/fsck/k9/fragment/MessageViewHolder.java
rename to app/core/src/main/java/com/fsck/k9/fragment/MessageViewHolder.java
index 225e6233b..b38e9a8fb 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/fragment/MessageViewHolder.java
+++ b/app/core/src/main/java/com/fsck/k9/fragment/MessageViewHolder.java
@@ -5,7 +5,7 @@ import android.view.View;
 import android.widget.CheckBox;
 import android.widget.TextView;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.ui.ContactBadge;
 
 
@@ -30,14 +30,11 @@ public class MessageViewHolder implements View.OnClickListener {
     @Override
     public void onClick(View view) {
         if (position != -1) {
-            switch (view.getId()) {
-                case R.id.selected_checkbox:
-                    fragment.toggleMessageSelectWithAdapterPosition(position);
-                    break;
-                case R.id.flagged_bottom_right:
-                case R.id.flagged_center_right:
-                    fragment.toggleMessageFlagWithAdapterPosition(position);
-                    break;
+            int id = view.getId();
+            if (id == R.id.selected_checkbox) {
+                fragment.toggleMessageSelectWithAdapterPosition(position);
+            } else if (id == R.id.flagged_bottom_right || id == R.id.flagged_center_right) {
+                fragment.toggleMessageFlagWithAdapterPosition(position);
             }
         }
     }
diff --git a/app/k9mail/src/main/java/com/fsck/k9/fragment/MlfUtils.java b/app/core/src/main/java/com/fsck/k9/fragment/MlfUtils.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/fragment/MlfUtils.java
rename to app/core/src/main/java/com/fsck/k9/fragment/MlfUtils.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/fragment/ProgressDialogFragment.java b/app/core/src/main/java/com/fsck/k9/fragment/ProgressDialogFragment.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/fragment/ProgressDialogFragment.java
rename to app/core/src/main/java/com/fsck/k9/fragment/ProgressDialogFragment.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/ClipboardManager.java b/app/core/src/main/java/com/fsck/k9/helper/ClipboardManager.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/ClipboardManager.java
rename to app/core/src/main/java/com/fsck/k9/helper/ClipboardManager.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/ContactItem.java b/app/core/src/main/java/com/fsck/k9/helper/ContactItem.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/ContactItem.java
rename to app/core/src/main/java/com/fsck/k9/helper/ContactItem.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/ContactPicture.java b/app/core/src/main/java/com/fsck/k9/helper/ContactPicture.java
similarity index 96%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/ContactPicture.java
rename to app/core/src/main/java/com/fsck/k9/helper/ContactPicture.java
index cd3eb8fbf..1cddab9bb 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/helper/ContactPicture.java
+++ b/app/core/src/main/java/com/fsck/k9/helper/ContactPicture.java
@@ -4,7 +4,7 @@ import android.content.Context;
 import android.util.TypedValue;
 
 import com.fsck.k9.K9;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.misc.ContactPictureLoader;
 
 public class ContactPicture {
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/Contacts.java b/app/core/src/main/java/com/fsck/k9/helper/Contacts.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/Contacts.java
rename to app/core/src/main/java/com/fsck/k9/helper/Contacts.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/EmailHelper.java b/app/core/src/main/java/com/fsck/k9/helper/EmailHelper.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/EmailHelper.java
rename to app/core/src/main/java/com/fsck/k9/helper/EmailHelper.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/FileBrowserHelper.java b/app/core/src/main/java/com/fsck/k9/helper/FileBrowserHelper.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/FileBrowserHelper.java
rename to app/core/src/main/java/com/fsck/k9/helper/FileBrowserHelper.java
index 44e9fedf4..0c7545a7f 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/helper/FileBrowserHelper.java
+++ b/app/core/src/main/java/com/fsck/k9/helper/FileBrowserHelper.java
@@ -13,7 +13,7 @@ import android.text.InputType;
 import android.widget.EditText;
 
 import com.fsck.k9.K9;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 
 public class FileBrowserHelper {
     /**
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/FileHelper.java b/app/core/src/main/java/com/fsck/k9/helper/FileHelper.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/FileHelper.java
rename to app/core/src/main/java/com/fsck/k9/helper/FileHelper.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/IdentityHelper.java b/app/core/src/main/java/com/fsck/k9/helper/IdentityHelper.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/IdentityHelper.java
rename to app/core/src/main/java/com/fsck/k9/helper/IdentityHelper.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/K9AlarmManager.java b/app/core/src/main/java/com/fsck/k9/helper/K9AlarmManager.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/K9AlarmManager.java
rename to app/core/src/main/java/com/fsck/k9/helper/K9AlarmManager.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/MailTo.java b/app/core/src/main/java/com/fsck/k9/helper/MailTo.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/MailTo.java
rename to app/core/src/main/java/com/fsck/k9/helper/MailTo.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/MergeCursor.java b/app/core/src/main/java/com/fsck/k9/helper/MergeCursor.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/MergeCursor.java
rename to app/core/src/main/java/com/fsck/k9/helper/MergeCursor.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/MergeCursorWithUniqueId.java b/app/core/src/main/java/com/fsck/k9/helper/MergeCursorWithUniqueId.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/MergeCursorWithUniqueId.java
rename to app/core/src/main/java/com/fsck/k9/helper/MergeCursorWithUniqueId.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/MessageHelper.java b/app/core/src/main/java/com/fsck/k9/helper/MessageHelper.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/MessageHelper.java
rename to app/core/src/main/java/com/fsck/k9/helper/MessageHelper.java
index e2d1a2c69..b35bdc972 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/helper/MessageHelper.java
+++ b/app/core/src/main/java/com/fsck/k9/helper/MessageHelper.java
@@ -10,7 +10,7 @@ import android.text.style.ForegroundColorSpan;
 
 import com.fsck.k9.Account;
 import com.fsck.k9.K9;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.FolderInfoHolder;
 import com.fsck.k9.activity.MessageInfoHolder;
 import com.fsck.k9.mail.Address;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/NamedThreadFactory.kt b/app/core/src/main/java/com/fsck/k9/helper/NamedThreadFactory.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/NamedThreadFactory.kt
rename to app/core/src/main/java/com/fsck/k9/helper/NamedThreadFactory.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/ParcelableUtil.java b/app/core/src/main/java/com/fsck/k9/helper/ParcelableUtil.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/ParcelableUtil.java
rename to app/core/src/main/java/com/fsck/k9/helper/ParcelableUtil.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/Preconditions.java b/app/core/src/main/java/com/fsck/k9/helper/Preconditions.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/Preconditions.java
rename to app/core/src/main/java/com/fsck/k9/helper/Preconditions.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/ReplyToParser.java b/app/core/src/main/java/com/fsck/k9/helper/ReplyToParser.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/ReplyToParser.java
rename to app/core/src/main/java/com/fsck/k9/helper/ReplyToParser.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/RetainFragment.java b/app/core/src/main/java/com/fsck/k9/helper/RetainFragment.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/RetainFragment.java
rename to app/core/src/main/java/com/fsck/k9/helper/RetainFragment.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/SimpleTextWatcher.java b/app/core/src/main/java/com/fsck/k9/helper/SimpleTextWatcher.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/SimpleTextWatcher.java
rename to app/core/src/main/java/com/fsck/k9/helper/SimpleTextWatcher.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/SingleLiveEvent.java b/app/core/src/main/java/com/fsck/k9/helper/SingleLiveEvent.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/SingleLiveEvent.java
rename to app/core/src/main/java/com/fsck/k9/helper/SingleLiveEvent.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/SizeFormatter.java b/app/core/src/main/java/com/fsck/k9/helper/SizeFormatter.java
similarity index 96%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/SizeFormatter.java
rename to app/core/src/main/java/com/fsck/k9/helper/SizeFormatter.java
index 08c7f1a11..3e09e3cac 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/helper/SizeFormatter.java
+++ b/app/core/src/main/java/com/fsck/k9/helper/SizeFormatter.java
@@ -1,7 +1,7 @@
 package com.fsck.k9.helper;
 
 import android.content.Context;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 
 public class SizeFormatter {
     /*
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/StringHelper.kt b/app/core/src/main/java/com/fsck/k9/helper/StringHelper.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/StringHelper.kt
rename to app/core/src/main/java/com/fsck/k9/helper/StringHelper.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/UrlEncodingHelper.java b/app/core/src/main/java/com/fsck/k9/helper/UrlEncodingHelper.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/UrlEncodingHelper.java
rename to app/core/src/main/java/com/fsck/k9/helper/UrlEncodingHelper.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/Utility.java b/app/core/src/main/java/com/fsck/k9/helper/Utility.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/Utility.java
rename to app/core/src/main/java/com/fsck/k9/helper/Utility.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/jsoup/AdvancedNodeTraversor.java b/app/core/src/main/java/com/fsck/k9/helper/jsoup/AdvancedNodeTraversor.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/jsoup/AdvancedNodeTraversor.java
rename to app/core/src/main/java/com/fsck/k9/helper/jsoup/AdvancedNodeTraversor.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/helper/jsoup/NodeFilter.java b/app/core/src/main/java/com/fsck/k9/helper/jsoup/NodeFilter.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/helper/jsoup/NodeFilter.java
rename to app/core/src/main/java/com/fsck/k9/helper/jsoup/NodeFilter.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mail/TransportProvider.java b/app/core/src/main/java/com/fsck/k9/mail/TransportProvider.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mail/TransportProvider.java
rename to app/core/src/main/java/com/fsck/k9/mail/TransportProvider.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mail/TransportUris.java b/app/core/src/main/java/com/fsck/k9/mail/TransportUris.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mail/TransportUris.java
rename to app/core/src/main/java/com/fsck/k9/mail/TransportUris.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mail/store/RemoteStoreManager.java b/app/core/src/main/java/com/fsck/k9/mail/store/RemoteStoreManager.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mail/store/RemoteStoreManager.java
rename to app/core/src/main/java/com/fsck/k9/mail/store/RemoteStoreManager.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/AttachmentResolver.java b/app/core/src/main/java/com/fsck/k9/mailstore/AttachmentResolver.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/AttachmentResolver.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/AttachmentResolver.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/AttachmentViewInfo.java b/app/core/src/main/java/com/fsck/k9/mailstore/AttachmentViewInfo.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/AttachmentViewInfo.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/AttachmentViewInfo.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/BinaryAttachmentBody.java b/app/core/src/main/java/com/fsck/k9/mailstore/BinaryAttachmentBody.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/BinaryAttachmentBody.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/BinaryAttachmentBody.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/CryptoResultAnnotation.java b/app/core/src/main/java/com/fsck/k9/mailstore/CryptoResultAnnotation.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/CryptoResultAnnotation.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/CryptoResultAnnotation.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/DatabasePreviewType.java b/app/core/src/main/java/com/fsck/k9/mailstore/DatabasePreviewType.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/DatabasePreviewType.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/DatabasePreviewType.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/DeferredFileBody.java b/app/core/src/main/java/com/fsck/k9/mailstore/DeferredFileBody.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/DeferredFileBody.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/DeferredFileBody.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/FileBackedBody.java b/app/core/src/main/java/com/fsck/k9/mailstore/FileBackedBody.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/FileBackedBody.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/FileBackedBody.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/FolderRepository.kt b/app/core/src/main/java/com/fsck/k9/mailstore/FolderRepository.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/FolderRepository.kt
rename to app/core/src/main/java/com/fsck/k9/mailstore/FolderRepository.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/FolderRepositoryManager.kt b/app/core/src/main/java/com/fsck/k9/mailstore/FolderRepositoryManager.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/FolderRepositoryManager.kt
rename to app/core/src/main/java/com/fsck/k9/mailstore/FolderRepositoryManager.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/K9BackendFolder.kt b/app/core/src/main/java/com/fsck/k9/mailstore/K9BackendFolder.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/K9BackendFolder.kt
rename to app/core/src/main/java/com/fsck/k9/mailstore/K9BackendFolder.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/K9BackendStorage.kt b/app/core/src/main/java/com/fsck/k9/mailstore/K9BackendStorage.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/K9BackendStorage.kt
rename to app/core/src/main/java/com/fsck/k9/mailstore/K9BackendStorage.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/KoinModule.kt b/app/core/src/main/java/com/fsck/k9/mailstore/KoinModule.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/KoinModule.kt
rename to app/core/src/main/java/com/fsck/k9/mailstore/KoinModule.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/LocalBodyPart.java b/app/core/src/main/java/com/fsck/k9/mailstore/LocalBodyPart.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/LocalBodyPart.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/LocalBodyPart.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/LocalFolder.java b/app/core/src/main/java/com/fsck/k9/mailstore/LocalFolder.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/LocalFolder.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/LocalFolder.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/LocalMessage.java b/app/core/src/main/java/com/fsck/k9/mailstore/LocalMessage.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/LocalMessage.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/LocalMessage.java
index b45e56f48..5e701b1a1 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/mailstore/LocalMessage.java
+++ b/app/core/src/main/java/com/fsck/k9/mailstore/LocalMessage.java
@@ -12,7 +12,7 @@ import android.database.sqlite.SQLiteDatabase;
 import android.support.annotation.VisibleForTesting;
 
 import com.fsck.k9.Account;
-import com.fsck.k9.BuildConfig;
+import com.fsck.k9.core.BuildConfig;
 import com.fsck.k9.activity.MessageReference;
 import com.fsck.k9.mail.Address;
 import com.fsck.k9.mail.Flag;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/LocalMimeMessage.java b/app/core/src/main/java/com/fsck/k9/mailstore/LocalMimeMessage.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/LocalMimeMessage.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/LocalMimeMessage.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/LocalPart.java b/app/core/src/main/java/com/fsck/k9/mailstore/LocalPart.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/LocalPart.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/LocalPart.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/LocalStore.java b/app/core/src/main/java/com/fsck/k9/mailstore/LocalStore.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/LocalStore.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/LocalStore.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/LockableDatabase.java b/app/core/src/main/java/com/fsck/k9/mailstore/LockableDatabase.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/LockableDatabase.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/LockableDatabase.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/MessageHelper.java b/app/core/src/main/java/com/fsck/k9/mailstore/MessageHelper.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/MessageHelper.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/MessageHelper.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/MessageViewInfo.java b/app/core/src/main/java/com/fsck/k9/mailstore/MessageViewInfo.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/MessageViewInfo.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/MessageViewInfo.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/MessageViewInfoExtractor.java b/app/core/src/main/java/com/fsck/k9/mailstore/MessageViewInfoExtractor.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/MessageViewInfoExtractor.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/MessageViewInfoExtractor.java
index fa9d4d462..d8cf01b12 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/mailstore/MessageViewInfoExtractor.java
+++ b/app/core/src/main/java/com/fsck/k9/mailstore/MessageViewInfoExtractor.java
@@ -12,7 +12,7 @@ import android.support.annotation.VisibleForTesting;
 import android.support.annotation.WorkerThread;
 
 import com.fsck.k9.Globals;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.crypto.MessageCryptoStructureDetector;
 import com.fsck.k9.mail.Address;
 import com.fsck.k9.mail.Flag;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/MimePartStreamParser.java b/app/core/src/main/java/com/fsck/k9/mailstore/MimePartStreamParser.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/MimePartStreamParser.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/MimePartStreamParser.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/StorageManager.java b/app/core/src/main/java/com/fsck/k9/mailstore/StorageManager.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/StorageManager.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/StorageManager.java
index 5fa8dbb11..e506a71a3 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/mailstore/StorageManager.java
+++ b/app/core/src/main/java/com/fsck/k9/mailstore/StorageManager.java
@@ -18,7 +18,7 @@ import android.os.Environment;
 import timber.log.Timber;
 
 import com.fsck.k9.K9;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 
 /**
  * Manager for different {@link StorageProvider} -classes that abstract access
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/StoreSchemaDefinition.java b/app/core/src/main/java/com/fsck/k9/mailstore/StoreSchemaDefinition.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/StoreSchemaDefinition.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/StoreSchemaDefinition.java
index 00dd1bffd..c043f0872 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/mailstore/StoreSchemaDefinition.java
+++ b/app/core/src/main/java/com/fsck/k9/mailstore/StoreSchemaDefinition.java
@@ -8,7 +8,7 @@ import android.database.sqlite.SQLiteDatabase;
 import timber.log.Timber;
 
 import com.fsck.k9.Account;
-import com.fsck.k9.BuildConfig;
+import com.fsck.k9.core.BuildConfig;
 import com.fsck.k9.mail.Flag;
 import com.fsck.k9.mail.Folder;
 import com.fsck.k9.mailstore.migrations.Migrations;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/TempFileBody.java b/app/core/src/main/java/com/fsck/k9/mailstore/TempFileBody.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/TempFileBody.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/TempFileBody.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/ThreadInfo.java b/app/core/src/main/java/com/fsck/k9/mailstore/ThreadInfo.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/ThreadInfo.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/ThreadInfo.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/UnavailableStorageException.java b/app/core/src/main/java/com/fsck/k9/mailstore/UnavailableStorageException.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/UnavailableStorageException.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/UnavailableStorageException.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/FullTextIndexer.kt b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/FullTextIndexer.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/FullTextIndexer.kt
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/FullTextIndexer.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo30.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo30.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo30.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo30.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo31.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo31.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo31.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo31.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo32.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo32.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo32.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo32.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo33.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo33.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo33.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo33.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo34.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo34.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo34.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo34.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo35.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo35.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo35.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo35.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo36.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo36.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo36.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo36.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo37.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo37.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo37.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo37.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo39.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo39.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo39.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo39.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo40.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo40.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo40.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo40.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo41.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo41.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo41.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo41.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo42.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo42.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo42.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo42.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo43.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo43.java
similarity index 98%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo43.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo43.java
index 91731de51..4cfc1e2f0 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo43.java
+++ b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo43.java
@@ -9,7 +9,7 @@ import android.database.sqlite.SQLiteDatabase;
 import timber.log.Timber;
 
 import com.fsck.k9.Account;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.mail.Message;
 import com.fsck.k9.mailstore.LocalFolder;
 import com.fsck.k9.mailstore.LocalStore;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo44.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo44.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo44.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo44.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo45.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo45.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo45.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo45.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo46.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo46.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo46.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo46.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo47.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo47.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo47.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo47.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo48.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo48.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo48.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo48.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo49.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo49.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo49.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo49.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo50.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo50.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo50.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo50.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo51.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo51.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo51.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo51.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo52.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo52.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo52.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo52.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo53.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo53.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo53.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo53.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo54.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo54.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo54.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo54.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo55.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo55.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo55.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo55.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo56.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo56.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo56.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo56.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo57.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo57.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo57.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo57.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo58.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo58.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo58.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo58.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo59.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo59.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo59.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo59.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo60.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo60.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo60.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo60.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo61.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo61.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo61.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo61.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo62.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo62.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo62.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationTo62.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/Migrations.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/Migrations.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/Migrations.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/Migrations.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationsHelper.java b/app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationsHelper.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/migrations/MigrationsHelper.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/migrations/MigrationsHelper.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/util/DeferredFileOutputStream.java b/app/core/src/main/java/com/fsck/k9/mailstore/util/DeferredFileOutputStream.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/util/DeferredFileOutputStream.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/util/DeferredFileOutputStream.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/util/FileFactory.java b/app/core/src/main/java/com/fsck/k9/mailstore/util/FileFactory.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/util/FileFactory.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/util/FileFactory.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/mailstore/util/FlowedMessageUtils.java b/app/core/src/main/java/com/fsck/k9/mailstore/util/FlowedMessageUtils.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/mailstore/util/FlowedMessageUtils.java
rename to app/core/src/main/java/com/fsck/k9/mailstore/util/FlowedMessageUtils.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/AutocryptStatusInteractor.java b/app/core/src/main/java/com/fsck/k9/message/AutocryptStatusInteractor.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/AutocryptStatusInteractor.java
rename to app/core/src/main/java/com/fsck/k9/message/AutocryptStatusInteractor.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/ComposePgpEnableByDefaultDecider.java b/app/core/src/main/java/com/fsck/k9/message/ComposePgpEnableByDefaultDecider.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/ComposePgpEnableByDefaultDecider.java
rename to app/core/src/main/java/com/fsck/k9/message/ComposePgpEnableByDefaultDecider.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/ComposePgpInlineDecider.java b/app/core/src/main/java/com/fsck/k9/message/ComposePgpInlineDecider.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/ComposePgpInlineDecider.java
rename to app/core/src/main/java/com/fsck/k9/message/ComposePgpInlineDecider.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/IdentityField.java b/app/core/src/main/java/com/fsck/k9/message/IdentityField.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/IdentityField.java
rename to app/core/src/main/java/com/fsck/k9/message/IdentityField.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/IdentityHeaderBuilder.java b/app/core/src/main/java/com/fsck/k9/message/IdentityHeaderBuilder.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/IdentityHeaderBuilder.java
rename to app/core/src/main/java/com/fsck/k9/message/IdentityHeaderBuilder.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/IdentityHeaderParser.java b/app/core/src/main/java/com/fsck/k9/message/IdentityHeaderParser.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/IdentityHeaderParser.java
rename to app/core/src/main/java/com/fsck/k9/message/IdentityHeaderParser.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/MessageBuilder.java b/app/core/src/main/java/com/fsck/k9/message/MessageBuilder.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/message/MessageBuilder.java
rename to app/core/src/main/java/com/fsck/k9/message/MessageBuilder.java
index b2d0323c8..0b37454db 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/message/MessageBuilder.java
+++ b/app/core/src/main/java/com/fsck/k9/message/MessageBuilder.java
@@ -16,7 +16,7 @@ import timber.log.Timber;
 import com.fsck.k9.Account.QuoteStyle;
 import com.fsck.k9.Identity;
 import com.fsck.k9.K9;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.MessageReference;
 import com.fsck.k9.activity.misc.Attachment;
 import com.fsck.k9.mail.Address;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/PgpMessageBuilder.java b/app/core/src/main/java/com/fsck/k9/message/PgpMessageBuilder.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/message/PgpMessageBuilder.java
rename to app/core/src/main/java/com/fsck/k9/message/PgpMessageBuilder.java
index 8125fcf91..3b0fb8652 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/message/PgpMessageBuilder.java
+++ b/app/core/src/main/java/com/fsck/k9/message/PgpMessageBuilder.java
@@ -15,7 +15,7 @@ import android.support.annotation.Nullable;
 import android.support.annotation.VisibleForTesting;
 
 import com.fsck.k9.Globals;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.compose.ComposeCryptoStatus;
 import com.fsck.k9.autocrypt.AutocryptOpenPgpApiInteractor;
 import com.fsck.k9.autocrypt.AutocryptOperations;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/QuotedTextMode.java b/app/core/src/main/java/com/fsck/k9/message/QuotedTextMode.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/QuotedTextMode.java
rename to app/core/src/main/java/com/fsck/k9/message/QuotedTextMode.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/SimpleMessageBuilder.java b/app/core/src/main/java/com/fsck/k9/message/SimpleMessageBuilder.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/SimpleMessageBuilder.java
rename to app/core/src/main/java/com/fsck/k9/message/SimpleMessageBuilder.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/SimpleMessageFormat.java b/app/core/src/main/java/com/fsck/k9/message/SimpleMessageFormat.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/SimpleMessageFormat.java
rename to app/core/src/main/java/com/fsck/k9/message/SimpleMessageFormat.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/TextBodyBuilder.java b/app/core/src/main/java/com/fsck/k9/message/TextBodyBuilder.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/TextBodyBuilder.java
rename to app/core/src/main/java/com/fsck/k9/message/TextBodyBuilder.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/extractors/AttachmentCounter.java b/app/core/src/main/java/com/fsck/k9/message/extractors/AttachmentCounter.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/extractors/AttachmentCounter.java
rename to app/core/src/main/java/com/fsck/k9/message/extractors/AttachmentCounter.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/extractors/AttachmentInfoExtractor.java b/app/core/src/main/java/com/fsck/k9/message/extractors/AttachmentInfoExtractor.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/extractors/AttachmentInfoExtractor.java
rename to app/core/src/main/java/com/fsck/k9/message/extractors/AttachmentInfoExtractor.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/extractors/BodyTextExtractor.java b/app/core/src/main/java/com/fsck/k9/message/extractors/BodyTextExtractor.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/extractors/BodyTextExtractor.java
rename to app/core/src/main/java/com/fsck/k9/message/extractors/BodyTextExtractor.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/extractors/EncryptionDetector.java b/app/core/src/main/java/com/fsck/k9/message/extractors/EncryptionDetector.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/extractors/EncryptionDetector.java
rename to app/core/src/main/java/com/fsck/k9/message/extractors/EncryptionDetector.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/extractors/MessageFulltextCreator.java b/app/core/src/main/java/com/fsck/k9/message/extractors/MessageFulltextCreator.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/extractors/MessageFulltextCreator.java
rename to app/core/src/main/java/com/fsck/k9/message/extractors/MessageFulltextCreator.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/extractors/MessagePreviewCreator.java b/app/core/src/main/java/com/fsck/k9/message/extractors/MessagePreviewCreator.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/extractors/MessagePreviewCreator.java
rename to app/core/src/main/java/com/fsck/k9/message/extractors/MessagePreviewCreator.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/extractors/PreviewExtractionException.java b/app/core/src/main/java/com/fsck/k9/message/extractors/PreviewExtractionException.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/extractors/PreviewExtractionException.java
rename to app/core/src/main/java/com/fsck/k9/message/extractors/PreviewExtractionException.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/extractors/PreviewResult.java b/app/core/src/main/java/com/fsck/k9/message/extractors/PreviewResult.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/extractors/PreviewResult.java
rename to app/core/src/main/java/com/fsck/k9/message/extractors/PreviewResult.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/extractors/PreviewTextExtractor.java b/app/core/src/main/java/com/fsck/k9/message/extractors/PreviewTextExtractor.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/extractors/PreviewTextExtractor.java
rename to app/core/src/main/java/com/fsck/k9/message/extractors/PreviewTextExtractor.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/extractors/TextPartFinder.java b/app/core/src/main/java/com/fsck/k9/message/extractors/TextPartFinder.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/extractors/TextPartFinder.java
rename to app/core/src/main/java/com/fsck/k9/message/extractors/TextPartFinder.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/html/BitcoinUriParser.java b/app/core/src/main/java/com/fsck/k9/message/html/BitcoinUriParser.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/html/BitcoinUriParser.java
rename to app/core/src/main/java/com/fsck/k9/message/html/BitcoinUriParser.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/html/DividerReplacer.kt b/app/core/src/main/java/com/fsck/k9/message/html/DividerReplacer.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/html/DividerReplacer.kt
rename to app/core/src/main/java/com/fsck/k9/message/html/DividerReplacer.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/html/EmailSection.kt b/app/core/src/main/java/com/fsck/k9/message/html/EmailSection.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/html/EmailSection.kt
rename to app/core/src/main/java/com/fsck/k9/message/html/EmailSection.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/html/EmailSectionExtractor.kt b/app/core/src/main/java/com/fsck/k9/message/html/EmailSectionExtractor.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/html/EmailSectionExtractor.kt
rename to app/core/src/main/java/com/fsck/k9/message/html/EmailSectionExtractor.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/html/EmailTextToHtml.kt b/app/core/src/main/java/com/fsck/k9/message/html/EmailTextToHtml.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/html/EmailTextToHtml.kt
rename to app/core/src/main/java/com/fsck/k9/message/html/EmailTextToHtml.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/html/EthereumUriParser.java b/app/core/src/main/java/com/fsck/k9/message/html/EthereumUriParser.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/html/EthereumUriParser.java
rename to app/core/src/main/java/com/fsck/k9/message/html/EthereumUriParser.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/html/HeadCleaner.java b/app/core/src/main/java/com/fsck/k9/message/html/HeadCleaner.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/html/HeadCleaner.java
rename to app/core/src/main/java/com/fsck/k9/message/html/HeadCleaner.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/html/HtmlConverter.java b/app/core/src/main/java/com/fsck/k9/message/html/HtmlConverter.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/html/HtmlConverter.java
rename to app/core/src/main/java/com/fsck/k9/message/html/HtmlConverter.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/html/HtmlModification.kt b/app/core/src/main/java/com/fsck/k9/message/html/HtmlModification.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/html/HtmlModification.kt
rename to app/core/src/main/java/com/fsck/k9/message/html/HtmlModification.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/html/HtmlProcessor.java b/app/core/src/main/java/com/fsck/k9/message/html/HtmlProcessor.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/html/HtmlProcessor.java
rename to app/core/src/main/java/com/fsck/k9/message/html/HtmlProcessor.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/html/HtmlSanitizer.java b/app/core/src/main/java/com/fsck/k9/message/html/HtmlSanitizer.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/html/HtmlSanitizer.java
rename to app/core/src/main/java/com/fsck/k9/message/html/HtmlSanitizer.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/html/HttpUriParser.java b/app/core/src/main/java/com/fsck/k9/message/html/HttpUriParser.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/html/HttpUriParser.java
rename to app/core/src/main/java/com/fsck/k9/message/html/HttpUriParser.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/html/TextToHtml.kt b/app/core/src/main/java/com/fsck/k9/message/html/TextToHtml.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/html/TextToHtml.kt
rename to app/core/src/main/java/com/fsck/k9/message/html/TextToHtml.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/html/UriLinkifier.kt b/app/core/src/main/java/com/fsck/k9/message/html/UriLinkifier.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/html/UriLinkifier.kt
rename to app/core/src/main/java/com/fsck/k9/message/html/UriLinkifier.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/html/UriMatch.kt b/app/core/src/main/java/com/fsck/k9/message/html/UriMatch.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/html/UriMatch.kt
rename to app/core/src/main/java/com/fsck/k9/message/html/UriMatch.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/html/UriMatcher.kt b/app/core/src/main/java/com/fsck/k9/message/html/UriMatcher.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/html/UriMatcher.kt
rename to app/core/src/main/java/com/fsck/k9/message/html/UriMatcher.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/html/UriParser.kt b/app/core/src/main/java/com/fsck/k9/message/html/UriParser.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/html/UriParser.kt
rename to app/core/src/main/java/com/fsck/k9/message/html/UriParser.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/quote/HtmlQuoteCreator.java b/app/core/src/main/java/com/fsck/k9/message/quote/HtmlQuoteCreator.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/message/quote/HtmlQuoteCreator.java
rename to app/core/src/main/java/com/fsck/k9/message/quote/HtmlQuoteCreator.java
index 983659222..b3d9bf5cb 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/message/quote/HtmlQuoteCreator.java
+++ b/app/core/src/main/java/com/fsck/k9/message/quote/HtmlQuoteCreator.java
@@ -8,7 +8,7 @@ import android.content.res.Resources;
 import timber.log.Timber;
 
 import com.fsck.k9.Account.QuoteStyle;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.mail.Address;
 import com.fsck.k9.mail.Message;
 import com.fsck.k9.mail.Message.RecipientType;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/quote/InsertableHtmlContent.java b/app/core/src/main/java/com/fsck/k9/message/quote/InsertableHtmlContent.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/quote/InsertableHtmlContent.java
rename to app/core/src/main/java/com/fsck/k9/message/quote/InsertableHtmlContent.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/quote/QuoteHelper.java b/app/core/src/main/java/com/fsck/k9/message/quote/QuoteHelper.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/quote/QuoteHelper.java
rename to app/core/src/main/java/com/fsck/k9/message/quote/QuoteHelper.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/quote/TextQuoteCreator.java b/app/core/src/main/java/com/fsck/k9/message/quote/TextQuoteCreator.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/message/quote/TextQuoteCreator.java
rename to app/core/src/main/java/com/fsck/k9/message/quote/TextQuoteCreator.java
index 1f2c3ee66..257a42fb5 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/message/quote/TextQuoteCreator.java
+++ b/app/core/src/main/java/com/fsck/k9/message/quote/TextQuoteCreator.java
@@ -4,7 +4,7 @@ package com.fsck.k9.message.quote;
 import android.content.res.Resources;
 
 import com.fsck.k9.Account.QuoteStyle;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.helper.Utility;
 import com.fsck.k9.mail.Address;
 import com.fsck.k9.mail.Message;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/signature/HtmlSignatureRemover.java b/app/core/src/main/java/com/fsck/k9/message/signature/HtmlSignatureRemover.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/signature/HtmlSignatureRemover.java
rename to app/core/src/main/java/com/fsck/k9/message/signature/HtmlSignatureRemover.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/message/signature/TextSignatureRemover.java b/app/core/src/main/java/com/fsck/k9/message/signature/TextSignatureRemover.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/message/signature/TextSignatureRemover.java
rename to app/core/src/main/java/com/fsck/k9/message/signature/TextSignatureRemover.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/AddNotificationResult.java b/app/core/src/main/java/com/fsck/k9/notification/AddNotificationResult.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/notification/AddNotificationResult.java
rename to app/core/src/main/java/com/fsck/k9/notification/AddNotificationResult.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/AuthenticationErrorNotifications.java b/app/core/src/main/java/com/fsck/k9/notification/AuthenticationErrorNotifications.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/notification/AuthenticationErrorNotifications.java
rename to app/core/src/main/java/com/fsck/k9/notification/AuthenticationErrorNotifications.java
index a29c5a05a..fa1c71e06 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/notification/AuthenticationErrorNotifications.java
+++ b/app/core/src/main/java/com/fsck/k9/notification/AuthenticationErrorNotifications.java
@@ -9,7 +9,7 @@ import android.support.v4.app.NotificationCompat.BigTextStyle;
 import android.support.v4.app.NotificationManagerCompat;
 
 import com.fsck.k9.Account;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.setup.AccountSetupIncoming;
 import com.fsck.k9.activity.setup.AccountSetupOutgoing;
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/BaseNotifications.java b/app/core/src/main/java/com/fsck/k9/notification/BaseNotifications.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/notification/BaseNotifications.java
rename to app/core/src/main/java/com/fsck/k9/notification/BaseNotifications.java
index 6a7a376f1..90f1c6a74 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/notification/BaseNotifications.java
+++ b/app/core/src/main/java/com/fsck/k9/notification/BaseNotifications.java
@@ -10,7 +10,7 @@ import android.support.v4.app.NotificationCompat.Builder;
 import com.fsck.k9.Account;
 import com.fsck.k9.K9;
 import com.fsck.k9.K9.NotificationQuickDelete;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 
 
 abstract class BaseNotifications {
diff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/CertificateErrorNotifications.java b/app/core/src/main/java/com/fsck/k9/notification/CertificateErrorNotifications.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/notification/CertificateErrorNotifications.java
rename to app/core/src/main/java/com/fsck/k9/notification/CertificateErrorNotifications.java
index 1b70e8b44..269542bae 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/notification/CertificateErrorNotifications.java
+++ b/app/core/src/main/java/com/fsck/k9/notification/CertificateErrorNotifications.java
@@ -8,7 +8,7 @@ import android.support.v4.app.NotificationCompat;
 import android.support.v4.app.NotificationManagerCompat;
 
 import com.fsck.k9.Account;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.setup.AccountSetupIncoming;
 import com.fsck.k9.activity.setup.AccountSetupOutgoing;
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/DeviceNotifications.java b/app/core/src/main/java/com/fsck/k9/notification/DeviceNotifications.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/notification/DeviceNotifications.java
rename to app/core/src/main/java/com/fsck/k9/notification/DeviceNotifications.java
index 599dbb254..ac40b793a 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/notification/DeviceNotifications.java
+++ b/app/core/src/main/java/com/fsck/k9/notification/DeviceNotifications.java
@@ -17,7 +17,7 @@ import com.fsck.k9.K9;
 import com.fsck.k9.K9.NotificationHideSubject;
 import com.fsck.k9.K9.NotificationQuickDelete;
 import com.fsck.k9.NotificationSetting;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.MessageReference;
 
 import static com.fsck.k9.notification.NotificationController.NOTIFICATION_LED_BLINK_SLOW;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/LockScreenNotification.java b/app/core/src/main/java/com/fsck/k9/notification/LockScreenNotification.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/notification/LockScreenNotification.java
rename to app/core/src/main/java/com/fsck/k9/notification/LockScreenNotification.java
index d609109e7..856f1ada9 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/notification/LockScreenNotification.java
+++ b/app/core/src/main/java/com/fsck/k9/notification/LockScreenNotification.java
@@ -13,7 +13,7 @@ import android.text.TextUtils;
 
 import com.fsck.k9.Account;
 import com.fsck.k9.K9;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 
 
 class LockScreenNotification {
diff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/NewMailNotifications.java b/app/core/src/main/java/com/fsck/k9/notification/NewMailNotifications.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/notification/NewMailNotifications.java
rename to app/core/src/main/java/com/fsck/k9/notification/NewMailNotifications.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/NotificationActionCreator.java b/app/core/src/main/java/com/fsck/k9/notification/NotificationActionCreator.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/notification/NotificationActionCreator.java
rename to app/core/src/main/java/com/fsck/k9/notification/NotificationActionCreator.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/NotificationActionService.java b/app/core/src/main/java/com/fsck/k9/notification/NotificationActionService.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/notification/NotificationActionService.java
rename to app/core/src/main/java/com/fsck/k9/notification/NotificationActionService.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/NotificationContent.java b/app/core/src/main/java/com/fsck/k9/notification/NotificationContent.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/notification/NotificationContent.java
rename to app/core/src/main/java/com/fsck/k9/notification/NotificationContent.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/NotificationContentCreator.java b/app/core/src/main/java/com/fsck/k9/notification/NotificationContentCreator.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/notification/NotificationContentCreator.java
rename to app/core/src/main/java/com/fsck/k9/notification/NotificationContentCreator.java
index ec878934b..ec2a55e4e 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/notification/NotificationContentCreator.java
+++ b/app/core/src/main/java/com/fsck/k9/notification/NotificationContentCreator.java
@@ -7,7 +7,7 @@ import android.text.TextUtils;
 
 import com.fsck.k9.Account;
 import com.fsck.k9.K9;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.MessageReference;
 import com.fsck.k9.helper.Contacts;
 import com.fsck.k9.helper.MessageHelper;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/NotificationController.java b/app/core/src/main/java/com/fsck/k9/notification/NotificationController.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/notification/NotificationController.java
rename to app/core/src/main/java/com/fsck/k9/notification/NotificationController.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/NotificationData.java b/app/core/src/main/java/com/fsck/k9/notification/NotificationData.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/notification/NotificationData.java
rename to app/core/src/main/java/com/fsck/k9/notification/NotificationData.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/NotificationGroupKeys.java b/app/core/src/main/java/com/fsck/k9/notification/NotificationGroupKeys.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/notification/NotificationGroupKeys.java
rename to app/core/src/main/java/com/fsck/k9/notification/NotificationGroupKeys.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/NotificationHolder.java b/app/core/src/main/java/com/fsck/k9/notification/NotificationHolder.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/notification/NotificationHolder.java
rename to app/core/src/main/java/com/fsck/k9/notification/NotificationHolder.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/NotificationIds.java b/app/core/src/main/java/com/fsck/k9/notification/NotificationIds.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/notification/NotificationIds.java
rename to app/core/src/main/java/com/fsck/k9/notification/NotificationIds.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/RemoveNotificationResult.java b/app/core/src/main/java/com/fsck/k9/notification/RemoveNotificationResult.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/notification/RemoveNotificationResult.java
rename to app/core/src/main/java/com/fsck/k9/notification/RemoveNotificationResult.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/SendFailedNotifications.java b/app/core/src/main/java/com/fsck/k9/notification/SendFailedNotifications.java
similarity index 98%
rename from app/k9mail/src/main/java/com/fsck/k9/notification/SendFailedNotifications.java
rename to app/core/src/main/java/com/fsck/k9/notification/SendFailedNotifications.java
index 16d2a8b2b..eef4bd128 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/notification/SendFailedNotifications.java
+++ b/app/core/src/main/java/com/fsck/k9/notification/SendFailedNotifications.java
@@ -7,7 +7,7 @@ import android.support.v4.app.NotificationCompat;
 import android.support.v4.app.NotificationManagerCompat;
 
 import com.fsck.k9.Account;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.helper.ExceptionHelper;
 
 import static com.fsck.k9.notification.NotificationController.NOTIFICATION_LED_BLINK_FAST;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/SyncNotifications.java b/app/core/src/main/java/com/fsck/k9/notification/SyncNotifications.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/notification/SyncNotifications.java
rename to app/core/src/main/java/com/fsck/k9/notification/SyncNotifications.java
index 2c59aa753..f02eb00c3 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/notification/SyncNotifications.java
+++ b/app/core/src/main/java/com/fsck/k9/notification/SyncNotifications.java
@@ -7,7 +7,7 @@ import android.support.v4.app.NotificationCompat;
 import android.support.v4.app.NotificationManagerCompat;
 
 import com.fsck.k9.Account;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.mail.Folder;
 
 import static com.fsck.k9.notification.NotificationController.NOTIFICATION_LED_BLINK_FAST;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/notification/WearNotifications.java b/app/core/src/main/java/com/fsck/k9/notification/WearNotifications.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/notification/WearNotifications.java
rename to app/core/src/main/java/com/fsck/k9/notification/WearNotifications.java
index d82b2e558..f2d55e817 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/notification/WearNotifications.java
+++ b/app/core/src/main/java/com/fsck/k9/notification/WearNotifications.java
@@ -11,7 +11,7 @@ import android.support.v4.app.NotificationCompat.WearableExtender;
 
 import com.fsck.k9.Account;
 import com.fsck.k9.K9;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.MessageReference;
 import com.fsck.k9.controller.MessagingController;
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/power/DeviceIdleManager.java b/app/core/src/main/java/com/fsck/k9/power/DeviceIdleManager.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/power/DeviceIdleManager.java
rename to app/core/src/main/java/com/fsck/k9/power/DeviceIdleManager.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/power/DeviceIdleReceiver.java b/app/core/src/main/java/com/fsck/k9/power/DeviceIdleReceiver.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/power/DeviceIdleReceiver.java
rename to app/core/src/main/java/com/fsck/k9/power/DeviceIdleReceiver.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/power/DozeChecker.java b/app/core/src/main/java/com/fsck/k9/power/DozeChecker.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/power/DozeChecker.java
rename to app/core/src/main/java/com/fsck/k9/power/DozeChecker.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/power/TracingPowerManager.java b/app/core/src/main/java/com/fsck/k9/power/TracingPowerManager.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/power/TracingPowerManager.java
rename to app/core/src/main/java/com/fsck/k9/power/TracingPowerManager.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/preferences/AccountSettings.java b/app/core/src/main/java/com/fsck/k9/preferences/AccountSettings.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/preferences/AccountSettings.java
rename to app/core/src/main/java/com/fsck/k9/preferences/AccountSettings.java
index 1cef857e1..fa74ae94a 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/preferences/AccountSettings.java
+++ b/app/core/src/main/java/com/fsck/k9/preferences/AccountSettings.java
@@ -18,7 +18,7 @@ import com.fsck.k9.Account.Searchable;
 import com.fsck.k9.Account.ShowPictures;
 import com.fsck.k9.Account.SortType;
 import com.fsck.k9.K9;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.mailstore.StorageManager;
 import com.fsck.k9.preferences.Settings.BooleanSetting;
 import com.fsck.k9.preferences.Settings.ColorSetting;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/preferences/FolderSettings.java b/app/core/src/main/java/com/fsck/k9/preferences/FolderSettings.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/preferences/FolderSettings.java
rename to app/core/src/main/java/com/fsck/k9/preferences/FolderSettings.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/preferences/GlobalSettings.java b/app/core/src/main/java/com/fsck/k9/preferences/GlobalSettings.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/preferences/GlobalSettings.java
rename to app/core/src/main/java/com/fsck/k9/preferences/GlobalSettings.java
index c55736da1..f354cf52c 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/preferences/GlobalSettings.java
+++ b/app/core/src/main/java/com/fsck/k9/preferences/GlobalSettings.java
@@ -20,7 +20,7 @@ import com.fsck.k9.K9.NotificationHideSubject;
 import com.fsck.k9.K9.NotificationQuickDelete;
 import com.fsck.k9.K9.SplitViewMode;
 import com.fsck.k9.K9.Theme;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.preferences.Settings.BooleanSetting;
 import com.fsck.k9.preferences.Settings.ColorSetting;
 import com.fsck.k9.preferences.Settings.EnumSetting;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/preferences/IdentitySettings.java b/app/core/src/main/java/com/fsck/k9/preferences/IdentitySettings.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/preferences/IdentitySettings.java
rename to app/core/src/main/java/com/fsck/k9/preferences/IdentitySettings.java
index 7d7b6670e..8eda4526e 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/preferences/IdentitySettings.java
+++ b/app/core/src/main/java/com/fsck/k9/preferences/IdentitySettings.java
@@ -10,7 +10,7 @@ import java.util.TreeMap;
 
 import com.fsck.k9.EmailAddressValidator;
 import com.fsck.k9.K9;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.preferences.Settings.BooleanSetting;
 import com.fsck.k9.preferences.Settings.InvalidSettingValueException;
 import com.fsck.k9.preferences.Settings.SettingsDescription;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/preferences/Settings.java b/app/core/src/main/java/com/fsck/k9/preferences/Settings.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/preferences/Settings.java
rename to app/core/src/main/java/com/fsck/k9/preferences/Settings.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/preferences/SettingsExporter.java b/app/core/src/main/java/com/fsck/k9/preferences/SettingsExporter.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/preferences/SettingsExporter.java
rename to app/core/src/main/java/com/fsck/k9/preferences/SettingsExporter.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/preferences/SettingsImportExportException.java b/app/core/src/main/java/com/fsck/k9/preferences/SettingsImportExportException.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/preferences/SettingsImportExportException.java
rename to app/core/src/main/java/com/fsck/k9/preferences/SettingsImportExportException.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/preferences/SettingsImporter.java b/app/core/src/main/java/com/fsck/k9/preferences/SettingsImporter.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/preferences/SettingsImporter.java
rename to app/core/src/main/java/com/fsck/k9/preferences/SettingsImporter.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/preferences/Storage.java b/app/core/src/main/java/com/fsck/k9/preferences/Storage.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/preferences/Storage.java
rename to app/core/src/main/java/com/fsck/k9/preferences/Storage.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/preferences/StorageEditor.java b/app/core/src/main/java/com/fsck/k9/preferences/StorageEditor.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/preferences/StorageEditor.java
rename to app/core/src/main/java/com/fsck/k9/preferences/StorageEditor.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/provider/AttachmentProvider.java b/app/core/src/main/java/com/fsck/k9/provider/AttachmentProvider.java
similarity index 96%
rename from app/k9mail/src/main/java/com/fsck/k9/provider/AttachmentProvider.java
rename to app/core/src/main/java/com/fsck/k9/provider/AttachmentProvider.java
index f0e6a2222..e5d76306c 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/provider/AttachmentProvider.java
+++ b/app/core/src/main/java/com/fsck/k9/provider/AttachmentProvider.java
@@ -16,7 +16,6 @@ import android.support.annotation.Nullable;
 import timber.log.Timber;
 
 import com.fsck.k9.Account;
-import com.fsck.k9.BuildConfig;
 import com.fsck.k9.Preferences;
 import com.fsck.k9.mail.MessagingException;
 import com.fsck.k9.mail.internet.MimeUtility;
@@ -29,8 +28,7 @@ import org.openintents.openpgp.util.OpenPgpApi.OpenPgpDataSource;
  * A simple ContentProvider that allows file access to attachments.
  */
 public class AttachmentProvider extends ContentProvider {
-    private static final String AUTHORITY = BuildConfig.APPLICATION_ID + ".attachmentprovider";
-    public static final Uri CONTENT_URI = Uri.parse("content://" + AUTHORITY);
+    public static Uri CONTENT_URI;
 
     private static final String[] DEFAULT_PROJECTION = new String[] {
             AttachmentProviderColumns._ID,
@@ -54,6 +52,10 @@ public class AttachmentProvider extends ContentProvider {
 
     @Override
     public boolean onCreate() {
+        String packageName = getContext().getPackageName();
+        String authority = packageName + ".attachmentprovider";
+        CONTENT_URI = Uri.parse("content://" + authority);
+
         return true;
     }
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/provider/AttachmentTempFileProvider.java b/app/core/src/main/java/com/fsck/k9/provider/AttachmentTempFileProvider.java
similarity index 96%
rename from app/k9mail/src/main/java/com/fsck/k9/provider/AttachmentTempFileProvider.java
rename to app/core/src/main/java/com/fsck/k9/provider/AttachmentTempFileProvider.java
index 1ee199355..809baccf4 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/provider/AttachmentTempFileProvider.java
+++ b/app/core/src/main/java/com/fsck/k9/provider/AttachmentTempFileProvider.java
@@ -19,23 +19,28 @@ import android.support.annotation.WorkerThread;
 import android.support.v4.content.FileProvider;
 import timber.log.Timber;
 
-import com.fsck.k9.BuildConfig;
 import com.fsck.k9.K9;
 import okio.ByteString;
 import org.apache.commons.io.IOUtils;
 
 
 public class AttachmentTempFileProvider extends FileProvider {
-    private static final String AUTHORITY = BuildConfig.APPLICATION_ID + ".tempfileprovider";
     private static final String CACHE_DIRECTORY = "temp";
     private static final long FILE_DELETE_THRESHOLD_MILLISECONDS = 3 * 60 * 1000;
     private static final Object tempFileWriteMonitor = new Object();
     private static final Object cleanupReceiverMonitor = new Object();
 
-
+    private static String AUTHORITY;
     private static AttachmentTempFileProviderCleanupReceiver cleanupReceiver = null;
 
 
+    @Override
+    public boolean onCreate() {
+        String packageName = getContext().getPackageName();
+        AUTHORITY = packageName + ".tempfileprovider";
+        return true;
+    }
+
     @WorkerThread
     public static Uri createTempUriForContentUri(Context context, Uri uri) throws IOException {
         Context applicationContext = context.getApplicationContext();
diff --git a/app/k9mail/src/main/java/com/fsck/k9/provider/DecryptedFileProvider.java b/app/core/src/main/java/com/fsck/k9/provider/DecryptedFileProvider.java
similarity index 97%
rename from app/k9mail/src/main/java/com/fsck/k9/provider/DecryptedFileProvider.java
rename to app/core/src/main/java/com/fsck/k9/provider/DecryptedFileProvider.java
index 697ebd465..869fd8f4a 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/provider/DecryptedFileProvider.java
+++ b/app/core/src/main/java/com/fsck/k9/provider/DecryptedFileProvider.java
@@ -21,7 +21,6 @@ import android.support.v4.content.FileProvider;
 import android.text.TextUtils;
 import timber.log.Timber;
 
-import com.fsck.k9.BuildConfig;
 import com.fsck.k9.K9;
 import com.fsck.k9.mailstore.util.FileFactory;
 import org.apache.james.mime4j.codec.Base64InputStream;
@@ -31,15 +30,21 @@ import org.openintents.openpgp.util.ParcelFileDescriptorUtil;
 
 
 public class DecryptedFileProvider extends FileProvider {
-    private static final String AUTHORITY = BuildConfig.APPLICATION_ID + ".decryptedfileprovider";
     private static final String DECRYPTED_CACHE_DIRECTORY = "decrypted";
     private static final long FILE_DELETE_THRESHOLD_MILLISECONDS = 3 * 60 * 1000;
     private static final Object cleanupReceiverMonitor = new Object();
 
-
+    private static String AUTHORITY;
     private static DecryptedFileProviderCleanupReceiver cleanupReceiver = null;
 
 
+    @Override
+    public boolean onCreate() {
+        String packageName = getContext().getPackageName();
+        AUTHORITY = packageName + ".decryptedfileprovider";
+        return true;
+    }
+
     public static FileFactory getFileFactory(Context context) {
         final Context applicationContext = context.getApplicationContext();
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/provider/EmailProvider.java b/app/core/src/main/java/com/fsck/k9/provider/EmailProvider.java
similarity index 97%
rename from app/k9mail/src/main/java/com/fsck/k9/provider/EmailProvider.java
rename to app/core/src/main/java/com/fsck/k9/provider/EmailProvider.java
index 1db6ff4c9..2fa4432f1 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/provider/EmailProvider.java
+++ b/app/core/src/main/java/com/fsck/k9/provider/EmailProvider.java
@@ -18,7 +18,6 @@ import android.net.Uri;
 import android.text.TextUtils;
 
 import com.fsck.k9.Account;
-import com.fsck.k9.BuildConfig;
 import com.fsck.k9.Preferences;
 import com.fsck.k9.cache.EmailProviderCacheCursor;
 import com.fsck.k9.helper.Utility;
@@ -44,11 +43,10 @@ import com.fsck.k9.search.SqlQueryBuilder;
  * - add support for account list and folder list
  */
 public class EmailProvider extends ContentProvider {
-    private static final UriMatcher URI_MATCHER = new UriMatcher(UriMatcher.NO_MATCH);
+    public static String AUTHORITY;
+    public static Uri CONTENT_URI;
 
-    public static final String AUTHORITY = BuildConfig.APPLICATION_ID + ".provider.email";
-
-    public static final Uri CONTENT_URI = Uri.parse("content://" + AUTHORITY);
+    private UriMatcher uriMatcher = new UriMatcher(UriMatcher.NO_MATCH);
 
 
     /*
@@ -109,14 +107,6 @@ public class EmailProvider extends ContentProvider {
 
     private static final String THREADS_TABLE = "threads";
 
-    static {
-        UriMatcher matcher = URI_MATCHER;
-
-        matcher.addURI(AUTHORITY, "account/*/messages", MESSAGES);
-        matcher.addURI(AUTHORITY, "account/*/messages/threaded", MESSAGES_THREADED);
-        matcher.addURI(AUTHORITY, "account/*/thread/#", MESSAGES_THREAD);
-    }
-
     public interface SpecialColumns {
         String ACCOUNT_UUID = "account_uuid";
 
@@ -191,6 +181,14 @@ public class EmailProvider extends ContentProvider {
 
     @Override
     public boolean onCreate() {
+        String packageName = getContext().getPackageName();
+        AUTHORITY = packageName + ".provider.email";
+        CONTENT_URI = Uri.parse("content://" + AUTHORITY);
+
+        uriMatcher.addURI(AUTHORITY, "account/*/messages", MESSAGES);
+        uriMatcher.addURI(AUTHORITY, "account/*/messages/threaded", MESSAGES_THREADED);
+        uriMatcher.addURI(AUTHORITY, "account/*/thread/#", MESSAGES_THREAD);
+
         return true;
     }
 
@@ -201,7 +199,7 @@ public class EmailProvider extends ContentProvider {
 
     @Override
     public Cursor query(Uri uri, String[] projection, String selection, String[] selectionArgs, String sortOrder) {
-        int match = URI_MATCHER.match(uri);
+        int match = uriMatcher.match(uri);
         if (match < 0) {
             throw new IllegalArgumentException("Unknown URI: " + uri);
         }
diff --git a/app/k9mail/src/main/java/com/fsck/k9/provider/MessageProvider.java b/app/core/src/main/java/com/fsck/k9/provider/MessageProvider.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/provider/MessageProvider.java
rename to app/core/src/main/java/com/fsck/k9/provider/MessageProvider.java
index ce196edbc..e5a62b527 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/provider/MessageProvider.java
+++ b/app/core/src/main/java/com/fsck/k9/provider/MessageProvider.java
@@ -39,7 +39,6 @@ import timber.log.Timber;
 
 import com.fsck.k9.Account;
 import com.fsck.k9.AccountStats;
-import com.fsck.k9.BuildConfig;
 import com.fsck.k9.K9;
 import com.fsck.k9.Preferences;
 import com.fsck.k9.activity.FolderInfoHolder;
@@ -57,8 +56,8 @@ import com.fsck.k9.search.SearchAccount;
 
 
 public class MessageProvider extends ContentProvider {
-    public static final String AUTHORITY = BuildConfig.APPLICATION_ID + ".messageprovider";
-    public static final Uri CONTENT_URI = Uri.parse("content://" + AUTHORITY);
+    public static String AUTHORITY;
+    public static Uri CONTENT_URI;
 
     private static final String[] DEFAULT_MESSAGE_PROJECTION = new String[] {
             MessageColumns._ID,
@@ -95,6 +94,10 @@ public class MessageProvider extends ContentProvider {
 
     @Override
     public boolean onCreate() {
+        String packageName = getContext().getPackageName();
+        AUTHORITY = packageName + ".messageprovider";
+        CONTENT_URI = Uri.parse("content://" + AUTHORITY);
+
         messageHelper = MessageHelper.getInstance(getContext());
 
         registerQueryHandler(new ThrottlingQueryHandler(new AccountsQueryHandler()));
diff --git a/app/k9mail/src/main/java/com/fsck/k9/provider/RawMessageProvider.java b/app/core/src/main/java/com/fsck/k9/provider/RawMessageProvider.java
similarity index 96%
rename from app/k9mail/src/main/java/com/fsck/k9/provider/RawMessageProvider.java
rename to app/core/src/main/java/com/fsck/k9/provider/RawMessageProvider.java
index 7839f8bc3..07114b1a6 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/provider/RawMessageProvider.java
+++ b/app/core/src/main/java/com/fsck/k9/provider/RawMessageProvider.java
@@ -18,7 +18,6 @@ import android.support.annotation.NonNull;
 import android.support.annotation.Nullable;
 
 import com.fsck.k9.Account;
-import com.fsck.k9.BuildConfig;
 import com.fsck.k9.Preferences;
 import com.fsck.k9.activity.MessageReference;
 import com.fsck.k9.mail.FetchProfile;
@@ -36,8 +35,8 @@ import timber.log.Timber;
  * A simple ContentProvider that allows file access to a raw message.
  */
 public class RawMessageProvider extends ContentProvider {
-    private static final String AUTHORITY = BuildConfig.APPLICATION_ID + ".rawmessageprovider";
-    private static final Uri CONTENT_URI = Uri.parse("content://" + AUTHORITY);
+    private static String AUTHORITY;
+    private static Uri CONTENT_URI;
 
     private static final String[] DEFAULT_PROJECTION = new String[] {
             OpenableColumns.DISPLAY_NAME,
@@ -53,6 +52,9 @@ public class RawMessageProvider extends ContentProvider {
 
     @Override
     public boolean onCreate() {
+        String packageName = getContext().getPackageName();
+        AUTHORITY = packageName + ".rawmessageprovider";
+        CONTENT_URI = Uri.parse("content://" + AUTHORITY);
         return true;
     }
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/provider/UnreadWidgetProvider.kt b/app/core/src/main/java/com/fsck/k9/provider/UnreadWidgetProvider.kt
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/provider/UnreadWidgetProvider.kt
rename to app/core/src/main/java/com/fsck/k9/provider/UnreadWidgetProvider.kt
index 3afa3a266..c3dc61a76 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/provider/UnreadWidgetProvider.kt
+++ b/app/core/src/main/java/com/fsck/k9/provider/UnreadWidgetProvider.kt
@@ -7,7 +7,7 @@ import android.content.Context
 import android.content.Intent
 import android.view.View
 import android.widget.RemoteViews
-import com.fsck.k9.R
+import com.fsck.k9.core.R
 import com.fsck.k9.widget.unread.UnreadWidgetConfigurationActivity
 import com.fsck.k9.widget.unread.UnreadWidgetData
 import com.fsck.k9.widget.unread.UnreadWidgetRepository
diff --git a/app/k9mail/src/main/java/com/fsck/k9/remotecontrol/AccountReceiver.java b/app/core/src/main/java/com/fsck/k9/remotecontrol/AccountReceiver.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/remotecontrol/AccountReceiver.java
rename to app/core/src/main/java/com/fsck/k9/remotecontrol/AccountReceiver.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/remotecontrol/K9AccountReceptor.java b/app/core/src/main/java/com/fsck/k9/remotecontrol/K9AccountReceptor.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/remotecontrol/K9AccountReceptor.java
rename to app/core/src/main/java/com/fsck/k9/remotecontrol/K9AccountReceptor.java
index 8732b83ac..a62d20bd3 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/remotecontrol/K9AccountReceptor.java
+++ b/app/core/src/main/java/com/fsck/k9/remotecontrol/K9AccountReceptor.java
@@ -7,4 +7,4 @@ package com.fsck.k9.remotecontrol;
  */
 public interface K9AccountReceptor {
     public void accounts(String[] uuids, String[] descriptions);
-}
\ No newline at end of file
+}
diff --git a/app/k9mail/src/main/java/com/fsck/k9/remotecontrol/K9RemoteControl.java b/app/core/src/main/java/com/fsck/k9/remotecontrol/K9RemoteControl.java
similarity index 75%
rename from app/k9mail/src/main/java/com/fsck/k9/remotecontrol/K9RemoteControl.java
rename to app/core/src/main/java/com/fsck/k9/remotecontrol/K9RemoteControl.java
index 147d246c6..ae2c04a24 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/remotecontrol/K9RemoteControl.java
+++ b/app/core/src/main/java/com/fsck/k9/remotecontrol/K9RemoteControl.java
@@ -5,8 +5,6 @@ import android.app.Activity;
 import android.content.Context;
 import android.content.Intent;
 
-import com.fsck.k9.BuildConfig;
-
 /**
  * Utility definitions for Android applications to control the behavior of K-9 Mail.  All such applications must declare the following permission:
  * <uses-permission android:name="com.fsck.k9.permission.REMOTE_CONTROL"/>
@@ -26,14 +24,14 @@ public class K9RemoteControl {
      * Permission that every application sending a broadcast to K-9 for Remote Control purposes should send on every broadcast.
      * Prevent other applications from intercepting the broadcasts.
      */
-    public final static String K9_REMOTE_CONTROL_PERMISSION = BuildConfig.APPLICATION_ID + ".permission.REMOTE_CONTROL";
+    public static String K9_REMOTE_CONTROL_PERMISSION;
     /**
      * {@link Intent} Action to be sent to K-9 using {@link ContextWrapper.sendOrderedBroadcast} in order to fetch the list of configured Accounts.
      * The responseData will contain two String[] with keys K9_ACCOUNT_UUIDS and K9_ACCOUNT_DESCRIPTIONS
      */
-    public final static String K9_REQUEST_ACCOUNTS = BuildConfig.APPLICATION_ID + ".K9RemoteControl.requestAccounts";
-    public final static String K9_ACCOUNT_UUIDS = BuildConfig.APPLICATION_ID + ".K9RemoteControl.accountUuids";
-    public final static String K9_ACCOUNT_DESCRIPTIONS = BuildConfig.APPLICATION_ID + ".K9RemoteControl.accountDescriptions";
+    public static String K9_REQUEST_ACCOUNTS;
+    public static String K9_ACCOUNT_UUIDS;
+    public static String K9_ACCOUNT_DESCRIPTIONS;
 
     /**
      * The {@link {@link Intent}} Action to set in order to cause K-9 to check mail.  (Not yet implemented)
@@ -43,17 +41,17 @@ public class K9RemoteControl {
     /**
      * The {@link {@link Intent}} Action to set when remotely changing K-9 Mail settings
      */
-    public final static String K9_SET = BuildConfig.APPLICATION_ID + ".K9RemoteControl.set";
+    public static String K9_SET;
     /**
      * The key of the {@link Intent} Extra to set to hold the UUID of a single Account's settings to change.  Used only if K9_ALL_ACCOUNTS
      * is absent or false.
      */
-    public final static String K9_ACCOUNT_UUID = BuildConfig.APPLICATION_ID + ".K9RemoteControl.accountUuid";
+    public static String K9_ACCOUNT_UUID;
     /**
      * The key of the {@link Intent} Extra to set to control if the settings will apply to all Accounts, or to the one
      * specified with K9_ACCOUNT_UUID
      */
-    public final static String K9_ALL_ACCOUNTS = BuildConfig.APPLICATION_ID + ".K9RemoteControl.allAccounts";
+    public static String K9_ALL_ACCOUNTS;
 
     public final static String K9_ENABLED = "true";
     public final static String K9_DISABLED = "false";
@@ -62,17 +60,17 @@ public class K9RemoteControl {
      * Key for the {@link Intent} Extra for controlling whether notifications will be generated for new unread mail.
      * Acceptable values are K9_ENABLED and K9_DISABLED
      */
-    public final static String K9_NOTIFICATION_ENABLED = BuildConfig.APPLICATION_ID + ".K9RemoteControl.notificationEnabled";
+    public static String K9_NOTIFICATION_ENABLED;
     /*
      * Key for the {@link Intent} Extra for controlling whether K-9 will sound the ringtone for new unread mail.
      * Acceptable values are K9_ENABLED and K9_DISABLED
      */
-    public final static String K9_RING_ENABLED = BuildConfig.APPLICATION_ID + ".K9RemoteControl.ringEnabled";
+    public static String K9_RING_ENABLED;
     /*
      * Key for the {@link Intent} Extra for controlling whether K-9 will activate the vibrator for new unread mail.
      * Acceptable values are K9_ENABLED and K9_DISABLED
      */
-    public final static String K9_VIBRATE_ENABLED = BuildConfig.APPLICATION_ID + ".K9RemoteControl.vibrateEnabled";
+    public static String K9_VIBRATE_ENABLED;
 
     public final static String K9_FOLDERS_NONE = "NONE";
     public final static String K9_FOLDERS_ALL = "ALL";
@@ -84,27 +82,27 @@ public class K9RemoteControl {
      * Acceptable values are K9_FOLDERS_ALL, K9_FOLDERS_FIRST_CLASS, K9_FOLDERS_FIRST_AND_SECOND_CLASS,
      * K9_FOLDERS_NOT_SECOND_CLASS, K9_FOLDERS_NONE
      */
-    public final static String K9_PUSH_CLASSES = BuildConfig.APPLICATION_ID + ".K9RemoteControl.pushClasses";
+    public static String K9_PUSH_CLASSES;
     /**
      * Key for the {@link Intent} Extra to set for controlling which folders to be synchronized with Poll.
      * Acceptable values are K9_FOLDERS_ALL, K9_FOLDERS_FIRST_CLASS, K9_FOLDERS_FIRST_AND_SECOND_CLASS,
      * K9_FOLDERS_NOT_SECOND_CLASS, K9_FOLDERS_NONE
      */
-    public final static String K9_POLL_CLASSES = BuildConfig.APPLICATION_ID + ".K9RemoteControl.pollClasses";
+    public static String K9_POLL_CLASSES;
 
     public final static String[] K9_POLL_FREQUENCIES = { "-1", "1", "5", "10", "15", "30", "60", "120", "180", "360", "720", "1440"};
     /**
      * Key for the {@link Intent} Extra to set with the desired poll frequency.  The value is a String representing a number of minutes.
      * Acceptable values are available in K9_POLL_FREQUENCIES
      */
-    public final static String K9_POLL_FREQUENCY = BuildConfig.APPLICATION_ID + ".K9RemoteControl.pollFrequency";
+    public static String K9_POLL_FREQUENCY;
 
     /**
      * Key for the {@link Intent} Extra to set for controlling K-9's global "Background sync" setting.
      * Acceptable values are K9_BACKGROUND_OPERATIONS_ALWAYS, K9_BACKGROUND_OPERATIONS_NEVER
      * K9_BACKGROUND_OPERATIONS_WHEN_CHECKED_AUTO_SYNC
      */
-    public final static String K9_BACKGROUND_OPERATIONS = BuildConfig.APPLICATION_ID + ".K9RemoteControl.backgroundOperations";
+    public static String K9_BACKGROUND_OPERATIONS;
     public final static String K9_BACKGROUND_OPERATIONS_ALWAYS = "ALWAYS";
     public final static String K9_BACKGROUND_OPERATIONS_NEVER = "NEVER";
     public final static String K9_BACKGROUND_OPERATIONS_WHEN_CHECKED_AUTO_SYNC = "WHEN_CHECKED_AUTO_SYNC";
@@ -113,12 +111,30 @@ public class K9RemoteControl {
      * Key for the {@link Intent} Extra to set for controlling which display theme K-9 will use.  Acceptable values are
      * K9_THEME_LIGHT, K9_THEME_DARK
      */
-    public final static String K9_THEME = BuildConfig.APPLICATION_ID + ".K9RemoteControl.theme";
+    public static String K9_THEME;
     public final static String K9_THEME_LIGHT = "LIGHT";
     public final static String K9_THEME_DARK = "DARK";
 
     protected static final String LOG_TAG = "K9RemoteControl";
 
+    public static void init(String packageName) {
+        K9_REMOTE_CONTROL_PERMISSION = packageName + ".permission.REMOTE_CONTROL";
+        K9_REQUEST_ACCOUNTS = packageName + ".K9RemoteControl.requestAccounts";
+        K9_ACCOUNT_UUIDS = packageName + ".K9RemoteControl.accountUuids";
+        K9_ACCOUNT_DESCRIPTIONS = packageName + ".K9RemoteControl.accountDescriptions";
+        K9_SET = packageName + ".K9RemoteControl.set";
+        K9_ACCOUNT_UUID = packageName + ".K9RemoteControl.accountUuid";
+        K9_ALL_ACCOUNTS = packageName + ".K9RemoteControl.allAccounts";
+        K9_NOTIFICATION_ENABLED = packageName + ".K9RemoteControl.notificationEnabled";
+        K9_RING_ENABLED = packageName + ".K9RemoteControl.ringEnabled";
+        K9_VIBRATE_ENABLED = packageName + ".K9RemoteControl.vibrateEnabled";
+        K9_PUSH_CLASSES = packageName + ".K9RemoteControl.pushClasses";
+        K9_POLL_CLASSES = packageName + ".K9RemoteControl.pollClasses";
+        K9_POLL_FREQUENCY = packageName + ".K9RemoteControl.pollFrequency";
+        K9_BACKGROUND_OPERATIONS = packageName + ".K9RemoteControl.backgroundOperations";
+        K9_THEME = packageName + ".K9RemoteControl.theme";
+    }
+
     public static void set(Context context, Intent broadcastIntent) {
         broadcastIntent.setAction(K9RemoteControl.K9_SET);
         context.sendBroadcast(broadcastIntent, K9RemoteControl.K9_REMOTE_CONTROL_PERMISSION);
diff --git a/app/k9mail/src/main/java/com/fsck/k9/search/ConditionsTreeNode.java b/app/core/src/main/java/com/fsck/k9/search/ConditionsTreeNode.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/search/ConditionsTreeNode.java
rename to app/core/src/main/java/com/fsck/k9/search/ConditionsTreeNode.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/search/LocalSearch.java b/app/core/src/main/java/com/fsck/k9/search/LocalSearch.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/search/LocalSearch.java
rename to app/core/src/main/java/com/fsck/k9/search/LocalSearch.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/search/SearchAccount.java b/app/core/src/main/java/com/fsck/k9/search/SearchAccount.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/search/SearchAccount.java
rename to app/core/src/main/java/com/fsck/k9/search/SearchAccount.java
index 2647eb5d7..bbfa3f46b 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/search/SearchAccount.java
+++ b/app/core/src/main/java/com/fsck/k9/search/SearchAccount.java
@@ -3,7 +3,7 @@ package com.fsck.k9.search;
 import android.content.Context;
 
 import com.fsck.k9.BaseAccount;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.search.SearchSpecification.Attribute;
 import com.fsck.k9.search.SearchSpecification.SearchField;
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/search/SearchSpecification.java b/app/core/src/main/java/com/fsck/k9/search/SearchSpecification.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/search/SearchSpecification.java
rename to app/core/src/main/java/com/fsck/k9/search/SearchSpecification.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/search/SqlQueryBuilder.java b/app/core/src/main/java/com/fsck/k9/search/SqlQueryBuilder.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/search/SqlQueryBuilder.java
rename to app/core/src/main/java/com/fsck/k9/search/SqlQueryBuilder.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/service/BootReceiver.java b/app/core/src/main/java/com/fsck/k9/service/BootReceiver.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/service/BootReceiver.java
rename to app/core/src/main/java/com/fsck/k9/service/BootReceiver.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/service/CoreReceiver.java b/app/core/src/main/java/com/fsck/k9/service/CoreReceiver.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/service/CoreReceiver.java
rename to app/core/src/main/java/com/fsck/k9/service/CoreReceiver.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/service/CoreService.java b/app/core/src/main/java/com/fsck/k9/service/CoreService.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/service/CoreService.java
rename to app/core/src/main/java/com/fsck/k9/service/CoreService.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/service/DatabaseUpgradeService.java b/app/core/src/main/java/com/fsck/k9/service/DatabaseUpgradeService.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/service/DatabaseUpgradeService.java
rename to app/core/src/main/java/com/fsck/k9/service/DatabaseUpgradeService.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/service/K9ChooserTargetService.java b/app/core/src/main/java/com/fsck/k9/service/K9ChooserTargetService.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/service/K9ChooserTargetService.java
rename to app/core/src/main/java/com/fsck/k9/service/K9ChooserTargetService.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/service/MailService.java b/app/core/src/main/java/com/fsck/k9/service/MailService.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/service/MailService.java
rename to app/core/src/main/java/com/fsck/k9/service/MailService.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/service/PollService.java b/app/core/src/main/java/com/fsck/k9/service/PollService.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/service/PollService.java
rename to app/core/src/main/java/com/fsck/k9/service/PollService.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/service/PushService.java b/app/core/src/main/java/com/fsck/k9/service/PushService.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/service/PushService.java
rename to app/core/src/main/java/com/fsck/k9/service/PushService.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/service/RemoteControlReceiver.java b/app/core/src/main/java/com/fsck/k9/service/RemoteControlReceiver.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/service/RemoteControlReceiver.java
rename to app/core/src/main/java/com/fsck/k9/service/RemoteControlReceiver.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/service/RemoteControlService.java b/app/core/src/main/java/com/fsck/k9/service/RemoteControlService.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/service/RemoteControlService.java
rename to app/core/src/main/java/com/fsck/k9/service/RemoteControlService.java
index b8032ff5e..d927651dd 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/service/RemoteControlService.java
+++ b/app/core/src/main/java/com/fsck/k9/service/RemoteControlService.java
@@ -6,7 +6,7 @@ import com.fsck.k9.preferences.Storage;
 import com.fsck.k9.preferences.StorageEditor;
 import com.fsck.k9.remotecontrol.K9RemoteControl;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.Account.FolderMode;
 import com.fsck.k9.K9.BACKGROUND_OPS;
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/service/ShutdownReceiver.java b/app/core/src/main/java/com/fsck/k9/service/ShutdownReceiver.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/service/ShutdownReceiver.java
rename to app/core/src/main/java/com/fsck/k9/service/ShutdownReceiver.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/service/SleepService.java b/app/core/src/main/java/com/fsck/k9/service/SleepService.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/service/SleepService.java
rename to app/core/src/main/java/com/fsck/k9/service/SleepService.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/service/StorageGoneReceiver.java b/app/core/src/main/java/com/fsck/k9/service/StorageGoneReceiver.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/service/StorageGoneReceiver.java
rename to app/core/src/main/java/com/fsck/k9/service/StorageGoneReceiver.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/service/StorageReceiver.java b/app/core/src/main/java/com/fsck/k9/service/StorageReceiver.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/service/StorageReceiver.java
rename to app/core/src/main/java/com/fsck/k9/service/StorageReceiver.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/setup/ServerNameSuggester.java b/app/core/src/main/java/com/fsck/k9/setup/ServerNameSuggester.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/setup/ServerNameSuggester.java
rename to app/core/src/main/java/com/fsck/k9/setup/ServerNameSuggester.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/ContactBadge.java b/app/core/src/main/java/com/fsck/k9/ui/ContactBadge.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/ContactBadge.java
rename to app/core/src/main/java/com/fsck/k9/ui/ContactBadge.java
index 6a09fedca..4fefc4532 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/ContactBadge.java
+++ b/app/core/src/main/java/com/fsck/k9/ui/ContactBadge.java
@@ -23,7 +23,7 @@ import android.view.accessibility.AccessibilityNodeInfo;
 import android.widget.ImageView;
 import android.widget.Toast;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 
 
 /**
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/EolConvertingEditText.java b/app/core/src/main/java/com/fsck/k9/ui/EolConvertingEditText.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/EolConvertingEditText.java
rename to app/core/src/main/java/com/fsck/k9/ui/EolConvertingEditText.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/FragmentExtras.kt b/app/core/src/main/java/com/fsck/k9/ui/FragmentExtras.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/FragmentExtras.kt
rename to app/core/src/main/java/com/fsck/k9/ui/FragmentExtras.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/LiveDataExtras.kt b/app/core/src/main/java/com/fsck/k9/ui/LiveDataExtras.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/LiveDataExtras.kt
rename to app/core/src/main/java/com/fsck/k9/ui/LiveDataExtras.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/account/AccountsLiveData.kt b/app/core/src/main/java/com/fsck/k9/ui/account/AccountsLiveData.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/account/AccountsLiveData.kt
rename to app/core/src/main/java/com/fsck/k9/ui/account/AccountsLiveData.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/compose/QuotedMessageMvpView.java b/app/core/src/main/java/com/fsck/k9/ui/compose/QuotedMessageMvpView.java
similarity index 91%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/compose/QuotedMessageMvpView.java
rename to app/core/src/main/java/com/fsck/k9/ui/compose/QuotedMessageMvpView.java
index cbc2ac095..ba6fb73ff 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/compose/QuotedMessageMvpView.java
+++ b/app/core/src/main/java/com/fsck/k9/ui/compose/QuotedMessageMvpView.java
@@ -10,7 +10,7 @@ import android.widget.Button;
 import android.widget.ImageButton;
 
 import com.fsck.k9.FontSizes;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.MessageCompose;
 import com.fsck.k9.message.html.HtmlConverter;
 import com.fsck.k9.mailstore.AttachmentResolver;
@@ -56,16 +56,13 @@ public class QuotedMessageMvpView {
         OnClickListener onClickListener = new OnClickListener() {
             @Override
             public void onClick(View view) {
-                switch(view.getId()) {
-                    case R.id.quoted_text_show:
-                        presenter.onClickShowQuotedText();
-                        break;
-                    case R.id.quoted_text_delete:
-                        presenter.onClickDeleteQuotedText();
-                        break;
-                    case R.id.quoted_text_edit:
-                        presenter.onClickEditQuotedText();
-                        break;
+                int id = view.getId();
+                if (id == R.id.quoted_text_show) {
+                    presenter.onClickShowQuotedText();
+                } else if (id == R.id.quoted_text_delete) {
+                    presenter.onClickDeleteQuotedText();
+                } else if (id == R.id.quoted_text_edit) {
+                    presenter.onClickEditQuotedText();
                 }
             }
         };
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/compose/QuotedMessagePresenter.java b/app/core/src/main/java/com/fsck/k9/ui/compose/QuotedMessagePresenter.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/compose/QuotedMessagePresenter.java
rename to app/core/src/main/java/com/fsck/k9/ui/compose/QuotedMessagePresenter.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/crypto/MessageCryptoAnnotations.java b/app/core/src/main/java/com/fsck/k9/ui/crypto/MessageCryptoAnnotations.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/crypto/MessageCryptoAnnotations.java
rename to app/core/src/main/java/com/fsck/k9/ui/crypto/MessageCryptoAnnotations.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/crypto/MessageCryptoCallback.java b/app/core/src/main/java/com/fsck/k9/ui/crypto/MessageCryptoCallback.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/crypto/MessageCryptoCallback.java
rename to app/core/src/main/java/com/fsck/k9/ui/crypto/MessageCryptoCallback.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/crypto/MessageCryptoHelper.java b/app/core/src/main/java/com/fsck/k9/ui/crypto/MessageCryptoHelper.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/crypto/MessageCryptoHelper.java
rename to app/core/src/main/java/com/fsck/k9/ui/crypto/MessageCryptoHelper.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/crypto/OpenPgpApiFactory.java b/app/core/src/main/java/com/fsck/k9/ui/crypto/OpenPgpApiFactory.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/crypto/OpenPgpApiFactory.java
rename to app/core/src/main/java/com/fsck/k9/ui/crypto/OpenPgpApiFactory.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/dialog/ApgDeprecationWarningDialog.java b/app/core/src/main/java/com/fsck/k9/ui/dialog/ApgDeprecationWarningDialog.java
similarity index 98%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/dialog/ApgDeprecationWarningDialog.java
rename to app/core/src/main/java/com/fsck/k9/ui/dialog/ApgDeprecationWarningDialog.java
index 83f7c2fc5..2bca1e272 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/dialog/ApgDeprecationWarningDialog.java
+++ b/app/core/src/main/java/com/fsck/k9/ui/dialog/ApgDeprecationWarningDialog.java
@@ -11,7 +11,7 @@ import android.view.LayoutInflater;
 import android.view.View;
 import android.widget.TextView;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 
 
 public class ApgDeprecationWarningDialog extends AlertDialog {
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/endtoend/AutocryptKeyTransferActivity.kt b/app/core/src/main/java/com/fsck/k9/ui/endtoend/AutocryptKeyTransferActivity.kt
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/endtoend/AutocryptKeyTransferActivity.kt
rename to app/core/src/main/java/com/fsck/k9/ui/endtoend/AutocryptKeyTransferActivity.kt
index 726ab3b75..3d6f7839b 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/endtoend/AutocryptKeyTransferActivity.kt
+++ b/app/core/src/main/java/com/fsck/k9/ui/endtoend/AutocryptKeyTransferActivity.kt
@@ -11,7 +11,7 @@ import android.transition.TransitionInflater
 import android.transition.TransitionManager
 import android.view.MenuItem
 import android.view.View
-import com.fsck.k9.R
+import com.fsck.k9.core.R
 import com.fsck.k9.activity.K9Activity
 import com.fsck.k9.finishWithErrorToast
 import com.fsck.k9.view.StatusIndicator
@@ -165,4 +165,4 @@ class AutocryptKeyTransferActivity : K9Activity() {
             return intent
         }
     }
-}
\ No newline at end of file
+}
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/endtoend/AutocryptKeyTransferPresenter.kt b/app/core/src/main/java/com/fsck/k9/ui/endtoend/AutocryptKeyTransferPresenter.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/endtoend/AutocryptKeyTransferPresenter.kt
rename to app/core/src/main/java/com/fsck/k9/ui/endtoend/AutocryptKeyTransferPresenter.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/endtoend/AutocryptKeyTransferViewModel.kt b/app/core/src/main/java/com/fsck/k9/ui/endtoend/AutocryptKeyTransferViewModel.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/endtoend/AutocryptKeyTransferViewModel.kt
rename to app/core/src/main/java/com/fsck/k9/ui/endtoend/AutocryptKeyTransferViewModel.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/endtoend/AutocryptSetupMessageLiveEvent.kt b/app/core/src/main/java/com/fsck/k9/ui/endtoend/AutocryptSetupMessageLiveEvent.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/endtoend/AutocryptSetupMessageLiveEvent.kt
rename to app/core/src/main/java/com/fsck/k9/ui/endtoend/AutocryptSetupMessageLiveEvent.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/endtoend/AutocryptSetupTransferLiveEvent.kt b/app/core/src/main/java/com/fsck/k9/ui/endtoend/AutocryptSetupTransferLiveEvent.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/endtoend/AutocryptSetupTransferLiveEvent.kt
rename to app/core/src/main/java/com/fsck/k9/ui/endtoend/AutocryptSetupTransferLiveEvent.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/endtoend/KoinModule.kt b/app/core/src/main/java/com/fsck/k9/ui/endtoend/KoinModule.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/endtoend/KoinModule.kt
rename to app/core/src/main/java/com/fsck/k9/ui/endtoend/KoinModule.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/folders/FolderNameFormatter.kt b/app/core/src/main/java/com/fsck/k9/ui/folders/FolderNameFormatter.kt
similarity index 94%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/folders/FolderNameFormatter.kt
rename to app/core/src/main/java/com/fsck/k9/ui/folders/FolderNameFormatter.kt
index b54c23658..33fd7e9b4 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/folders/FolderNameFormatter.kt
+++ b/app/core/src/main/java/com/fsck/k9/ui/folders/FolderNameFormatter.kt
@@ -1,7 +1,7 @@
 package com.fsck.k9.ui.folders
 
 import android.content.res.Resources
-import com.fsck.k9.R
+import com.fsck.k9.core.R
 import com.fsck.k9.mailstore.Folder
 import com.fsck.k9.mailstore.FolderType
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/message/LocalMessageExtractorLoader.java b/app/core/src/main/java/com/fsck/k9/ui/message/LocalMessageExtractorLoader.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/message/LocalMessageExtractorLoader.java
rename to app/core/src/main/java/com/fsck/k9/ui/message/LocalMessageExtractorLoader.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/message/LocalMessageLoader.java b/app/core/src/main/java/com/fsck/k9/ui/message/LocalMessageLoader.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/message/LocalMessageLoader.java
rename to app/core/src/main/java/com/fsck/k9/ui/message/LocalMessageLoader.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/messagelist/MessageListViewModel.kt b/app/core/src/main/java/com/fsck/k9/ui/messagelist/MessageListViewModel.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/messagelist/MessageListViewModel.kt
rename to app/core/src/main/java/com/fsck/k9/ui/messagelist/MessageListViewModel.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/messagelist/MessageListViewModelFactory.kt b/app/core/src/main/java/com/fsck/k9/ui/messagelist/MessageListViewModelFactory.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/messagelist/MessageListViewModelFactory.kt
rename to app/core/src/main/java/com/fsck/k9/ui/messagelist/MessageListViewModelFactory.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/messageview/AttachmentController.java b/app/core/src/main/java/com/fsck/k9/ui/messageview/AttachmentController.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/messageview/AttachmentController.java
rename to app/core/src/main/java/com/fsck/k9/ui/messageview/AttachmentController.java
index e4f5f2bc9..fb35033d3 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/messageview/AttachmentController.java
+++ b/app/core/src/main/java/com/fsck/k9/ui/messageview/AttachmentController.java
@@ -24,7 +24,7 @@ import android.widget.Toast;
 import com.fsck.k9.Account;
 import com.fsck.k9.K9;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.cache.TemporaryAttachmentStore;
 import com.fsck.k9.controller.MessagingController;
 import com.fsck.k9.controller.SimpleMessagingListener;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/messageview/AttachmentView.java b/app/core/src/main/java/com/fsck/k9/ui/messageview/AttachmentView.java
similarity index 93%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/messageview/AttachmentView.java
rename to app/core/src/main/java/com/fsck/k9/ui/messageview/AttachmentView.java
index 3bde82e7f..249084b2b 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/messageview/AttachmentView.java
+++ b/app/core/src/main/java/com/fsck/k9/ui/messageview/AttachmentView.java
@@ -13,7 +13,7 @@ import android.widget.TextView;
 
 import com.bumptech.glide.Glide;
 import com.fsck.k9.K9;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.helper.SizeFormatter;
 import com.fsck.k9.mailstore.AttachmentViewInfo;
 
@@ -91,15 +91,11 @@ public class AttachmentView extends FrameLayout implements OnClickListener, OnLo
 
     @Override
     public void onClick(View view) {
-        switch (view.getId()) {
-            case R.id.view: {
-                onViewButtonClick();
-                break;
-            }
-            case R.id.download: {
-                onSaveButtonClick();
-                break;
-            }
+        int id = view.getId();
+        if (id == R.id.view) {
+            onViewButtonClick();
+        } else if (id == R.id.download) {
+            onSaveButtonClick();
         }
     }
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/messageview/AttachmentViewCallback.java b/app/core/src/main/java/com/fsck/k9/ui/messageview/AttachmentViewCallback.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/messageview/AttachmentViewCallback.java
rename to app/core/src/main/java/com/fsck/k9/ui/messageview/AttachmentViewCallback.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/messageview/CryptoInfoDialog.java b/app/core/src/main/java/com/fsck/k9/ui/messageview/CryptoInfoDialog.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/messageview/CryptoInfoDialog.java
rename to app/core/src/main/java/com/fsck/k9/ui/messageview/CryptoInfoDialog.java
index e8ebfdba6..8919e8254 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/messageview/CryptoInfoDialog.java
+++ b/app/core/src/main/java/com/fsck/k9/ui/messageview/CryptoInfoDialog.java
@@ -19,7 +19,7 @@ import android.view.View;
 import android.widget.ImageView;
 import android.widget.TextView;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.view.MessageCryptoDisplayStatus;
 import com.fsck.k9.view.ThemeUtils;
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/messageview/DownloadImageTask.java b/app/core/src/main/java/com/fsck/k9/ui/messageview/DownloadImageTask.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/messageview/DownloadImageTask.java
rename to app/core/src/main/java/com/fsck/k9/ui/messageview/DownloadImageTask.java
index a28fe3780..cea73caa0 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/messageview/DownloadImageTask.java
+++ b/app/core/src/main/java/com/fsck/k9/ui/messageview/DownloadImageTask.java
@@ -17,7 +17,7 @@ import timber.log.Timber;
 import android.widget.Toast;
 
 import com.fsck.k9.K9;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.helper.FileHelper;
 import com.fsck.k9.helper.UrlEncodingHelper;
 import com.fsck.k9.mail.internet.MimeUtility;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/messageview/LockedAttachmentView.java b/app/core/src/main/java/com/fsck/k9/ui/messageview/LockedAttachmentView.java
similarity index 92%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/messageview/LockedAttachmentView.java
rename to app/core/src/main/java/com/fsck/k9/ui/messageview/LockedAttachmentView.java
index 10d05cca0..a83f62d02 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/messageview/LockedAttachmentView.java
+++ b/app/core/src/main/java/com/fsck/k9/ui/messageview/LockedAttachmentView.java
@@ -7,7 +7,7 @@ import android.view.View;
 import android.view.View.OnClickListener;
 import android.view.ViewStub;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.mailstore.AttachmentViewInfo;
 import com.fsck.k9.view.ToolableViewAnimator;
 
@@ -45,11 +45,8 @@ public class LockedAttachmentView extends ToolableViewAnimator implements OnClic
 
     @Override
     public void onClick(View view) {
-        switch (view.getId()) {
-            case R.id.locked_button: {
-                showUnlockedView();
-                break;
-            }
+        if (view.getId() == R.id.locked_button) {
+            showUnlockedView();
         }
     }
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/messageview/MessageContainerView.java b/app/core/src/main/java/com/fsck/k9/ui/messageview/MessageContainerView.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/messageview/MessageContainerView.java
rename to app/core/src/main/java/com/fsck/k9/ui/messageview/MessageContainerView.java
index 0738b97b8..d6bce15ad 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/messageview/MessageContainerView.java
+++ b/app/core/src/main/java/com/fsck/k9/ui/messageview/MessageContainerView.java
@@ -25,7 +25,7 @@ import android.widget.LinearLayout;
 import android.widget.TextView;
 import android.widget.Toast;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.helper.ClipboardManager;
 import com.fsck.k9.helper.Contacts;
 import com.fsck.k9.message.html.HtmlConverter;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/messageview/MessageCryptoPresenter.java b/app/core/src/main/java/com/fsck/k9/ui/messageview/MessageCryptoPresenter.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/messageview/MessageCryptoPresenter.java
rename to app/core/src/main/java/com/fsck/k9/ui/messageview/MessageCryptoPresenter.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/messageview/MessageTopView.java b/app/core/src/main/java/com/fsck/k9/ui/messageview/MessageTopView.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/messageview/MessageTopView.java
rename to app/core/src/main/java/com/fsck/k9/ui/messageview/MessageTopView.java
index 440a9331c..b0fc72044 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/messageview/MessageTopView.java
+++ b/app/core/src/main/java/com/fsck/k9/ui/messageview/MessageTopView.java
@@ -21,7 +21,7 @@ import android.widget.TextView;
 
 import com.fsck.k9.Account;
 import com.fsck.k9.Account.ShowPictures;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.helper.Contacts;
 import com.fsck.k9.mail.Address;
 import com.fsck.k9.mail.Message;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/messageview/MessageViewFragment.java b/app/core/src/main/java/com/fsck/k9/ui/messageview/MessageViewFragment.java
similarity index 93%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/messageview/MessageViewFragment.java
rename to app/core/src/main/java/com/fsck/k9/ui/messageview/MessageViewFragment.java
index 9d27f003b..ab845b525 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/messageview/MessageViewFragment.java
+++ b/app/core/src/main/java/com/fsck/k9/ui/messageview/MessageViewFragment.java
@@ -31,7 +31,7 @@ import android.widget.Toast;
 import com.fsck.k9.Account;
 import com.fsck.k9.K9;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.ChooseFolder;
 import com.fsck.k9.activity.MessageLoaderHelper;
 import com.fsck.k9.activity.MessageLoaderHelper.MessageLoaderCallbacks;
@@ -510,36 +510,28 @@ public class MessageViewFragment extends Fragment implements ConfirmationDialogF
 
     private void showDialog(int dialogId) {
         DialogFragment fragment;
-        switch (dialogId) {
-            case R.id.dialog_confirm_delete: {
-                String title = getString(R.string.dialog_confirm_delete_title);
-                String message = getString(R.string.dialog_confirm_delete_message);
-                String confirmText = getString(R.string.dialog_confirm_delete_confirm_button);
-                String cancelText = getString(R.string.dialog_confirm_delete_cancel_button);
-
-                fragment = ConfirmationDialogFragment.newInstance(dialogId, title, message,
-                        confirmText, cancelText);
-                break;
-            }
-            case R.id.dialog_confirm_spam: {
-                String title = getString(R.string.dialog_confirm_spam_title);
-                String message = getResources().getQuantityString(R.plurals.dialog_confirm_spam_message, 1);
-                String confirmText = getString(R.string.dialog_confirm_spam_confirm_button);
-                String cancelText = getString(R.string.dialog_confirm_spam_cancel_button);
-
-                fragment = ConfirmationDialogFragment.newInstance(dialogId, title, message,
-                        confirmText, cancelText);
-                break;
-            }
-            case R.id.dialog_attachment_progress: {
-                String message = getString(R.string.dialog_attachment_progress_title);
-                long size = currentAttachmentViewInfo.size;
-                fragment = AttachmentDownloadDialogFragment.newInstance(size, message);
-                break;
-            }
-            default: {
-                throw new RuntimeException("Called showDialog(int) with unknown dialog id.");
-            }
+        if (dialogId == R.id.dialog_confirm_delete) {
+            String title = getString(R.string.dialog_confirm_delete_title);
+            String message = getString(R.string.dialog_confirm_delete_message);
+            String confirmText = getString(R.string.dialog_confirm_delete_confirm_button);
+            String cancelText = getString(R.string.dialog_confirm_delete_cancel_button);
+
+            fragment = ConfirmationDialogFragment.newInstance(dialogId, title, message,
+                    confirmText, cancelText);
+        } else if (dialogId == R.id.dialog_confirm_spam) {
+            String title = getString(R.string.dialog_confirm_spam_title);
+            String message = getResources().getQuantityString(R.plurals.dialog_confirm_spam_message, 1);
+            String confirmText = getString(R.string.dialog_confirm_spam_confirm_button);
+            String cancelText = getString(R.string.dialog_confirm_spam_cancel_button);
+
+            fragment = ConfirmationDialogFragment.newInstance(dialogId, title, message,
+                    confirmText, cancelText);
+        } else if (dialogId == R.id.dialog_attachment_progress) {
+            String message = getString(R.string.dialog_attachment_progress_title);
+            long size = currentAttachmentViewInfo.size;
+            fragment = AttachmentDownloadDialogFragment.newInstance(size, message);
+        } else {
+            throw new RuntimeException("Called showDialog(int) with unknown dialog id.");
         }
 
         fragment.setTargetFragment(this, dialogId);
@@ -575,16 +567,11 @@ public class MessageViewFragment extends Fragment implements ConfirmationDialogF
 
     @Override
     public void doPositiveClick(int dialogId) {
-        switch (dialogId) {
-            case R.id.dialog_confirm_delete: {
-                delete();
-                break;
-            }
-            case R.id.dialog_confirm_spam: {
-                refileMessage(mDstFolder);
-                mDstFolder = null;
-                break;
-            }
+        if (dialogId == R.id.dialog_confirm_delete) {
+            delete();
+        } else if (dialogId == R.id.dialog_confirm_spam) {
+            refileMessage(mDstFolder);
+            mDstFolder = null;
         }
     }
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/messageview/OnCryptoClickListener.java b/app/core/src/main/java/com/fsck/k9/ui/messageview/OnCryptoClickListener.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/messageview/OnCryptoClickListener.java
rename to app/core/src/main/java/com/fsck/k9/ui/messageview/OnCryptoClickListener.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/AboutActivity.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/AboutActivity.kt
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/AboutActivity.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/AboutActivity.kt
index eaeff37c0..ba752dc2c 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/AboutActivity.kt
+++ b/app/core/src/main/java/com/fsck/k9/ui/settings/AboutActivity.kt
@@ -7,7 +7,7 @@ import android.os.Bundle
 import android.view.Menu
 import android.view.MenuItem
 import android.webkit.WebView
-import com.fsck.k9.R
+import com.fsck.k9.core.R
 import com.fsck.k9.activity.K9Activity
 import de.cketti.library.changelog.ChangeLog
 import timber.log.Timber
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/AccountItem.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/AccountItem.kt
similarity index 95%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/AccountItem.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/AccountItem.kt
index 864baebea..f77f086b6 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/AccountItem.kt
+++ b/app/core/src/main/java/com/fsck/k9/ui/settings/AccountItem.kt
@@ -1,7 +1,7 @@
 package com.fsck.k9.ui.settings
 
 import com.fsck.k9.Account
-import com.fsck.k9.R
+import com.fsck.k9.core.R
 import com.xwray.groupie.kotlinandroidextensions.Item
 import com.xwray.groupie.kotlinandroidextensions.ViewHolder
 import kotlinx.android.synthetic.main.account_list_item.*
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/KoinModule.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/KoinModule.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/KoinModule.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/KoinModule.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/PreferenceExtras.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/PreferenceExtras.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/PreferenceExtras.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/PreferenceExtras.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/SettingsAction.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/SettingsAction.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/SettingsAction.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/SettingsAction.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/SettingsActionItem.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/SettingsActionItem.kt
similarity index 94%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/SettingsActionItem.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/SettingsActionItem.kt
index 7441f5823..c2b417570 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/SettingsActionItem.kt
+++ b/app/core/src/main/java/com/fsck/k9/ui/settings/SettingsActionItem.kt
@@ -1,6 +1,6 @@
 package com.fsck.k9.ui.settings
 
-import com.fsck.k9.R
+import com.fsck.k9.core.R
 import com.xwray.groupie.kotlinandroidextensions.Item
 import com.xwray.groupie.kotlinandroidextensions.ViewHolder
 import kotlinx.android.synthetic.main.text_list_item.*
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/SettingsActivity.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/SettingsActivity.kt
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/SettingsActivity.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/SettingsActivity.kt
index 0108403a9..5ad7045c4 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/SettingsActivity.kt
+++ b/app/core/src/main/java/com/fsck/k9/ui/settings/SettingsActivity.kt
@@ -6,7 +6,7 @@ import android.os.Bundle
 import android.support.v7.widget.LinearLayoutManager
 import android.view.MenuItem
 import com.fsck.k9.Account
-import com.fsck.k9.R
+import com.fsck.k9.core.R
 import com.fsck.k9.activity.K9Activity
 import com.fsck.k9.ui.observeNotNull
 import com.fsck.k9.ui.settings.account.AccountSettingsActivity
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/SettingsViewModel.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/SettingsViewModel.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/SettingsViewModel.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/SettingsViewModel.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsActivity.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsActivity.kt
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsActivity.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsActivity.kt
index c24590f7e..98bb19866 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsActivity.kt
+++ b/app/core/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsActivity.kt
@@ -7,7 +7,7 @@ import android.support.v7.preference.PreferenceFragmentCompat
 import android.support.v7.preference.PreferenceFragmentCompat.OnPreferenceStartScreenCallback
 import android.support.v7.preference.PreferenceScreen
 import android.view.MenuItem
-import com.fsck.k9.R
+import com.fsck.k9.core.R
 import com.fsck.k9.activity.K9Activity
 import com.fsck.k9.ui.fragmentTransaction
 import com.fsck.k9.ui.fragmentTransactionWithBackStack
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsDataStore.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsDataStore.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsDataStore.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsDataStore.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsDataStoreFactory.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsDataStoreFactory.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsDataStoreFactory.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsDataStoreFactory.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsFragment.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsFragment.kt
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsFragment.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsFragment.kt
index 16c02ede1..3d62776b1 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsFragment.kt
+++ b/app/core/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsFragment.kt
@@ -6,7 +6,7 @@ import android.support.v14.preference.SwitchPreference
 import android.support.v7.preference.ListPreference
 import android.widget.Toast
 import com.fsck.k9.Account
-import com.fsck.k9.R
+import com.fsck.k9.core.R
 import com.fsck.k9.activity.ManageIdentities
 import com.fsck.k9.activity.setup.AccountSetupComposition
 import com.fsck.k9.activity.setup.AccountSetupIncoming
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsViewModel.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsViewModel.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsViewModel.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/account/AccountSettingsViewModel.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/AutocryptPreferEncryptDialogFragment.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/account/AutocryptPreferEncryptDialogFragment.kt
similarity index 98%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/AutocryptPreferEncryptDialogFragment.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/account/AutocryptPreferEncryptDialogFragment.kt
index 65e4c8b78..6adb4ed5a 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/AutocryptPreferEncryptDialogFragment.kt
+++ b/app/core/src/main/java/com/fsck/k9/ui/settings/account/AutocryptPreferEncryptDialogFragment.kt
@@ -11,7 +11,7 @@ import android.view.LayoutInflater
 import android.view.View
 import android.widget.CheckBox
 import android.widget.TextView
-import com.fsck.k9.R
+import com.fsck.k9.core.R
 
 class AutocryptPreferEncryptDialogFragment : DialogFragment() {
     private val preference: AutocryptPreferEncryptPreference by lazy {
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/AutocryptPreferEncryptPreference.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/account/AutocryptPreferEncryptPreference.kt
similarity index 98%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/AutocryptPreferEncryptPreference.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/account/AutocryptPreferEncryptPreference.kt
index 70e394e94..bd49c4c05 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/AutocryptPreferEncryptPreference.kt
+++ b/app/core/src/main/java/com/fsck/k9/ui/settings/account/AutocryptPreferEncryptPreference.kt
@@ -6,7 +6,7 @@ import android.support.v4.content.res.TypedArrayUtils
 import android.support.v7.preference.PreferenceViewHolder
 import android.support.v7.preference.TwoStatePreference
 import android.util.AttributeSet
-import com.fsck.k9.R
+import com.fsck.k9.core.R
 import com.takisoft.fix.support.v7.preference.PreferenceFragmentCompat
 
 @SuppressLint("RestrictedApi")
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/FolderListPreference.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/account/FolderListPreference.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/FolderListPreference.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/account/FolderListPreference.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/HoloColorPickerDialogFragment.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/account/HoloColorPickerDialogFragment.kt
similarity index 98%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/HoloColorPickerDialogFragment.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/account/HoloColorPickerDialogFragment.kt
index 668678924..f70dd23db 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/HoloColorPickerDialogFragment.kt
+++ b/app/core/src/main/java/com/fsck/k9/ui/settings/account/HoloColorPickerDialogFragment.kt
@@ -6,7 +6,7 @@ import android.os.Bundle
 import android.support.v7.app.AlertDialog
 import android.support.v7.preference.PreferenceDialogFragmentCompat
 import android.view.LayoutInflater
-import com.fsck.k9.R
+import com.fsck.k9.core.R
 import com.larswerkman.colorpicker.ColorPicker
 
 class HoloColorPickerDialogFragment : PreferenceDialogFragmentCompat() {
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/HoloColorPickerPreference.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/account/HoloColorPickerPreference.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/HoloColorPickerPreference.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/account/HoloColorPickerPreference.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/OpenPgpAppSelectDialog.java b/app/core/src/main/java/com/fsck/k9/ui/settings/account/OpenPgpAppSelectDialog.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/OpenPgpAppSelectDialog.java
rename to app/core/src/main/java/com/fsck/k9/ui/settings/account/OpenPgpAppSelectDialog.java
index 61551d38e..ccbc53c39 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/account/OpenPgpAppSelectDialog.java
+++ b/app/core/src/main/java/com/fsck/k9/ui/settings/account/OpenPgpAppSelectDialog.java
@@ -29,7 +29,7 @@ import android.widget.ListAdapter;
 import com.fsck.k9.Account;
 import com.fsck.k9.K9;
 import com.fsck.k9.Preferences;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.ui.dialog.ApgDeprecationWarningDialog;
 import org.openintents.openpgp.util.OpenPgpApi;
 import org.openintents.openpgp.util.OpenPgpProviderUtil;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/general/GeneralSettingsActivity.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/general/GeneralSettingsActivity.kt
similarity index 98%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/general/GeneralSettingsActivity.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/general/GeneralSettingsActivity.kt
index 7a40ffe95..dcb8014de 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/general/GeneralSettingsActivity.kt
+++ b/app/core/src/main/java/com/fsck/k9/ui/settings/general/GeneralSettingsActivity.kt
@@ -7,7 +7,7 @@ import android.support.v7.preference.PreferenceFragmentCompat
 import android.support.v7.preference.PreferenceFragmentCompat.OnPreferenceStartScreenCallback
 import android.support.v7.preference.PreferenceScreen
 import android.view.MenuItem
-import com.fsck.k9.R
+import com.fsck.k9.core.R
 import com.fsck.k9.activity.K9Activity
 import com.fsck.k9.ui.fragmentTransaction
 import com.fsck.k9.ui.fragmentTransactionWithBackStack
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/general/GeneralSettingsDataStore.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/general/GeneralSettingsDataStore.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/general/GeneralSettingsDataStore.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/general/GeneralSettingsDataStore.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/general/GeneralSettingsFragment.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/general/GeneralSettingsFragment.kt
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/general/GeneralSettingsFragment.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/general/GeneralSettingsFragment.kt
index 230123651..7fadead96 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/general/GeneralSettingsFragment.kt
+++ b/app/core/src/main/java/com/fsck/k9/ui/settings/general/GeneralSettingsFragment.kt
@@ -5,7 +5,7 @@ import android.content.Intent
 import android.os.Bundle
 import android.support.v14.preference.MultiSelectListPreference
 import android.support.v7.preference.Preference
-import com.fsck.k9.R
+import com.fsck.k9.core.R
 import com.fsck.k9.helper.FileBrowserHelper
 import com.fsck.k9.notification.NotificationController
 import com.fsck.k9.ui.settings.onClick
diff --git a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/general/LanguagePreference.kt b/app/core/src/main/java/com/fsck/k9/ui/settings/general/LanguagePreference.kt
similarity index 97%
rename from app/k9mail/src/main/java/com/fsck/k9/ui/settings/general/LanguagePreference.kt
rename to app/core/src/main/java/com/fsck/k9/ui/settings/general/LanguagePreference.kt
index b99df7ae2..d1182e8ca 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/ui/settings/general/LanguagePreference.kt
+++ b/app/core/src/main/java/com/fsck/k9/ui/settings/general/LanguagePreference.kt
@@ -6,7 +6,7 @@ import android.content.Context
 import android.support.v4.content.res.TypedArrayUtils
 import android.support.v7.preference.ListPreference
 import android.util.AttributeSet
-import com.fsck.k9.R
+import com.fsck.k9.core.R
 
 
 class LanguagePreference
diff --git a/app/k9mail/src/main/java/com/fsck/k9/view/ClientCertificateSpinner.java b/app/core/src/main/java/com/fsck/k9/view/ClientCertificateSpinner.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/view/ClientCertificateSpinner.java
rename to app/core/src/main/java/com/fsck/k9/view/ClientCertificateSpinner.java
index 9b17b4fec..bc787be2f 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/view/ClientCertificateSpinner.java
+++ b/app/core/src/main/java/com/fsck/k9/view/ClientCertificateSpinner.java
@@ -1,7 +1,7 @@
 
 package com.fsck.k9.view;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 
 import android.app.Activity;
 import android.content.Context;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/view/ColorChip.java b/app/core/src/main/java/com/fsck/k9/view/ColorChip.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/view/ColorChip.java
rename to app/core/src/main/java/com/fsck/k9/view/ColorChip.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/view/FoldableLinearLayout.java b/app/core/src/main/java/com/fsck/k9/view/FoldableLinearLayout.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/view/FoldableLinearLayout.java
rename to app/core/src/main/java/com/fsck/k9/view/FoldableLinearLayout.java
index 120291419..5b3b976a3 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/view/FoldableLinearLayout.java
+++ b/app/core/src/main/java/com/fsck/k9/view/FoldableLinearLayout.java
@@ -1,6 +1,6 @@
 package com.fsck.k9.view;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 
 import android.content.Context;
 import android.content.res.Resources.Theme;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/view/HighlightDialogFragment.java b/app/core/src/main/java/com/fsck/k9/view/HighlightDialogFragment.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/view/HighlightDialogFragment.java
rename to app/core/src/main/java/com/fsck/k9/view/HighlightDialogFragment.java
index fae68aa45..3eaa411d0 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/view/HighlightDialogFragment.java
+++ b/app/core/src/main/java/com/fsck/k9/view/HighlightDialogFragment.java
@@ -9,7 +9,7 @@ import android.support.v4.app.DialogFragment;
 import android.view.View;
 import android.view.inputmethod.InputMethodManager;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.github.amlcurran.showcaseview.ShowcaseView;
 import com.github.amlcurran.showcaseview.ShowcaseView.Builder;
 import com.github.amlcurran.showcaseview.targets.ViewTarget;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/view/K9WebViewClient.java b/app/core/src/main/java/com/fsck/k9/view/K9WebViewClient.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/view/K9WebViewClient.java
rename to app/core/src/main/java/com/fsck/k9/view/K9WebViewClient.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/view/LinearViewAnimator.java b/app/core/src/main/java/com/fsck/k9/view/LinearViewAnimator.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/view/LinearViewAnimator.java
rename to app/core/src/main/java/com/fsck/k9/view/LinearViewAnimator.java
index 76695e298..29fdff045 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/view/LinearViewAnimator.java
+++ b/app/core/src/main/java/com/fsck/k9/view/LinearViewAnimator.java
@@ -8,7 +8,7 @@ import android.view.animation.Animation;
 import android.view.animation.AnimationUtils;
 import android.widget.ViewAnimator;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 
 
 /** This view extends the common ViewAnimator, allowing different sets of animations
diff --git a/app/k9mail/src/main/java/com/fsck/k9/view/MessageCryptoDisplayStatus.java b/app/core/src/main/java/com/fsck/k9/view/MessageCryptoDisplayStatus.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/view/MessageCryptoDisplayStatus.java
rename to app/core/src/main/java/com/fsck/k9/view/MessageCryptoDisplayStatus.java
index 31ea1dafc..b84838936 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/view/MessageCryptoDisplayStatus.java
+++ b/app/core/src/main/java/com/fsck/k9/view/MessageCryptoDisplayStatus.java
@@ -6,7 +6,7 @@ import android.support.annotation.DrawableRes;
 import android.support.annotation.NonNull;
 import android.support.annotation.StringRes;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.mailstore.CryptoResultAnnotation;
 import org.openintents.openpgp.OpenPgpDecryptionResult;
 import org.openintents.openpgp.OpenPgpSignatureResult;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/view/MessageCryptoStatusView.java b/app/core/src/main/java/com/fsck/k9/view/MessageCryptoStatusView.java
similarity index 97%
rename from app/k9mail/src/main/java/com/fsck/k9/view/MessageCryptoStatusView.java
rename to app/core/src/main/java/com/fsck/k9/view/MessageCryptoStatusView.java
index b70929d66..59f9bc73e 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/view/MessageCryptoStatusView.java
+++ b/app/core/src/main/java/com/fsck/k9/view/MessageCryptoStatusView.java
@@ -7,7 +7,7 @@ import android.util.AttributeSet;
 import android.widget.FrameLayout;
 import android.widget.ImageView;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 
 
 public class MessageCryptoStatusView extends FrameLayout {
diff --git a/app/k9mail/src/main/java/com/fsck/k9/view/MessageHeader.java b/app/core/src/main/java/com/fsck/k9/view/MessageHeader.java
similarity index 95%
rename from app/k9mail/src/main/java/com/fsck/k9/view/MessageHeader.java
rename to app/core/src/main/java/com/fsck/k9/view/MessageHeader.java
index 255be60c2..6efabfb99 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/view/MessageHeader.java
+++ b/app/core/src/main/java/com/fsck/k9/view/MessageHeader.java
@@ -31,7 +31,7 @@ import android.widget.Toast;
 import com.fsck.k9.Account;
 import com.fsck.k9.FontSizes;
 import com.fsck.k9.K9;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.misc.ContactPictureLoader;
 import com.fsck.k9.helper.ClipboardManager;
 import com.fsck.k9.helper.ContactPicture;
@@ -41,7 +41,6 @@ import com.fsck.k9.helper.Utility;
 import com.fsck.k9.mail.Address;
 import com.fsck.k9.mail.Flag;
 import com.fsck.k9.mail.Message;
-import com.fsck.k9.mail.MessagingException;
 import com.fsck.k9.mail.internet.MimeUtility;
 import com.fsck.k9.ui.messageview.OnCryptoClickListener;
 import com.fsck.k9.ui.ContactBadge;
@@ -156,37 +155,26 @@ public class MessageHeader extends LinearLayout implements OnClickListener, OnLo
 
     @Override
     public void onClick(View view) {
-        switch (view.getId()) {
-            case R.id.from: {
-                onAddSenderToContacts();
-                break;
-            }
-            case R.id.to:
-            case R.id.cc:
-            case R.id.bcc: {
-                expand((TextView)view, ((TextView)view).getEllipsize() != null);
-                layoutChanged();
-                break;
-            }
-            case R.id.crypto_status_icon: {
-                onCryptoClickListener.onCryptoClick();
-                break;
-            }
+        int id = view.getId();
+        if (id == R.id.from) {
+            onAddSenderToContacts();
+        } else if (id == R.id.to || id == R.id.cc || id == R.id.bcc) {
+            expand((TextView)view, ((TextView)view).getEllipsize() != null);
+            layoutChanged();
+        } else if (id == R.id.crypto_status_icon) {
+            onCryptoClickListener.onCryptoClick();
         }
     }
 
     @Override
     public boolean onLongClick(View view) {
-        switch (view.getId()) {
-            case R.id.from:
-                onAddAddressesToClipboard(mMessage.getFrom());
-                break;
-            case R.id.to:
-                onAddRecipientsToClipboard(Message.RecipientType.TO);
-                break;
-            case R.id.cc:
-                onAddRecipientsToClipboard(Message.RecipientType.CC);
-                break;
+        int id = view.getId();
+        if (id == R.id.from) {
+            onAddAddressesToClipboard(mMessage.getFrom());
+        } else if (id == R.id.to) {
+            onAddRecipientsToClipboard(Message.RecipientType.TO);
+        } else if (id == R.id.cc) {
+            onAddRecipientsToClipboard(Message.RecipientType.CC);
         }
 
         return true;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/view/MessageTitleView.java b/app/core/src/main/java/com/fsck/k9/view/MessageTitleView.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/view/MessageTitleView.java
rename to app/core/src/main/java/com/fsck/k9/view/MessageTitleView.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/view/MessageWebView.java b/app/core/src/main/java/com/fsck/k9/view/MessageWebView.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/view/MessageWebView.java
rename to app/core/src/main/java/com/fsck/k9/view/MessageWebView.java
index 16d451f76..9c0b3d95c 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/view/MessageWebView.java
+++ b/app/core/src/main/java/com/fsck/k9/view/MessageWebView.java
@@ -16,7 +16,7 @@ import android.widget.Toast;
 
 import com.fsck.k9.K9;
 import com.fsck.k9.K9.Theme;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.mailstore.AttachmentResolver;
 
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/view/NonLockingScrollView.java b/app/core/src/main/java/com/fsck/k9/view/NonLockingScrollView.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/view/NonLockingScrollView.java
rename to app/core/src/main/java/com/fsck/k9/view/NonLockingScrollView.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/view/RecipientSelectView.java b/app/core/src/main/java/com/fsck/k9/view/RecipientSelectView.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/view/RecipientSelectView.java
rename to app/core/src/main/java/com/fsck/k9/view/RecipientSelectView.java
index 8a57b8917..2addcb45e 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/view/RecipientSelectView.java
+++ b/app/core/src/main/java/com/fsck/k9/view/RecipientSelectView.java
@@ -33,7 +33,7 @@ import android.widget.ListView;
 import android.widget.TextView;
 
 import com.fsck.k9.K9;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.AlternateRecipientAdapter;
 import com.fsck.k9.activity.AlternateRecipientAdapter.AlternateRecipientListener;
 import com.fsck.k9.activity.compose.RecipientAdapter;
diff --git a/app/k9mail/src/main/java/com/fsck/k9/view/RigidWebView.java b/app/core/src/main/java/com/fsck/k9/view/RigidWebView.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/view/RigidWebView.java
rename to app/core/src/main/java/com/fsck/k9/view/RigidWebView.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/view/StatusIndicator.java b/app/core/src/main/java/com/fsck/k9/view/StatusIndicator.java
similarity index 97%
rename from app/k9mail/src/main/java/com/fsck/k9/view/StatusIndicator.java
rename to app/core/src/main/java/com/fsck/k9/view/StatusIndicator.java
index 270c462cd..45e22b3ee 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/view/StatusIndicator.java
+++ b/app/core/src/main/java/com/fsck/k9/view/StatusIndicator.java
@@ -6,7 +6,7 @@ import android.util.AttributeSet;
 import android.view.LayoutInflater;
 import android.view.animation.AnimationUtils;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 
 
 public class StatusIndicator extends ToolableViewAnimator {
diff --git a/app/k9mail/src/main/java/com/fsck/k9/view/ThemeUtils.java b/app/core/src/main/java/com/fsck/k9/view/ThemeUtils.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/view/ThemeUtils.java
rename to app/core/src/main/java/com/fsck/k9/view/ThemeUtils.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/view/ToolableViewAnimator.java b/app/core/src/main/java/com/fsck/k9/view/ToolableViewAnimator.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/view/ToolableViewAnimator.java
rename to app/core/src/main/java/com/fsck/k9/view/ToolableViewAnimator.java
index c9c804777..d99d2e30d 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/view/ToolableViewAnimator.java
+++ b/app/core/src/main/java/com/fsck/k9/view/ToolableViewAnimator.java
@@ -34,7 +34,7 @@ import android.view.ViewGroup;
 import android.view.animation.Animation;
 import android.widget.ViewAnimator;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 
 
 /** This view is essentially identical to ViewAnimator, but allows specifying the initial view
diff --git a/app/k9mail/src/main/java/com/fsck/k9/view/ViewSwitcher.java b/app/core/src/main/java/com/fsck/k9/view/ViewSwitcher.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/view/ViewSwitcher.java
rename to app/core/src/main/java/com/fsck/k9/view/ViewSwitcher.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/widget/list/MessageListRemoteViewFactory.java b/app/core/src/main/java/com/fsck/k9/widget/list/MessageListRemoteViewFactory.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/widget/list/MessageListRemoteViewFactory.java
rename to app/core/src/main/java/com/fsck/k9/widget/list/MessageListRemoteViewFactory.java
index 83c745d81..9dedc9f57 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/widget/list/MessageListRemoteViewFactory.java
+++ b/app/core/src/main/java/com/fsck/k9/widget/list/MessageListRemoteViewFactory.java
@@ -19,7 +19,7 @@ import android.widget.RemoteViews;
 import android.widget.RemoteViewsService;
 
 import com.fsck.k9.K9;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.provider.MessageProvider;
 
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/widget/list/MessageListWidgetProvider.java b/app/core/src/main/java/com/fsck/k9/widget/list/MessageListWidgetProvider.java
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/widget/list/MessageListWidgetProvider.java
rename to app/core/src/main/java/com/fsck/k9/widget/list/MessageListWidgetProvider.java
index e135cf055..094aa959d 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/widget/list/MessageListWidgetProvider.java
+++ b/app/core/src/main/java/com/fsck/k9/widget/list/MessageListWidgetProvider.java
@@ -10,7 +10,7 @@ import android.content.Intent;
 import android.net.Uri;
 import android.widget.RemoteViews;
 
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.activity.MessageCompose;
 import com.fsck.k9.activity.MessageList;
 
diff --git a/app/k9mail/src/main/java/com/fsck/k9/widget/list/MessageListWidgetService.java b/app/core/src/main/java/com/fsck/k9/widget/list/MessageListWidgetService.java
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/widget/list/MessageListWidgetService.java
rename to app/core/src/main/java/com/fsck/k9/widget/list/MessageListWidgetService.java
diff --git a/app/k9mail/src/main/java/com/fsck/k9/widget/unread/KoinModule.kt b/app/core/src/main/java/com/fsck/k9/widget/unread/KoinModule.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/widget/unread/KoinModule.kt
rename to app/core/src/main/java/com/fsck/k9/widget/unread/KoinModule.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetConfigurationActivity.kt b/app/core/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetConfigurationActivity.kt
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetConfigurationActivity.kt
rename to app/core/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetConfigurationActivity.kt
index e3ac59fca..86b163723 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetConfigurationActivity.kt
+++ b/app/core/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetConfigurationActivity.kt
@@ -11,7 +11,7 @@ import android.view.MenuItem
 import android.widget.Toast
 
 import com.fsck.k9.Preferences
-import com.fsck.k9.R
+import com.fsck.k9.core.R
 import com.fsck.k9.activity.ChooseAccount
 import com.fsck.k9.activity.ChooseFolder
 import com.fsck.k9.activity.K9PreferenceActivity
diff --git a/app/k9mail/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetData.kt b/app/core/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetData.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetData.kt
rename to app/core/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetData.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetDataProvider.kt b/app/core/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetDataProvider.kt
similarity index 99%
rename from app/k9mail/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetDataProvider.kt
rename to app/core/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetDataProvider.kt
index fc0dbdf14..50f2e38d3 100644
--- a/app/k9mail/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetDataProvider.kt
+++ b/app/core/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetDataProvider.kt
@@ -5,7 +5,7 @@ import android.content.Intent
 import com.fsck.k9.Account
 import com.fsck.k9.K9
 import com.fsck.k9.Preferences
-import com.fsck.k9.R
+import com.fsck.k9.core.R
 import com.fsck.k9.activity.FolderList
 import com.fsck.k9.activity.MessageList
 import com.fsck.k9.controller.MessagingController
diff --git a/app/k9mail/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetRepository.kt b/app/core/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetRepository.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetRepository.kt
rename to app/core/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetRepository.kt
diff --git a/app/k9mail/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetUpdater.kt b/app/core/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetUpdater.kt
similarity index 100%
rename from app/k9mail/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetUpdater.kt
rename to app/core/src/main/java/com/fsck/k9/widget/unread/UnreadWidgetUpdater.kt
diff --git a/app/k9mail/src/test/java/com/fsck/k9/DependencyInjectionTest.kt b/app/core/src/test/java/com/fsck/k9/DependencyInjectionTest.kt
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/DependencyInjectionTest.kt
rename to app/core/src/test/java/com/fsck/k9/DependencyInjectionTest.kt
diff --git a/app/k9mail/src/test/java/com/fsck/k9/GlobalsHelper.java b/app/core/src/test/java/com/fsck/k9/GlobalsHelper.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/GlobalsHelper.java
rename to app/core/src/test/java/com/fsck/k9/GlobalsHelper.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/K9RobolectricTest.kt b/app/core/src/test/java/com/fsck/k9/K9RobolectricTest.kt
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/K9RobolectricTest.kt
rename to app/core/src/test/java/com/fsck/k9/K9RobolectricTest.kt
diff --git a/app/k9mail/src/test/java/com/fsck/k9/KotlinHelper.kt b/app/core/src/test/java/com/fsck/k9/KotlinHelper.kt
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/KotlinHelper.kt
rename to app/core/src/test/java/com/fsck/k9/KotlinHelper.kt
diff --git a/app/k9mail/src/test/java/com/fsck/k9/MockHelper.java b/app/core/src/test/java/com/fsck/k9/MockHelper.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/MockHelper.java
rename to app/core/src/test/java/com/fsck/k9/MockHelper.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/QuietTimeCheckerTest.kt b/app/core/src/test/java/com/fsck/k9/QuietTimeCheckerTest.kt
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/QuietTimeCheckerTest.kt
rename to app/core/src/test/java/com/fsck/k9/QuietTimeCheckerTest.kt
diff --git a/app/k9mail/src/test/java/com/fsck/k9/RobolectricTest.kt b/app/core/src/test/java/com/fsck/k9/RobolectricTest.kt
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/RobolectricTest.kt
rename to app/core/src/test/java/com/fsck/k9/RobolectricTest.kt
diff --git a/app/k9mail/src/test/java/com/fsck/k9/account/AccountCreatorTest.java b/app/core/src/test/java/com/fsck/k9/account/AccountCreatorTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/account/AccountCreatorTest.java
rename to app/core/src/test/java/com/fsck/k9/account/AccountCreatorTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/activity/ActivityListenerTest.java b/app/core/src/test/java/com/fsck/k9/activity/ActivityListenerTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/activity/ActivityListenerTest.java
rename to app/core/src/test/java/com/fsck/k9/activity/ActivityListenerTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/activity/MessageReferenceTest.java b/app/core/src/test/java/com/fsck/k9/activity/MessageReferenceTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/activity/MessageReferenceTest.java
rename to app/core/src/test/java/com/fsck/k9/activity/MessageReferenceTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/activity/compose/RecipientLoaderTest.java b/app/core/src/test/java/com/fsck/k9/activity/compose/RecipientLoaderTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/activity/compose/RecipientLoaderTest.java
rename to app/core/src/test/java/com/fsck/k9/activity/compose/RecipientLoaderTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/activity/compose/RecipientPresenterTest.java b/app/core/src/test/java/com/fsck/k9/activity/compose/RecipientPresenterTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/activity/compose/RecipientPresenterTest.java
rename to app/core/src/test/java/com/fsck/k9/activity/compose/RecipientPresenterTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/activity/misc/ContactPictureLoaderTest.java b/app/core/src/test/java/com/fsck/k9/activity/misc/ContactPictureLoaderTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/activity/misc/ContactPictureLoaderTest.java
rename to app/core/src/test/java/com/fsck/k9/activity/misc/ContactPictureLoaderTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/autocrypt/AutocryptGossipHeaderParserTest.kt b/app/core/src/test/java/com/fsck/k9/autocrypt/AutocryptGossipHeaderParserTest.kt
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/autocrypt/AutocryptGossipHeaderParserTest.kt
rename to app/core/src/test/java/com/fsck/k9/autocrypt/AutocryptGossipHeaderParserTest.kt
diff --git a/app/k9mail/src/test/java/com/fsck/k9/autocrypt/AutocryptHeaderParserTest.java b/app/core/src/test/java/com/fsck/k9/autocrypt/AutocryptHeaderParserTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/autocrypt/AutocryptHeaderParserTest.java
rename to app/core/src/test/java/com/fsck/k9/autocrypt/AutocryptHeaderParserTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/autocrypt/AutocryptHeaderTest.java b/app/core/src/test/java/com/fsck/k9/autocrypt/AutocryptHeaderTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/autocrypt/AutocryptHeaderTest.java
rename to app/core/src/test/java/com/fsck/k9/autocrypt/AutocryptHeaderTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/autocrypt/AutocryptOperationsHelper.java b/app/core/src/test/java/com/fsck/k9/autocrypt/AutocryptOperationsHelper.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/autocrypt/AutocryptOperationsHelper.java
rename to app/core/src/test/java/com/fsck/k9/autocrypt/AutocryptOperationsHelper.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/cache/EmailProviderCacheTest.java b/app/core/src/test/java/com/fsck/k9/cache/EmailProviderCacheTest.java
similarity index 96%
rename from app/k9mail/src/test/java/com/fsck/k9/cache/EmailProviderCacheTest.java
rename to app/core/src/test/java/com/fsck/k9/cache/EmailProviderCacheTest.java
index e936b60bb..4c2b75ada 100644
--- a/app/k9mail/src/test/java/com/fsck/k9/cache/EmailProviderCacheTest.java
+++ b/app/core/src/test/java/com/fsck/k9/cache/EmailProviderCacheTest.java
@@ -4,9 +4,12 @@ package com.fsck.k9.cache;
 import java.util.Collections;
 import java.util.UUID;
 
+import android.net.Uri;
+
 import com.fsck.k9.RobolectricTest;
 import com.fsck.k9.mailstore.LocalFolder;
 import com.fsck.k9.mailstore.LocalMessage;
+import com.fsck.k9.provider.EmailProvider;
 import org.junit.Before;
 import org.junit.Test;
 import org.mockito.Mock;
@@ -35,6 +38,7 @@ public class EmailProviderCacheTest extends RobolectricTest {
     @Before
     public void before() {
         MockitoAnnotations.initMocks(this);
+        EmailProvider.CONTENT_URI = Uri.parse("content://test.provider.email");
 
         cache = EmailProviderCache.getCache(UUID.randomUUID().toString(), RuntimeEnvironment.application);
         when(mockLocalMessage.getDatabaseId()).thenReturn(localMessageId);
diff --git a/app/k9mail/src/test/java/com/fsck/k9/controller/MessagingControllerTest.java b/app/core/src/test/java/com/fsck/k9/controller/MessagingControllerTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/controller/MessagingControllerTest.java
rename to app/core/src/test/java/com/fsck/k9/controller/MessagingControllerTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/controller/MessagingControllerTestExtra.kt b/app/core/src/test/java/com/fsck/k9/controller/MessagingControllerTestExtra.kt
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/controller/MessagingControllerTestExtra.kt
rename to app/core/src/test/java/com/fsck/k9/controller/MessagingControllerTestExtra.kt
diff --git a/app/k9mail/src/test/java/com/fsck/k9/controller/PendingCommandSerializerTest.java b/app/core/src/test/java/com/fsck/k9/controller/PendingCommandSerializerTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/controller/PendingCommandSerializerTest.java
rename to app/core/src/test/java/com/fsck/k9/controller/PendingCommandSerializerTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/controller/UidReverseComparatorTest.java b/app/core/src/test/java/com/fsck/k9/controller/UidReverseComparatorTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/controller/UidReverseComparatorTest.java
rename to app/core/src/test/java/com/fsck/k9/controller/UidReverseComparatorTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/crypto/MessageCryptoStructureDetectorTest.java b/app/core/src/test/java/com/fsck/k9/crypto/MessageCryptoStructureDetectorTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/crypto/MessageCryptoStructureDetectorTest.java
rename to app/core/src/test/java/com/fsck/k9/crypto/MessageCryptoStructureDetectorTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/crypto/OpenPgpApiHelperTest.java b/app/core/src/test/java/com/fsck/k9/crypto/OpenPgpApiHelperTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/crypto/OpenPgpApiHelperTest.java
rename to app/core/src/test/java/com/fsck/k9/crypto/OpenPgpApiHelperTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/helper/EmailHelperTest.java b/app/core/src/test/java/com/fsck/k9/helper/EmailHelperTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/helper/EmailHelperTest.java
rename to app/core/src/test/java/com/fsck/k9/helper/EmailHelperTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/helper/IdentityHelperTest.kt b/app/core/src/test/java/com/fsck/k9/helper/IdentityHelperTest.kt
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/helper/IdentityHelperTest.kt
rename to app/core/src/test/java/com/fsck/k9/helper/IdentityHelperTest.kt
diff --git a/app/k9mail/src/test/java/com/fsck/k9/helper/K9AlarmManagerTest.java b/app/core/src/test/java/com/fsck/k9/helper/K9AlarmManagerTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/helper/K9AlarmManagerTest.java
rename to app/core/src/test/java/com/fsck/k9/helper/K9AlarmManagerTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/helper/MailToTest.java b/app/core/src/test/java/com/fsck/k9/helper/MailToTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/helper/MailToTest.java
rename to app/core/src/test/java/com/fsck/k9/helper/MailToTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/helper/MessageHelperTest.java b/app/core/src/test/java/com/fsck/k9/helper/MessageHelperTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/helper/MessageHelperTest.java
rename to app/core/src/test/java/com/fsck/k9/helper/MessageHelperTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/helper/ReplyToParserTest.java b/app/core/src/test/java/com/fsck/k9/helper/ReplyToParserTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/helper/ReplyToParserTest.java
rename to app/core/src/test/java/com/fsck/k9/helper/ReplyToParserTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/helper/UtilityTest.java b/app/core/src/test/java/com/fsck/k9/helper/UtilityTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/helper/UtilityTest.java
rename to app/core/src/test/java/com/fsck/k9/helper/UtilityTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/mail/TransportUrisTest.java b/app/core/src/test/java/com/fsck/k9/mail/TransportUrisTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/mail/TransportUrisTest.java
rename to app/core/src/test/java/com/fsck/k9/mail/TransportUrisTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/mailstore/AttachmentResolverTest.java b/app/core/src/test/java/com/fsck/k9/mailstore/AttachmentResolverTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/mailstore/AttachmentResolverTest.java
rename to app/core/src/test/java/com/fsck/k9/mailstore/AttachmentResolverTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/mailstore/DeferredFileBodyTest.java b/app/core/src/test/java/com/fsck/k9/mailstore/DeferredFileBodyTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/mailstore/DeferredFileBodyTest.java
rename to app/core/src/test/java/com/fsck/k9/mailstore/DeferredFileBodyTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/mailstore/LocalStoreTest.java b/app/core/src/test/java/com/fsck/k9/mailstore/LocalStoreTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/mailstore/LocalStoreTest.java
rename to app/core/src/test/java/com/fsck/k9/mailstore/LocalStoreTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/mailstore/MessageViewInfoExtractorTest.java b/app/core/src/test/java/com/fsck/k9/mailstore/MessageViewInfoExtractorTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/mailstore/MessageViewInfoExtractorTest.java
rename to app/core/src/test/java/com/fsck/k9/mailstore/MessageViewInfoExtractorTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/mailstore/MigrationTest.java b/app/core/src/test/java/com/fsck/k9/mailstore/MigrationTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/mailstore/MigrationTest.java
rename to app/core/src/test/java/com/fsck/k9/mailstore/MigrationTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/mailstore/MimePartStreamParserTest.kt b/app/core/src/test/java/com/fsck/k9/mailstore/MimePartStreamParserTest.kt
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/mailstore/MimePartStreamParserTest.kt
rename to app/core/src/test/java/com/fsck/k9/mailstore/MimePartStreamParserTest.kt
diff --git a/app/k9mail/src/test/java/com/fsck/k9/mailstore/MoreMessagesTest.java b/app/core/src/test/java/com/fsck/k9/mailstore/MoreMessagesTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/mailstore/MoreMessagesTest.java
rename to app/core/src/test/java/com/fsck/k9/mailstore/MoreMessagesTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/mailstore/StoreSchemaDefinitionTest.java b/app/core/src/test/java/com/fsck/k9/mailstore/StoreSchemaDefinitionTest.java
similarity index 99%
rename from app/k9mail/src/test/java/com/fsck/k9/mailstore/StoreSchemaDefinitionTest.java
rename to app/core/src/test/java/com/fsck/k9/mailstore/StoreSchemaDefinitionTest.java
index 28358b83e..87e40c816 100644
--- a/app/k9mail/src/test/java/com/fsck/k9/mailstore/StoreSchemaDefinitionTest.java
+++ b/app/core/src/test/java/com/fsck/k9/mailstore/StoreSchemaDefinitionTest.java
@@ -14,10 +14,10 @@ import android.database.sqlite.SQLiteDatabase;
 import android.text.TextUtils;
 
 import com.fsck.k9.Account;
-import com.fsck.k9.BuildConfig;
+import com.fsck.k9.core.BuildConfig;
 import com.fsck.k9.GlobalsHelper;
 import com.fsck.k9.K9;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.RobolectricTest;
 import com.fsck.k9.mail.MessagingException;
 import org.junit.Before;
diff --git a/app/k9mail/src/test/java/com/fsck/k9/mailstore/migrations/MigrationMimeStructureStateTest.java b/app/core/src/test/java/com/fsck/k9/mailstore/migrations/MigrationMimeStructureStateTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/mailstore/migrations/MigrationMimeStructureStateTest.java
rename to app/core/src/test/java/com/fsck/k9/mailstore/migrations/MigrationMimeStructureStateTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/mailstore/migrations/MigrationTo51Test.kt b/app/core/src/test/java/com/fsck/k9/mailstore/migrations/MigrationTo51Test.kt
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/mailstore/migrations/MigrationTo51Test.kt
rename to app/core/src/test/java/com/fsck/k9/mailstore/migrations/MigrationTo51Test.kt
diff --git a/app/k9mail/src/test/java/com/fsck/k9/mailstore/migrations/MigrationTo60Test.java b/app/core/src/test/java/com/fsck/k9/mailstore/migrations/MigrationTo60Test.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/mailstore/migrations/MigrationTo60Test.java
rename to app/core/src/test/java/com/fsck/k9/mailstore/migrations/MigrationTo60Test.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/MessageBuilderTest.java b/app/core/src/test/java/com/fsck/k9/message/MessageBuilderTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/message/MessageBuilderTest.java
rename to app/core/src/test/java/com/fsck/k9/message/MessageBuilderTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/MessageCreationHelper.java b/app/core/src/test/java/com/fsck/k9/message/MessageCreationHelper.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/message/MessageCreationHelper.java
rename to app/core/src/test/java/com/fsck/k9/message/MessageCreationHelper.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/PgpMessageBuilderTest.java b/app/core/src/test/java/com/fsck/k9/message/PgpMessageBuilderTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/message/PgpMessageBuilderTest.java
rename to app/core/src/test/java/com/fsck/k9/message/PgpMessageBuilderTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/TestMessageConstructionUtils.java b/app/core/src/test/java/com/fsck/k9/message/TestMessageConstructionUtils.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/message/TestMessageConstructionUtils.java
rename to app/core/src/test/java/com/fsck/k9/message/TestMessageConstructionUtils.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/TextBodyBuilderTest.java b/app/core/src/test/java/com/fsck/k9/message/TextBodyBuilderTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/message/TextBodyBuilderTest.java
rename to app/core/src/test/java/com/fsck/k9/message/TextBodyBuilderTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/extractors/AttachmentInfoExtractorTest.java b/app/core/src/test/java/com/fsck/k9/message/extractors/AttachmentInfoExtractorTest.java
similarity index 99%
rename from app/k9mail/src/test/java/com/fsck/k9/message/extractors/AttachmentInfoExtractorTest.java
rename to app/core/src/test/java/com/fsck/k9/message/extractors/AttachmentInfoExtractorTest.java
index 3d82ffbe6..f374c2144 100644
--- a/app/k9mail/src/test/java/com/fsck/k9/message/extractors/AttachmentInfoExtractorTest.java
+++ b/app/core/src/test/java/com/fsck/k9/message/extractors/AttachmentInfoExtractorTest.java
@@ -40,6 +40,7 @@ public class AttachmentInfoExtractorTest extends RobolectricTest {
 
     @Before
     public void setUp() throws Exception {
+        AttachmentProvider.CONTENT_URI = Uri.parse("content://test.attachmentprovider");
         context = RuntimeEnvironment.application;
         attachmentInfoExtractor = new AttachmentInfoExtractor(context);
     }
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/extractors/EncryptionDetectorTest.java b/app/core/src/test/java/com/fsck/k9/message/extractors/EncryptionDetectorTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/message/extractors/EncryptionDetectorTest.java
rename to app/core/src/test/java/com/fsck/k9/message/extractors/EncryptionDetectorTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/extractors/MessagePreviewCreatorTest.java b/app/core/src/test/java/com/fsck/k9/message/extractors/MessagePreviewCreatorTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/message/extractors/MessagePreviewCreatorTest.java
rename to app/core/src/test/java/com/fsck/k9/message/extractors/MessagePreviewCreatorTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/extractors/PreviewTextExtractorTest.java b/app/core/src/test/java/com/fsck/k9/message/extractors/PreviewTextExtractorTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/message/extractors/PreviewTextExtractorTest.java
rename to app/core/src/test/java/com/fsck/k9/message/extractors/PreviewTextExtractorTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/extractors/TextPartFinderTest.java b/app/core/src/test/java/com/fsck/k9/message/extractors/TextPartFinderTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/message/extractors/TextPartFinderTest.java
rename to app/core/src/test/java/com/fsck/k9/message/extractors/TextPartFinderTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/html/BitcoinUriParserTest.java b/app/core/src/test/java/com/fsck/k9/message/html/BitcoinUriParserTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/message/html/BitcoinUriParserTest.java
rename to app/core/src/test/java/com/fsck/k9/message/html/BitcoinUriParserTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/html/EmailSectionExtractorTest.kt b/app/core/src/test/java/com/fsck/k9/message/html/EmailSectionExtractorTest.kt
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/message/html/EmailSectionExtractorTest.kt
rename to app/core/src/test/java/com/fsck/k9/message/html/EmailSectionExtractorTest.kt
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/html/EmailSectionTest.kt b/app/core/src/test/java/com/fsck/k9/message/html/EmailSectionTest.kt
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/message/html/EmailSectionTest.kt
rename to app/core/src/test/java/com/fsck/k9/message/html/EmailSectionTest.kt
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/html/EthereumUriParserTest.java b/app/core/src/test/java/com/fsck/k9/message/html/EthereumUriParserTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/message/html/EthereumUriParserTest.java
rename to app/core/src/test/java/com/fsck/k9/message/html/EthereumUriParserTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/html/HtmlConverterTest.java b/app/core/src/test/java/com/fsck/k9/message/html/HtmlConverterTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/message/html/HtmlConverterTest.java
rename to app/core/src/test/java/com/fsck/k9/message/html/HtmlConverterTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/html/HtmlHelper.java b/app/core/src/test/java/com/fsck/k9/message/html/HtmlHelper.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/message/html/HtmlHelper.java
rename to app/core/src/test/java/com/fsck/k9/message/html/HtmlHelper.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/html/HtmlSanitizerTest.java b/app/core/src/test/java/com/fsck/k9/message/html/HtmlSanitizerTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/message/html/HtmlSanitizerTest.java
rename to app/core/src/test/java/com/fsck/k9/message/html/HtmlSanitizerTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/html/HttpUriParserTest.java b/app/core/src/test/java/com/fsck/k9/message/html/HttpUriParserTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/message/html/HttpUriParserTest.java
rename to app/core/src/test/java/com/fsck/k9/message/html/HttpUriParserTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/html/UriMatcherTest.java b/app/core/src/test/java/com/fsck/k9/message/html/UriMatcherTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/message/html/UriMatcherTest.java
rename to app/core/src/test/java/com/fsck/k9/message/html/UriMatcherTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/signature/HtmlSignatureRemoverTest.java b/app/core/src/test/java/com/fsck/k9/message/signature/HtmlSignatureRemoverTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/message/signature/HtmlSignatureRemoverTest.java
rename to app/core/src/test/java/com/fsck/k9/message/signature/HtmlSignatureRemoverTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/message/signature/TextSignatureRemoverTest.java b/app/core/src/test/java/com/fsck/k9/message/signature/TextSignatureRemoverTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/message/signature/TextSignatureRemoverTest.java
rename to app/core/src/test/java/com/fsck/k9/message/signature/TextSignatureRemoverTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/notification/AddNotificationResultTest.java b/app/core/src/test/java/com/fsck/k9/notification/AddNotificationResultTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/notification/AddNotificationResultTest.java
rename to app/core/src/test/java/com/fsck/k9/notification/AddNotificationResultTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/notification/AuthenticationErrorNotificationsTest.java b/app/core/src/test/java/com/fsck/k9/notification/AuthenticationErrorNotificationsTest.java
similarity index 99%
rename from app/k9mail/src/test/java/com/fsck/k9/notification/AuthenticationErrorNotificationsTest.java
rename to app/core/src/test/java/com/fsck/k9/notification/AuthenticationErrorNotificationsTest.java
index 4df7c656f..98f34de5a 100644
--- a/app/k9mail/src/test/java/com/fsck/k9/notification/AuthenticationErrorNotificationsTest.java
+++ b/app/core/src/test/java/com/fsck/k9/notification/AuthenticationErrorNotificationsTest.java
@@ -10,7 +10,7 @@ import android.support.v4.app.NotificationManagerCompat;
 
 import com.fsck.k9.Account;
 import com.fsck.k9.MockHelper;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.RobolectricTest;
 import org.junit.Before;
 import org.junit.Test;
diff --git a/app/k9mail/src/test/java/com/fsck/k9/notification/BaseNotificationsTest.java b/app/core/src/test/java/com/fsck/k9/notification/BaseNotificationsTest.java
similarity index 99%
rename from app/k9mail/src/test/java/com/fsck/k9/notification/BaseNotificationsTest.java
rename to app/core/src/test/java/com/fsck/k9/notification/BaseNotificationsTest.java
index 51303f698..7d53b8b73 100644
--- a/app/k9mail/src/test/java/com/fsck/k9/notification/BaseNotificationsTest.java
+++ b/app/core/src/test/java/com/fsck/k9/notification/BaseNotificationsTest.java
@@ -8,7 +8,7 @@ import com.fsck.k9.Account;
 import com.fsck.k9.K9;
 import com.fsck.k9.K9.NotificationQuickDelete;
 import com.fsck.k9.MockHelper;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import org.junit.Before;
 import org.junit.Test;
 
diff --git a/app/k9mail/src/test/java/com/fsck/k9/notification/CertificateErrorNotificationsTest.java b/app/core/src/test/java/com/fsck/k9/notification/CertificateErrorNotificationsTest.java
similarity index 99%
rename from app/k9mail/src/test/java/com/fsck/k9/notification/CertificateErrorNotificationsTest.java
rename to app/core/src/test/java/com/fsck/k9/notification/CertificateErrorNotificationsTest.java
index e1cd0013d..78b07b1d2 100644
--- a/app/k9mail/src/test/java/com/fsck/k9/notification/CertificateErrorNotificationsTest.java
+++ b/app/core/src/test/java/com/fsck/k9/notification/CertificateErrorNotificationsTest.java
@@ -10,7 +10,7 @@ import android.support.v4.app.NotificationManagerCompat;
 
 import com.fsck.k9.Account;
 import com.fsck.k9.MockHelper;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.RobolectricTest;
 import org.junit.Before;
 import org.junit.Test;
diff --git a/app/k9mail/src/test/java/com/fsck/k9/notification/DeviceNotificationsTest.java b/app/core/src/test/java/com/fsck/k9/notification/DeviceNotificationsTest.java
similarity index 99%
rename from app/k9mail/src/test/java/com/fsck/k9/notification/DeviceNotificationsTest.java
rename to app/core/src/test/java/com/fsck/k9/notification/DeviceNotificationsTest.java
index af41ec1e2..c3165587b 100644
--- a/app/k9mail/src/test/java/com/fsck/k9/notification/DeviceNotificationsTest.java
+++ b/app/core/src/test/java/com/fsck/k9/notification/DeviceNotificationsTest.java
@@ -16,7 +16,7 @@ import com.fsck.k9.K9;
 import com.fsck.k9.K9.NotificationHideSubject;
 import com.fsck.k9.K9.NotificationQuickDelete;
 import com.fsck.k9.NotificationSetting;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.RobolectricTest;
 import org.junit.Before;
 import org.junit.Test;
diff --git a/app/k9mail/src/test/java/com/fsck/k9/notification/LockScreenNotificationTest.java b/app/core/src/test/java/com/fsck/k9/notification/LockScreenNotificationTest.java
similarity index 99%
rename from app/k9mail/src/test/java/com/fsck/k9/notification/LockScreenNotificationTest.java
rename to app/core/src/test/java/com/fsck/k9/notification/LockScreenNotificationTest.java
index 1ded66bdb..5e8b68648 100644
--- a/app/k9mail/src/test/java/com/fsck/k9/notification/LockScreenNotificationTest.java
+++ b/app/core/src/test/java/com/fsck/k9/notification/LockScreenNotificationTest.java
@@ -12,7 +12,7 @@ import com.fsck.k9.Account;
 import com.fsck.k9.K9;
 import com.fsck.k9.K9.LockScreenNotificationVisibility;
 import com.fsck.k9.MockHelper;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.RobolectricTest;
 import org.junit.Before;
 import org.junit.Test;
diff --git a/app/k9mail/src/test/java/com/fsck/k9/notification/NewMailNotificationsTest.java b/app/core/src/test/java/com/fsck/k9/notification/NewMailNotificationsTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/notification/NewMailNotificationsTest.java
rename to app/core/src/test/java/com/fsck/k9/notification/NewMailNotificationsTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/notification/NotificationContentCreatorTest.java b/app/core/src/test/java/com/fsck/k9/notification/NotificationContentCreatorTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/notification/NotificationContentCreatorTest.java
rename to app/core/src/test/java/com/fsck/k9/notification/NotificationContentCreatorTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/notification/NotificationDataTest.java b/app/core/src/test/java/com/fsck/k9/notification/NotificationDataTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/notification/NotificationDataTest.java
rename to app/core/src/test/java/com/fsck/k9/notification/NotificationDataTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/notification/NotificationIdsTest.java b/app/core/src/test/java/com/fsck/k9/notification/NotificationIdsTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/notification/NotificationIdsTest.java
rename to app/core/src/test/java/com/fsck/k9/notification/NotificationIdsTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/notification/RemoveNotificationResultTest.java b/app/core/src/test/java/com/fsck/k9/notification/RemoveNotificationResultTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/notification/RemoveNotificationResultTest.java
rename to app/core/src/test/java/com/fsck/k9/notification/RemoveNotificationResultTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/notification/SendFailedNotificationsTest.java b/app/core/src/test/java/com/fsck/k9/notification/SendFailedNotificationsTest.java
similarity index 99%
rename from app/k9mail/src/test/java/com/fsck/k9/notification/SendFailedNotificationsTest.java
rename to app/core/src/test/java/com/fsck/k9/notification/SendFailedNotificationsTest.java
index 3e4f34965..1921b79d9 100644
--- a/app/k9mail/src/test/java/com/fsck/k9/notification/SendFailedNotificationsTest.java
+++ b/app/core/src/test/java/com/fsck/k9/notification/SendFailedNotificationsTest.java
@@ -9,7 +9,7 @@ import android.support.v4.app.NotificationManagerCompat;
 
 import com.fsck.k9.Account;
 import com.fsck.k9.MockHelper;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.RobolectricTest;
 import org.junit.Before;
 import org.junit.Test;
diff --git a/app/k9mail/src/test/java/com/fsck/k9/notification/SyncNotificationsTest.java b/app/core/src/test/java/com/fsck/k9/notification/SyncNotificationsTest.java
similarity index 99%
rename from app/k9mail/src/test/java/com/fsck/k9/notification/SyncNotificationsTest.java
rename to app/core/src/test/java/com/fsck/k9/notification/SyncNotificationsTest.java
index f60907469..7abb3b037 100644
--- a/app/k9mail/src/test/java/com/fsck/k9/notification/SyncNotificationsTest.java
+++ b/app/core/src/test/java/com/fsck/k9/notification/SyncNotificationsTest.java
@@ -9,7 +9,7 @@ import android.support.v4.app.NotificationManagerCompat;
 
 import com.fsck.k9.Account;
 import com.fsck.k9.MockHelper;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.RobolectricTest;
 import com.fsck.k9.mail.Folder;
 import org.junit.Before;
diff --git a/app/k9mail/src/test/java/com/fsck/k9/notification/WearNotificationsTest.java b/app/core/src/test/java/com/fsck/k9/notification/WearNotificationsTest.java
similarity index 99%
rename from app/k9mail/src/test/java/com/fsck/k9/notification/WearNotificationsTest.java
rename to app/core/src/test/java/com/fsck/k9/notification/WearNotificationsTest.java
index ac8894ef8..2a863e8ce 100644
--- a/app/k9mail/src/test/java/com/fsck/k9/notification/WearNotificationsTest.java
+++ b/app/core/src/test/java/com/fsck/k9/notification/WearNotificationsTest.java
@@ -15,7 +15,7 @@ import com.fsck.k9.Account;
 import com.fsck.k9.K9;
 import com.fsck.k9.K9.NotificationQuickDelete;
 import com.fsck.k9.MockHelper;
-import com.fsck.k9.R;
+import com.fsck.k9.core.R;
 import com.fsck.k9.RobolectricTest;
 import com.fsck.k9.activity.MessageReference;
 import com.fsck.k9.controller.MessagingController;
diff --git a/app/k9mail/src/test/java/com/fsck/k9/preferences/SettingsExporterTest.java b/app/core/src/test/java/com/fsck/k9/preferences/SettingsExporterTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/preferences/SettingsExporterTest.java
rename to app/core/src/test/java/com/fsck/k9/preferences/SettingsExporterTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/preferences/SettingsImporterTest.java b/app/core/src/test/java/com/fsck/k9/preferences/SettingsImporterTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/preferences/SettingsImporterTest.java
rename to app/core/src/test/java/com/fsck/k9/preferences/SettingsImporterTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/setup/ServerNameSuggesterTest.java b/app/core/src/test/java/com/fsck/k9/setup/ServerNameSuggesterTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/setup/ServerNameSuggesterTest.java
rename to app/core/src/test/java/com/fsck/k9/setup/ServerNameSuggesterTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/ui/crypto/MessageCryptoHelperTest.java b/app/core/src/test/java/com/fsck/k9/ui/crypto/MessageCryptoHelperTest.java
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/ui/crypto/MessageCryptoHelperTest.java
rename to app/core/src/test/java/com/fsck/k9/ui/crypto/MessageCryptoHelperTest.java
diff --git a/app/k9mail/src/test/java/com/fsck/k9/view/MessageHeaderTest.kt b/app/core/src/test/java/com/fsck/k9/view/MessageHeaderTest.kt
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/view/MessageHeaderTest.kt
rename to app/core/src/test/java/com/fsck/k9/view/MessageHeaderTest.kt
diff --git a/app/k9mail/src/test/java/com/fsck/k9/widget/unread/UnreadWidgetDataProviderTest.kt b/app/core/src/test/java/com/fsck/k9/widget/unread/UnreadWidgetDataProviderTest.kt
similarity index 100%
rename from app/k9mail/src/test/java/com/fsck/k9/widget/unread/UnreadWidgetDataProviderTest.kt
rename to app/core/src/test/java/com/fsck/k9/widget/unread/UnreadWidgetDataProviderTest.kt
diff --git a/app/k9mail/src/test/java/org/openintents/openpgp/util/ShadowOpenPgpAsyncTask.java b/app/core/src/test/java/org/openintents/openpgp/util/ShadowOpenPgpAsyncTask.java
similarity index 100%
rename from app/k9mail/src/test/java/org/openintents/openpgp/util/ShadowOpenPgpAsyncTask.java
rename to app/core/src/test/java/org/openintents/openpgp/util/ShadowOpenPgpAsyncTask.java
